
{
    
    
    
    
        
        
        
    
        
        
        
    
        
        
        
    
        
        
        
    
        
        
        
    
    "pages": [{"date":"2024-05-16","image":"","imageAlt":"","link":"http://localhost:1313/posts/htb-sherlocks/noted/","summary":"Noted (DFIR) Scenario Simon, a developer working at Forela, notified the CERT team about a note that appeared on his desktop. The note claimed that his system had been compromised and that sensitive data from Simon\u0026rsquo;s workstation had been collected.","tags":["dfir","file","htb","noted","notepad++","sherlock","time","windows"],"text":"noted (dfir) scenario simon, a developer working at forela, notified the cert team about a note that appeared on his desktop. the note claimed that his system had been compromised and that sensitive data from simon\u0026rsquo;s workstation had been collected. the perpetrators performed data extortion on his workstation and are now threatening to release the data on the dark web unless their demands are met. simon\u0026rsquo;s workstation contained multiple sensitive files, including planned software projects, internal development plans, and application codebases. the threat intelligence team believes that the threat actor made some mistakes, but they have not found any way to contact the threat actors. the company\u0026rsquo;s stakeholders are insisting that this incident be resolved and all sensitive data be recovered. they demand that under no circumstances should the data be leaked. as our junior security analyst, you have been assigned a specific type of dfir (digital forensics and incident response) investigation in this case. the cert lead, after triaging the workstation, has provided you with only the notepad++ artifacts, suspecting that the attacker created the extortion note and conducted other activities with hands-on keyboard access. your duty is to determine how the attack occurred and find a way to contact the threat actors, as they accidentally locked out their own contact information.\nforensics artifacts: the artifacts are from notepad++ software. we have two xml files named config.xml and session.xml. we are also provided with two backup files of two text files lootandpurge.java@2023-07-24_145332 and you have been hacked.txt@2023-07-24_150548.\nextraction: the files were all in plaintext format and the volume of data was low, so extraction was not necessary. however, five files were created for classification purposes. they are file history of recently opened files, edited files in the alleged notepad++, custom uris the alleged notepad++ was set to handle, malicious data extortion java file and a ransom note file\nanalysis:\nfirst, i examined the config.xml file and found some file histories. the history contained the file addresses that were recently opened by the user. i have listed them in the file_history.txt file. also, i found some custom uris that were set to handle files from different types of services. they are listed in the custom_uris.txt file.\nsecond, i analyzed the session.xml file and there i found two files that were being edited along with their backup file locations and last modified timestamps. i added them to a file named edited_files.txt with the findings.\nfinally, i inspected the backup files and discovered a malicious java source file(lootandpurge.java) that was used to encrypt the sensitive data and a ransom note where two pastebin links were given to contact the cybercriminals. a password for the zip file was left behind by the perpetrators. which can be used to decrypt the content of the zip file. the same password can be used to decrypt the pastebin notes to find their ethereum wallet address and email address.\ntools used visual studio code python3 questions and answers q1: what is the full path of the script used by simon for aws operations?\na: c:\\users\\simon.stark\\documents\\dev_ops\\aws_objects migration.pl q2: the attacker duplicated some program code and compiled it on the system, knowing that the victim was a software engineer and had all the necessary utilities. they did this to blend into the environment and didn\u0026rsquo;t bring any of their tools. this code gathered sensitive data and prepared it for exfiltration. what is the full path of the program\u0026rsquo;s source file?\na: c:\\users\\simon.stark\\desktop\\lootandpurge.java. q3: what\u0026rsquo;s the name of the final archive file containing all the data to be exfiltrated?\na: forela-dev-data.zip q4: what\u0026rsquo;s the timestamp in utc when attacker last modified the program source file?\na: 2023-07-24 09:53:23 q5: the attacker wrote a data extortion note after exfiltrating data. what is the crypto wallet address to which attackers demanded payment?\na: 0xca8fa8f0b631ecdb18cda619c4fc9d197c8affca q6: what\u0026rsquo;s the email address of the person to contact for support?\na: cyberjunkie@mail2torjgmxgexntbrmhvgluavhj7ouul5yar6ylbvjkxwqf6ixkwyd.onion summary using the artifacts provided i was able to answer the questions. it was pretty straightforward. but answering question 4 was a little bit baffling to me. it was related to windows\u0026rsquo;s filetime system. i did a little bit of research and piece together an article that you can read here (filetime). also, i added a python script to convert it into utc.\n","title":"HTB Sherlock Noted"},{"date":"2024-05-16","image":"","imageAlt":"","link":"http://localhost:1313/posts/htb-sherlocks/jingle-bell/","summary":"Jingle Bell (DFIR) Scenario Torrin is suspected to be an insider threat in Forela. He is believed to have leaked some data and removed certain applications from their workstation. They managed to bypass some controls and installed unauthorized software.","tags":["bell","database","dfir","htb","jingle","notification","push","sherlock","windows","wpndatabase"],"text":"jingle bell (dfir) scenario torrin is suspected to be an insider threat in forela. he is believed to have leaked some data and removed certain applications from their workstation. they managed to bypass some controls and installed unauthorized software. despite the forensic team\u0026rsquo;s efforts, no evidence of data leakage was found. as a senior incident responder, you have been tasked with investigating the incident to determine the conversation between the two parties involved.\nforensics we are given a windows push notification database file named wpndatabase.db. we can learn more about this database file on:\na digital forensic view of windows 10 notifications windows push notification (wpn) database parser users guide by tzworks® from reading these articles we discovered that in that db file, there\u0026rsquo;s a table named notification. it contains the information of the notifications shown by windows\u0026rsquo;s notification manager as xml payload.\ntherefore, we used sqlitebrowser and manually dumped the xml data from the notification table. and saved them in the notifications.xml file.\nwe need to analyze this xml file to answer the following questions.\nquestions and answers q: which software/application did torrin use to leak forela\u0026rsquo;s secrets?\na: torrin used slack to leak the secrets. we know this from the notification\u0026rsquo;s \u0026lt;toast launch=\u0026quot;\u0026quot;\u0026gt; section. q: what\u0026rsquo;s the name of the rival company to which torrin leaked the data?\na: the rival company\u0026rsquo;s name is primetech innovations. we got this information from \u0026lt;header title=\u0026quot;\u0026quot;\u0026gt; section of the notification. q: what is the username of the person from the competitor organization whom torrin shared information with?\na: the username is cyberjunkie-primetechdev. we get this answer from \u0026lt;binding\u0026gt;\u0026rsquo;s second \u0026lt;text\u0026gt; tag where the attribute hint-style=\u0026quot;bodysubtle\u0026quot; exists. q: what\u0026rsquo;s the channel name in which they conversed with each other?\na: the channel name is forela-secrets-leak. we can derive this from \u0026lt;binding\u0026gt;\u0026rsquo;s first \u0026lt;text\u0026gt; tag where the attribute hint-maxlines=\u0026quot;1\u0026quot; exists. q: what was the password for the archive server?\na: the password for the archive server is tobdaf8qip$re@1. we get this from reading the body of a notification. q: what was the url provided to torrin to upload stolen data to?\na: the url is https://drive.google.com/drive/folders/1vw97vbmxdzuieueug64g5dlzvfp-pdll?usp=sharing. q: when was the above link shared with torrin?\na: when answering this question we faced some difficulties. two timestamps could be the answer to the question. firstly, the notification table has an arrivaltime timestamp expressed in microsoft filetime 64-bit format. when converted to date it gave gmt thu apr 20 2023 10:36:08. but it wasn\u0026rsquo;t the answer. secondly, there was another timestamp embedded inside the \u0026lt;toast launch=\u0026quot;slack://channel?id=c05451qsqm8\u0026amp;amp;message=1681986889.660179\u0026amp;amp;team=t054518aduj\u0026amp;amp;origin=notification\u0026quot;\u0026gt; tag of the notification\u0026rsquo;s xml structure. the message=1681986889.660179 converts to gmt thu apr 20 2023 10:34:49. turns out the latter one was the correct one. so, the answer is 2023-04-20 10:34:49. q: for how much money did torrin leak forela\u0026rsquo;s secrets?\na: the answer is £10000. we could find it in the notifications.xml file. ","title":"HTB Sherlock Jingle Bell"},{"date":"2024-05-16","image":"","imageAlt":"","link":"http://localhost:1313/posts/htb-sherlocks/bft/","summary":"BFT (DFIR) Scenario In this Sherlock, you will become acquainted with MFT (Master File Table) forensics. You will be introduced to well-known tools and methodologies for analyzing MFT artifacts to identify malicious activity.","tags":["bft","dfir","file","htb","master","mft","sherlock","table","windows"],"text":"bft (dfir) scenario in this sherlock, you will become acquainted with mft (master file table) forensics. you will be introduced to well-known tools and methodologies for analyzing mft artifacts to identify malicious activity. during our analysis, you will utilize the mftecmd tool to parse the provided mft file, timeline explorer to open and analyze the results from the parsed mft, and a hex editor to recover file contents from the mft.\nforensics artifact: an mft file $mft is provided. it\u0026rsquo;s an ntfs file system\u0026rsquo;s master file table. learn more about mft here. extraction: i used mftecmd to extract the contents of it and saved it to a file in csv format. analysis: timeline explorer and 010editor were used to answer the questions. tools used mftecmd by eric zimmerman timeline explorer 010editor hex editor questions and answers q1: simon stark was targeted by attackers on february 13. he downloaded a zip file from a link received in an email. what was the name of the zip file he downloaded from the link?\na: the answer is stage-20240213t093324z-001.zip. i applied a filter on the header created0x10 with the date 2024-02-13 and on the header extension with the value .zip. q2: examine the zone identifier contents for the initially downloaded zip file. this field reveals the hosturl from where the file was downloaded, serving as a valuable indicator of compromise (ioc) in our investigation/analysis. what is the full host url from where this zip file was downloaded?\na: the answer is https://storage.googleapis.com/drive-bulk-export-anonymous/20240213t093324.039z/4133399871716478688/a40aecd0-1cf3-4f88-b55a-e188d5c1c04f/1/c277a8b4-afa9-4d34-b8ca-e1eb5e5f983c?authuser.\nto find the url of the downloaded file i needed to locate the stage-20240213t093324z-001.zip:zone.identifier file by applying a filter on extension with the value .identifier. the zone.identifier file separated by a : after the original file is an alternate data stream (ads) file. it contains the file\u0026rsquo;s origin location. in this case, it was a url. it can be found under the zone id contents header.\nq3: what is the full path and name of the malicious file that executed malicious code and connected to a c2 server?\na: the answer is c:\\users\\simon.stark\\downloads\\stage-20240213t093324z-001\\stage\\invoice\\invoices\\invoice.bat. the file was found by applying a filter on the header parent path with the initial zip file\u0026rsquo;s partial name stage and a suspicious .bat file was discovered. q4: analyze the $created0x30 timestamp for the previously identified file. when was this file created on disk?\na: the answer is 2024-02-13 16:38:39. learn more about the difference between $created0x10 and $created0x30. q5: finding the hex offset of an mft record is beneficial in many investigative scenarios. find the hex offset of the stager file from question 3.\na: the answer is 16e3000. to find the answer i needed to look for the malicious file\u0026rsquo;s entry number which was 23436. then i multiplied it with 1024 23436*1024 because each entry in the mft is 1024 bytes in size. after that, i converted the decimal number to hex. q6: each mft record is 1024 bytes in size. if a file on disk has smaller size than 1024 bytes, they can be stored directly on mft file itself. these are called mft resident files. during windows file system investigation, its crucial to look for any malicious/suspicious files that may be resident in mft. this way we can find contents of malicious files/scripts. find the contents of the malicious stager identified in question3 and answer with the c2 ip and port.\na: the answer is 43.204.110.203:6666.\ni had the hex offset for the invoice.bat file\u0026rsquo;s entry and from the timeline explorer, and i discovered the file size was 286 bytes. so, it can be safely assumed it is an mft resident file. the contents of this file can be viewed using a hex editor.\ni opened up my hex editor went to the offset 16e3000 and found the file\u0026rsquo;s contents. it used powershell to download a payload from the above ip.\nsummary using the mft file i was able to discover a stager file residing in mft and the url which was used to deliver it initially. i also discovered a c2 server by reading the contents of that file. a timeline for this incident was also established using timeline explorer.\n","title":"HTB Sherlock BFT"},{"date":"2024-05-16","image":"","imageAlt":"","link":"http://localhost:1313/posts/filetime/","summary":"FILETIME in Windows What is FILETIME? A file time is a 64-bit value that represents the number of 100-nanosecond intervals that have elapsed since 12:00 A.M. January 1, 1601 Coordinated Universal Time (UTC).","tags":["dfir","file","time","timestamp","windows"],"text":"filetime in windows what is filetime? a file time is a 64-bit value that represents the number of 100-nanosecond intervals that have elapsed since 12:00 a.m. january 1, 1601 coordinated universal time (utc). the system records file times when applications create, access, and write to files.\nthe ntfs file system stores time values in utc format, so they are not affected by changes in time zone or daylight saving time. the fat file system stores time values based on the local time of the computer.\ntime stamps are updated at various times and for various reasons. the only guarantee about a file time stamp is that the file time is correctly reflected when the handle that makes the change is closed.\nnot all file systems can record creation and last access times, and not all file systems record them in the same manner. for example, the resolution of create time on fat is 10 milliseconds, while write time has a resolution of 2 seconds and access time has a resolution of 1 day, so it is really the access date. the ntfs file system delays updates to the last access time for a file by up to 1 hour after the last access.\nfiletime structure (minwinbase.h) typedef struct _filetime { dword dwlowdatetime; dword dwhighdatetime; } filetime, *pfiletime, *lpfiletime; here, the dwlowdatetime is the low-order and the dwhighdatetime is the high-order part of the file time.\nolder compilers did not have support for 64 bit types. so the structure splits the 64 bit value into two 32 bit parts. the low part contains the least significant 32 bits. the high part contains the most significant 32 bits.\nconverting filetime to human readable format to convert the filetime into human readable format we need a unsigned 64 bit integer union. but 64 bit integer support may vary compiler to compiler based on cpu architecture and os versions. microsoft\u0026rsquo;s official documentation says it supports ularge_integer (unsigned 64 bit integer union) from windows 10 build 20348.\ntypedef union _ularge_integer { struct { dword lowpart; dword highpart; } dummystructname; struct { dword lowpart; dword highpart; } u; ulonglong quadpart; } ularge_integer; the ularge_integer structure is actually a union. if your compiler has built-in support for 64-bit integers, use the quadpart member to store the 64-bit integer. otherwise, use the lowpart and highpart members to store the 64-bit integer.\nso, many softwares uses the lowpart and highpart to store a unsigned 64 bit integer by splitting it into 32 bit each. for example notepad++ uses originalfilelastmodiftimestamp as lowpart and originalfilelastmodiftimestamphigh as highpart to store the filetime timestamps.\nto retrieve a human readable date/time from these two parts needs some arithmatic operations.\na simplest way to get the original filetime timestamp from lowpart and highpart is a by using the following formula.\nlowpart + 2^32 * highpart the formula does not provide a good enough precision. meaning the retrieved value may have some deviations of minutes and seconds.\nto retrive the precise date/time value we need to perform some bitwise operation on the lowpart and highpart in python to convert it into it\u0026rsquo;s original form (a 64 bit unsigned integer).\na filetime timestamp is a number in 100-nanosecond intervals that have elapsed since 12:00 a.m. january 1, 1601 coordinated universal time (utc) till the creation time of the timestamp. to get the creation time, we need to add it to the nanosecond value of the initial date (1601-01-01).\nps: we can convert the timestamp\u0026rsquo;s value to millisecond or second also. the retrived date/time will be in utc, as the initial value is in utc.\nhere\u0026rsquo;s a simple python script to convert splitted filetime timestamp to human readable format.\nimport datetime timestamp_low = -1354503710 timestamp_high = 31047188 full_timestamp = (timestamp_high \u0026lt;\u0026lt; 32) | (timestamp_low \u0026amp; 0xffffffff) print(full_timestamp) timestamp_seconds = full_timestamp / 10**7 print(timestamp_seconds) converted_date_from_file_time = datetime.datetime(1601, 1, 1) + datetime.timedelta(seconds=timestamp_seconds) print(converted_date_from_file_time) references file times ularge_integer union filetime structure what is dwlowdatetime and dwhighdatetime how to create filetime in win32? htb discussion board ldap, active directory \u0026amp; filetime timestamp converter ","title":"Filetime"},{"date":"2024-05-16","image":"","imageAlt":"","link":"http://localhost:1313/posts/master-file-table/","summary":"What is a Master File Table? The Master File Table (MFT) is a system file in the NTFS file system (having the name $MFT) that stores metadata information about all files and directories on an NTFS volume.","tags":["dfir","file","master","table","windows"],"text":"what is a master file table? the master file table (mft) is a system file in the ntfs file system (having the name $mft) that stores metadata information about all files and directories on an ntfs volume. the mft acts as an index to all the files and directories on the volume, providing quick access to the information needed to retrieve a file.\neach file and directory on an ntfs volume has a unique record in the mft, known as an mft entry. the mft entry contains information such as the file name, timestamps, permissions, and a pointer to the file’s data. the corresponding mft entry is updated when a file is created or modified.\nwhen a file is deleted, the corresponding mft entry is marked as free, but the actual file data remains on the disk until it is overwritten by new data. this can be useful in data recovery scenarios, as the deleted file’s data may still be recoverable. successful data recovery requires that the disk regions occupied by the deleted data are not overwritten.\nnote: the mft is stored on the ntfs volume and is an important component of the ntfs file system. the mft must remain intact and undamaged for the file system to function properly.\nwhy is the mft useful for forensics? comprehensive data storage: the mft provides a detailed record of each file, including timestamps, permissions, and data content locations, making it invaluable for forensic investigations.\nrecovery of deleted files: even when files are deleted, their mft entries might not be immediately reused. this allows forensic analysts to recover details about the deleted files, which can be crucial in legal contexts.\ntracking file modifications: the mft includes multiple timestamps that record different types of file access and modifications. this can help construct a timeline of activities on a system, an essential aspect of forensic analysis.\ndetecting malware and unauthorized access: since the mft records file creation and modification details, unusual changes detected in these entries can indicate unauthorised access or malware activity.\ngeneral structure of mft record the structure of the master file table (mft) in the ntfs file system is complex and consists of multiple records, each of which represents a file or directory on the ntfs volume. each mft record is 1024 bytes, making the mft very simple to parse. an mft record has the following general structure:\nfile record header: this section contains information about the record itself, including the size of the record, the offset of the update sequence, and the flags that indicate the state of the file or directory.\nfile attribute list: this section contains a list of attributes that describe the file or directory, including its name, timestamps, size, and data. each attribute is stored as a separate structure with its format.\ndata runs: this section describes the location of the file or directory’s data on the disk. the data runs are stored as a series of extents describing the starting cluster and the length of each contiguous data block.\nthe exact format and structure of the mft in ntfs can vary depending on the version of the file system in use. however, the general structure remains the same, with the file record header, file attribute list, and data runs being the main components of each mft entry.\nnote: it’s important to note that accessing the mft directly can be dangerous and potentially lead to file system corruption or data loss. before attempting to access or modify the mft, it’s recommended to perform operations on a backup of the mft or back up important data beforehand.\ndetailed breakdown of mft fields $standard_information\ncreation time: the date and time when the file or directory was created. modification time: the date and time when the file or directory was last modified. access time: the date and time when the file or directory was last accessed. entry modified time: the date and time when the mft entry itself was last modified. use case: these timestamps are vital for timeline analysis to determine the sequence of user actions and file usage. $file_name\nfile name: the name of the file or directory. parent directory: the mft record number of the directory in which the file resides. additional timestamps: similar to $standard_information, but specific to this attribute and sometimes used as a fallback. use case: this attribute is used to confirm the integrity of file paths and names in the system, which is crucial for tracking user movements and detecting unauthorised changes. $data\nactual data or pointer: either the data itself for smaller files or a pointer to the data for larger files. use case: direct analysis of file contents and data recovery, especially important in cases involving data theft or unauthorized data manipulation. $logged_utility_stream\ntransactional data: holds data related to transactional ntfs (txf), which logs temporary file state changes. use case: can be used to track changes made during a transaction, useful in cases of system crashes or unexpected shutdowns to determine interim states. $bitmap\ncluster allocation: maps which clusters are in use by the file. use case: useful for recovering deleted files or reconstructing file data from clusters not overwritten by new data. $security_descriptor\nowner id: identifies who owns the file. permissions: details what permissions are attached to the file (who can read, write, execute, etc.). audit settings: specifies what operations (like access or changes) are logged by the system. use case: critical for determining access rights and detecting potential security breaches where permissions may have been altered. $volume_information (specific to the mft entry for the volume itself)\nvolume serial number: unique identifier for the volume. flags: system flags related to the volume, such as whether it’s dirty (improperly unmounted). use case: useful in multi-disk systems to link files and activities to specific volumes, essential in systems recovery and forensic analysis across multiple drives. $index_root and $index_allocation\nindex entries: used in directories to index contained files for quick access. use case: forensically important for reconstructing directory structures and understanding how data was organized and accessed, particularly in complex investigations involving numerous files and directories. timestamps created (0x10) is the standard information (si) creation timestamp. this can be modified by user level processes, for example, timestomping. created (0x30) is the filename (fn) creation timestamp.\ntimestamps of (fn) - behave differently from timestamps of (si). these values don\u0026rsquo;t change or all of the values change at once. however, rename and moved in a local volume are exceptions. these processes are inherited from (si) value then set corresponding (fn) value. for more ntfs timestamps.\nmft resident files files that can be stored directly within the master file table (mft) known as resident files. the size of this kind of files varies depending on the file, the system, and the amount of metadata stored in the mft.\ngenerally, the more metadata associated with a file, the less space remains for storing the file\u0026rsquo;s data itself within the mft. while there is no strict upper limit, typically files smaller than approximately 900 bytes can be fully contained within their mft record.\nreferences geeksforgeeks kazamiya official writeup bft by cyberjunkie \u0026amp; sebh24 on htb ","title":"Master File Table"}]
}

