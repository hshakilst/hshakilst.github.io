<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>privilege escalation</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><div class="main"><div class="tree">
<p><strong>Index</strong></p>
<p><a href="So_Simple_1.html">So Simple 1</a></p>

<ol>
<li><a href="So_Simple_1--nmap.html">nmap</a></li>
<li><a href="So_Simple_1--dirbuster.html">dirbuster</a></li>
<li><a href="So_Simple_1--wpscan.html">wpscan</a></li>
<li><a href="So_Simple_1--enumeration.html">enumeration</a></li>
<li><a href="So_Simple_1--foothold.html">foothold</a></li>
<li><a href="So_Simple_1--privilege_escalation.html">privilege escalation</a></li>
</ol></div>
<div class="page"><h1><b><u>privilege escalation</u></b></h1><h3>From the shell I could list the home directory structure for both of the users. Which should be restricted.<br /><br /></h3><img src="images/6-1.png" alt="images/6-1.png" /><br /><br /><h3>A file in the home directory of max named “personal.txt” had read permission for www-data. And it had nothing interesting.</h3><br /><br /><img src="images/6-2.png" alt="images/6-2.png" /><br /><br /><h3>I cd'ed into .ssh directory and the id_rsa file was readable which should not be readable it should have the chmod 600 equivalent permission. I used that file to log into max and there was no passphrase for the private key.</h3><br /><br /><img src="images/6-3.png" alt="images/6-3.png" /><br /><br /><img src="images/6-4.png" alt="images/6-4.png" /><br /><br /><h3>After logging in I checked if there was any command the could run as sudo. So I ran “sudo -l” and found this.</h3><br /><br /><img src="images/6-5.png" alt="images/6-5.png" /><br /><br /><h3>Then I checked what were the groups that the user belonged to and found a PE vector to gain root access. It belonged to ‘lxd’ group. (For more info on lxc/lxd privilege escalation visit: <a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/lxd-privilege-escalation">https://book.hacktricks.xyz/linux-unix/privilege-escalation/lxd-privilege-escalation</a>.)</h3><br /><br /><img src="images/6-6.png" alt="images/6-6.png" /><br /><br /><h3>The latter one could used to gain root access therefore granting all the privileges for us to read the flags. But I wanted to give a try for the first one. I checked if I could start any services using “/usr/sbin/service”. But it turned out I can't and it asked for root password.</h3><br /><br /><img src="images/6-7.png" alt="images/6-7.png" /><br /><br /><h3>So the only operation I could do was status report. Hmm..what if the contents of the status report was large enough so that it could be displayed using ‘more’ then we could get a shell from that. So I tested apache &amp; ssh but the status report for those services were small and some of the journal files were restricted for the user to read.</h3><br /><br /><img src="images/6-8.png" alt="images/6-8.png" /><br /><br /><img src="images/6-9.png" alt="images/6-9.png" /><br /><br /><h3>Finally, after searching a while when I used ‘mariadb’ service it presented the contents in ‘more’. From there I got access to the user ‘steven’.</h3><br /><br /><img src="images/6-10.png" alt="images/6-10.png" /><br /><br /><h3>It was time for me to gain root access. I uploaded the “.tar.xz” and “.squashfs” files to the machine, imported the image, initialized lxc, ran the container and executed the commands necessary to mount the machine's filesystem to our container so that I could read the root flag. (How it works <a href="https://shenaniganslabs.io/2019/05/21/LXD-LPE.html">https://shenaniganslabs.io/2019/05/21/LXD-LPE.html</a>).</h3><br /><br /><img src="images/6-11.png" alt="images/6-11.png" /><br /><br /><img src="images/6-12.png" alt="images/6-12.png" /><br /><br /><h3>The root flag.</h3><br /><br /><img src="images/6-13.png" alt="images/6-13.png" /><br /><br /><h3>But nothing beats an interactive root shell, right? Because the rootfs is mounted to /mnt/root, I could add a root privileged user to the system (a little invasive) or adding a rule to sudoers file granting all permissions, sky is the limit right?</h3><br /><br /><img src="images/6-14.png" alt="images/6-14.png" /><br /><br /><h3>I added a root user with password ‘privesc’. Then logged into the account using su and I became root.</h3><br /><br /><img src="images/6-15.png" alt="images/6-15.png" /><br /><br /><h3>Thank you.</h3><br /><br /><br /><br /></div></div>
</body></html>
